{"version":3,"file":"esm.js","sources":["../../src/util.ts","../../src/feature-repository.ts","../../../../node_modules/.pnpm/dom-mutator@0.6.0/node_modules/dom-mutator/dist/dom-mutator.esm.js","../../src/mongrule.ts","../../src/core.ts","../../src/GrowthBook.ts","../../src/GrowthBookClient.ts","../../src/sticky-bucket-service.ts"],"sourcesContent":["import {\n  AutoExperiment,\n  AutoExperimentChangeType,\n  Polyfills,\n  UrlTarget,\n  UrlTargetType,\n  VariationRange,\n} from \"./types/growthbook\";\n\nconst polyfills: Polyfills = {\n  fetch: globalThis.fetch ? globalThis.fetch.bind(globalThis) : undefined,\n  SubtleCrypto: globalThis.crypto ? globalThis.crypto.subtle : undefined,\n  EventSource: globalThis.EventSource,\n};\nexport function getPolyfills(): Polyfills {\n  return polyfills;\n}\n\nfunction hashFnv32a(str: string): number {\n  let hval = 0x811c9dc5;\n  const l = str.length;\n\n  for (let i = 0; i < l; i++) {\n    hval ^= str.charCodeAt(i);\n    hval +=\n      (hval << 1) + (hval << 4) + (hval << 7) + (hval << 8) + (hval << 24);\n  }\n  return hval >>> 0;\n}\n\nexport function hash(\n  seed: string,\n  value: string,\n  version: number,\n): number | null {\n  // New unbiased hashing algorithm\n  if (version === 2) {\n    return (hashFnv32a(hashFnv32a(seed + value) + \"\") % 10000) / 10000;\n  }\n  // Original biased hashing algorithm (keep for backwards compatibility)\n  if (version === 1) {\n    return (hashFnv32a(value + seed) % 1000) / 1000;\n  }\n\n  // Unknown hash version\n  return null;\n}\n\nexport function getEqualWeights(n: number): number[] {\n  if (n <= 0) return [];\n  return new Array(n).fill(1 / n);\n}\n\nexport function inRange(n: number, range: VariationRange): boolean {\n  return n >= range[0] && n < range[1];\n}\n\nexport function inNamespace(\n  hashValue: string,\n  namespace: [string, number, number],\n): boolean {\n  const n = hash(\"__\" + namespace[0], hashValue, 1);\n  if (n === null) return false;\n  return n >= namespace[1] && n < namespace[2];\n}\n\nexport function chooseVariation(n: number, ranges: VariationRange[]): number {\n  for (let i = 0; i < ranges.length; i++) {\n    if (inRange(n, ranges[i])) {\n      return i;\n    }\n  }\n  return -1;\n}\n\nexport function getUrlRegExp(regexString: string): RegExp | undefined {\n  try {\n    const escaped = regexString.replace(/([^\\\\])\\//g, \"$1\\\\/\");\n    return new RegExp(escaped);\n  } catch (e) {\n    console.error(e);\n    return undefined;\n  }\n}\n\nexport function isURLTargeted(url: string, targets: UrlTarget[]) {\n  if (!targets.length) return false;\n  let hasIncludeRules = false;\n  let isIncluded = false;\n\n  for (let i = 0; i < targets.length; i++) {\n    const match = _evalURLTarget(url, targets[i].type, targets[i].pattern);\n    if (targets[i].include === false) {\n      if (match) return false;\n    } else {\n      hasIncludeRules = true;\n      if (match) isIncluded = true;\n    }\n  }\n\n  return isIncluded || !hasIncludeRules;\n}\n\nfunction _evalSimpleUrlPart(\n  actual: string,\n  pattern: string,\n  isPath: boolean,\n): boolean {\n  try {\n    // Escape special regex characters and change wildcard `_____` to `.*`\n    let escaped = pattern\n      .replace(/[*.+?^${}()|[\\]\\\\]/g, \"\\\\$&\")\n      .replace(/_____/g, \".*\");\n\n    if (isPath) {\n      // When matching pathname, make leading/trailing slashes optional\n      escaped = \"\\\\/?\" + escaped.replace(/(^\\/|\\/$)/g, \"\") + \"\\\\/?\";\n    }\n\n    const regex = new RegExp(\"^\" + escaped + \"$\", \"i\");\n    return regex.test(actual);\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _evalSimpleUrlTarget(actual: URL, pattern: string) {\n  try {\n    // If a protocol is missing, but a host is specified, add `https://` to the front\n    // Use \"_____\" as the wildcard since `*` is not a valid hostname in some browsers\n    const expected = new URL(\n      pattern.replace(/^([^:/?]*)\\./i, \"https://$1.\").replace(/\\*/g, \"_____\"),\n      \"https://_____\",\n    );\n\n    // Compare each part of the URL separately\n    const comps: Array<[string, string, boolean]> = [\n      [actual.host, expected.host, false],\n      [actual.pathname, expected.pathname, true],\n    ];\n    // We only want to compare hashes if it's explicitly being targeted\n    if (expected.hash) {\n      comps.push([actual.hash, expected.hash, false]);\n    }\n\n    expected.searchParams.forEach((v, k) => {\n      comps.push([actual.searchParams.get(k) || \"\", v, false]);\n    });\n\n    // If any comparisons fail, the whole thing fails\n    return !comps.some(\n      (data) => !_evalSimpleUrlPart(data[0], data[1], data[2]),\n    );\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _evalURLTarget(\n  url: string,\n  type: UrlTargetType,\n  pattern: string,\n): boolean {\n  try {\n    const parsed = new URL(url, \"https://_\");\n\n    if (type === \"regex\") {\n      const regex = getUrlRegExp(pattern);\n      if (!regex) return false;\n      return (\n        regex.test(parsed.href) ||\n        regex.test(parsed.href.substring(parsed.origin.length))\n      );\n    } else if (type === \"simple\") {\n      return _evalSimpleUrlTarget(parsed, pattern);\n    }\n\n    return false;\n  } catch (e) {\n    return false;\n  }\n}\n\nexport function getBucketRanges(\n  numVariations: number,\n  coverage: number | undefined,\n  weights?: number[],\n): VariationRange[] {\n  coverage = coverage === undefined ? 1 : coverage;\n\n  // Make sure coverage is within bounds\n  if (coverage < 0) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.coverage must be greater than or equal to 0\");\n    }\n    coverage = 0;\n  } else if (coverage > 1) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.coverage must be less than or equal to 1\");\n    }\n    coverage = 1;\n  }\n\n  // Default to equal weights if missing or invalid\n  const equal = getEqualWeights(numVariations);\n  weights = weights || equal;\n  if (weights.length !== numVariations) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\n        \"Experiment.weights array must be the same length as Experiment.variations\",\n      );\n    }\n    weights = equal;\n  }\n\n  // If weights don't add up to 1 (or close to it), default to equal weights\n  const totalWeight = weights.reduce((w, sum) => sum + w, 0);\n  if (totalWeight < 0.99 || totalWeight > 1.01) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.weights must add up to 1\");\n    }\n    weights = equal;\n  }\n\n  // Covert weights to ranges\n  let cumulative = 0;\n  return weights.map((w) => {\n    const start = cumulative;\n    cumulative += w;\n    return [start, start + (coverage as number) * w];\n  }) as VariationRange[];\n}\n\nexport function getQueryStringOverride(\n  id: string,\n  url: string,\n  numVariations: number,\n) {\n  if (!url) {\n    return null;\n  }\n\n  const search = url.split(\"?\")[1];\n  if (!search) {\n    return null;\n  }\n\n  const match = search\n    .replace(/#.*/, \"\") // Get rid of anchor\n    .split(\"&\") // Split into key/value pairs\n    .map((kv) => kv.split(\"=\", 2))\n    .filter(([k]) => k === id) // Look for key that matches the experiment id\n    .map(([, v]) => parseInt(v)); // Parse the value into an integer\n\n  if (match.length > 0 && match[0] >= 0 && match[0] < numVariations)\n    return match[0];\n\n  return null;\n}\n\nexport function isIncluded(include: () => boolean) {\n  try {\n    return include();\n  } catch (e) {\n    console.error(e);\n    return false;\n  }\n}\n\nconst base64ToBuf = (b: string) =>\n  Uint8Array.from(atob(b), (c) => c.charCodeAt(0));\n\nexport async function decrypt(\n  encryptedString: string,\n  decryptionKey?: string,\n  subtle?: SubtleCrypto,\n): Promise<string> {\n  decryptionKey = decryptionKey || \"\";\n  subtle =\n    subtle ||\n    (globalThis.crypto && globalThis.crypto.subtle) ||\n    polyfills.SubtleCrypto;\n  if (!subtle) {\n    throw new Error(\"No SubtleCrypto implementation found\");\n  }\n  try {\n    const key = await subtle.importKey(\n      \"raw\",\n      base64ToBuf(decryptionKey),\n      { name: \"AES-CBC\", length: 128 },\n      true,\n      [\"encrypt\", \"decrypt\"],\n    );\n    const [iv, cipherText] = encryptedString.split(\".\");\n    const plainTextBuffer = await subtle.decrypt(\n      { name: \"AES-CBC\", iv: base64ToBuf(iv) },\n      key,\n      base64ToBuf(cipherText),\n    );\n\n    return new TextDecoder().decode(plainTextBuffer);\n  } catch (e) {\n    throw new Error(\"Failed to decrypt\");\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function toString(input: any): string {\n  if (typeof input === \"string\") return input;\n  return JSON.stringify(input);\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function paddedVersionString(input: any): string {\n  if (typeof input === \"number\") {\n    input = input + \"\";\n  }\n  if (!input || typeof input !== \"string\") {\n    input = \"0\";\n  }\n  // Remove build info and leading `v` if any\n  // Split version into parts (both core version numbers and pre-release tags)\n  // \"v1.2.3-rc.1+build123\" -> [\"1\",\"2\",\"3\",\"rc\",\"1\"]\n  const parts = (input as string).replace(/(^v|\\+.*$)/g, \"\").split(/[-.]/);\n\n  // If it's SemVer without a pre-release, add `~` to the end\n  // [\"1\",\"0\",\"0\"] -> [\"1\",\"0\",\"0\",\"~\"]\n  // \"~\" is the largest ASCII character, so this will make \"1.0.0\" greater than \"1.0.0-beta\" for example\n  if (parts.length === 3) {\n    parts.push(\"~\");\n  }\n\n  // Left pad each numeric part with spaces so string comparisons will work (\"9\">\"10\", but \" 9\"<\"10\")\n  // Then, join back together into a single string\n  return parts\n    .map((v) => (v.match(/^[0-9]+$/) ? v.padStart(5, \" \") : v))\n    .join(\"-\");\n}\n\nexport function loadSDKVersion(): string {\n  let version: string;\n  try {\n    // @ts-expect-error right-hand value to be replaced by build with string literal\n    version = __SDK_VERSION__;\n  } catch (e) {\n    version = \"\";\n  }\n  return version;\n}\n\nexport function mergeQueryStrings(oldUrl: string, newUrl: string): string {\n  let currUrl: URL;\n  let redirectUrl: URL;\n  try {\n    currUrl = new URL(oldUrl);\n    redirectUrl = new URL(newUrl);\n  } catch (e) {\n    console.error(`Unable to merge query strings: ${e}`);\n    return newUrl;\n  }\n\n  currUrl.searchParams.forEach((value, key) => {\n    // skip  if search param already exists in redirectUrl\n    if (redirectUrl.searchParams.has(key)) {\n      return;\n    }\n    redirectUrl.searchParams.set(key, value);\n  });\n\n  return redirectUrl.toString();\n}\n\nfunction isObj(x: unknown): x is Record<string, unknown> {\n  return typeof x === \"object\" && x !== null;\n}\n\nexport function getAutoExperimentChangeType(\n  exp: AutoExperiment,\n): AutoExperimentChangeType {\n  if (\n    exp.urlPatterns &&\n    exp.variations.some(\n      (variation) => isObj(variation) && \"urlRedirect\" in variation,\n    )\n  ) {\n    return \"redirect\";\n  } else if (\n    exp.variations.some(\n      (variation) =>\n        isObj(variation) &&\n        (variation.domMutations || \"js\" in variation || \"css\" in variation),\n    )\n  ) {\n    return \"visual\";\n  }\n\n  return \"unknown\";\n}\n\n// Guarantee the promise always resolves within {timeout} ms\n// Resolved value will be `null` when there's an error or it takes too long\n// Note: The promise will continue running in the background, even if the timeout is hit\nexport async function promiseTimeout<T>(\n  promise: Promise<T>,\n  timeout?: number,\n): Promise<T | null> {\n  return new Promise((resolve) => {\n    let resolved = false;\n    let timer: NodeJS.Timeout | undefined;\n    const finish = (data?: T) => {\n      if (resolved) return;\n      resolved = true;\n      timer && clearTimeout(timer);\n      resolve(data || null);\n    };\n\n    if (timeout) {\n      timer = setTimeout(() => finish(), timeout);\n    }\n\n    promise.then((data) => finish(data)).catch(() => finish());\n  });\n}\n","import {\n  Attributes,\n  CacheSettings,\n  FeatureApiResponse,\n  FetchResponse,\n  Helpers,\n  Polyfills,\n} from \"./types/growthbook\";\nimport { getPolyfills, promiseTimeout } from \"./util\";\nimport type {\n  GrowthBook,\n  InitOptions,\n  InitSyncOptions,\n  GrowthBookClient,\n} from \".\";\n\ntype CacheEntry = {\n  data: FeatureApiResponse;\n  sse?: boolean;\n  version: string;\n  staleAt: Date;\n};\ntype ScopedChannel = {\n  src: EventSource | null;\n  cb: (event: MessageEvent<string>) => void;\n  host: string;\n  clientKey: string;\n  headers?: Record<string, string>;\n  errors: number;\n  state: \"active\" | \"idle\" | \"disabled\";\n};\n\n// Config settings\nconst cacheSettings: CacheSettings = {\n  // Consider a fetch stale after 1 minute\n  staleTTL: 1000 * 60,\n  // Max time to keep a fetch in cache (4 hours default)\n  maxAge: 1000 * 60 * 60 * 4,\n  cacheKey: \"gbFeaturesCache\",\n  backgroundSync: true,\n  maxEntries: 10,\n  disableIdleStreams: false,\n  idleStreamInterval: 20000,\n  disableCache: false,\n};\n\nconst polyfills = getPolyfills();\n\nexport const helpers: Helpers = {\n  fetchFeaturesCall: ({ host, clientKey, headers }) => {\n    return (polyfills.fetch as typeof globalThis.fetch)(\n      `${host}/api/features/${clientKey}`,\n      { headers },\n    );\n  },\n  fetchRemoteEvalCall: ({ host, clientKey, payload, headers }) => {\n    const options = {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\", ...headers },\n      body: JSON.stringify(payload),\n    };\n    return (polyfills.fetch as typeof globalThis.fetch)(\n      `${host}/api/eval/${clientKey}`,\n      options,\n    );\n  },\n  eventSourceCall: ({ host, clientKey, headers }) => {\n    if (headers) {\n      return new polyfills.EventSource(`${host}/sub/${clientKey}`, {\n        headers,\n      });\n    }\n    return new polyfills.EventSource(`${host}/sub/${clientKey}`);\n  },\n  startIdleListener: () => {\n    let idleTimeout: number | undefined;\n    const isBrowser =\n      typeof window !== \"undefined\" && typeof document !== \"undefined\";\n    if (!isBrowser) return;\n    const onVisibilityChange = () => {\n      if (document.visibilityState === \"visible\") {\n        window.clearTimeout(idleTimeout);\n        onVisible();\n      } else if (document.visibilityState === \"hidden\") {\n        idleTimeout = window.setTimeout(\n          onHidden,\n          cacheSettings.idleStreamInterval,\n        );\n      }\n    };\n    document.addEventListener(\"visibilitychange\", onVisibilityChange);\n    return () =>\n      document.removeEventListener(\"visibilitychange\", onVisibilityChange);\n  },\n  stopIdleListener: () => {\n    // No-op, replaced by startIdleListener\n  },\n};\n\ntry {\n  if (globalThis.localStorage) {\n    polyfills.localStorage = globalThis.localStorage;\n  }\n} catch (e) {\n  // Ignore localStorage errors\n}\n\n// Global state\nconst subscribedInstances: Map<\n  string,\n  Set<GrowthBook | GrowthBookClient>\n> = new Map();\nlet cacheInitialized = false;\nconst cache: Map<string, CacheEntry> = new Map();\nconst activeFetches: Map<string, Promise<FetchResponse>> = new Map();\nconst streams: Map<string, ScopedChannel> = new Map();\nconst supportsSSE: Set<string> = new Set();\n\n// Public functions\nexport function setPolyfills(overrides: Partial<Polyfills>): void {\n  Object.assign(polyfills, overrides);\n}\nexport function configureCache(overrides: Partial<CacheSettings>): void {\n  Object.assign(cacheSettings, overrides);\n  if (!cacheSettings.backgroundSync) {\n    clearAutoRefresh();\n  }\n}\n\nexport async function clearCache(): Promise<void> {\n  cache.clear();\n  activeFetches.clear();\n  clearAutoRefresh();\n  cacheInitialized = false;\n  await updatePersistentCache();\n}\n\n// Get or fetch features and refresh the SDK instance\nexport async function refreshFeatures({\n  instance,\n  timeout,\n  skipCache,\n  allowStale,\n  backgroundSync,\n}: {\n  instance: GrowthBook | GrowthBookClient;\n  timeout?: number;\n  skipCache?: boolean;\n  allowStale?: boolean;\n  backgroundSync?: boolean;\n}): Promise<FetchResponse> {\n  if (!backgroundSync) {\n    cacheSettings.backgroundSync = false;\n  }\n\n  return fetchFeaturesWithCache({\n    instance,\n    allowStale,\n    timeout,\n    skipCache,\n  });\n}\n\n// Subscribe a GrowthBook instance to feature changes\nfunction subscribe(instance: GrowthBook | GrowthBookClient): void {\n  const key = getKey(instance);\n  const subs = subscribedInstances.get(key) || new Set();\n  subs.add(instance);\n  subscribedInstances.set(key, subs);\n}\nexport function unsubscribe(instance: GrowthBook | GrowthBookClient): void {\n  subscribedInstances.forEach((s) => s.delete(instance));\n}\n\nexport function onHidden() {\n  streams.forEach((channel) => {\n    if (!channel) return;\n    channel.state = \"idle\";\n    disableChannel(channel);\n  });\n}\n\nexport function onVisible() {\n  streams.forEach((channel) => {\n    if (!channel) return;\n    if (channel.state !== \"idle\") return;\n    enableChannel(channel);\n  });\n}\n\n// Private functions\n\nasync function updatePersistentCache() {\n  try {\n    if (!polyfills.localStorage) return;\n    await polyfills.localStorage.setItem(\n      cacheSettings.cacheKey,\n      JSON.stringify(Array.from(cache.entries())),\n    );\n  } catch (e) {\n    // Ignore localStorage errors\n  }\n}\n\n// SWR wrapper for fetching features. May indirectly or directly start SSE streaming.\nasync function fetchFeaturesWithCache({\n  instance,\n  allowStale,\n  timeout,\n  skipCache,\n}: {\n  instance: GrowthBook | GrowthBookClient;\n  allowStale?: boolean;\n  timeout?: number;\n  skipCache?: boolean;\n}): Promise<FetchResponse> {\n  const key = getKey(instance);\n  const cacheKey = getCacheKey(instance);\n  const now = new Date();\n\n  const minStaleAt = new Date(\n    now.getTime() - cacheSettings.maxAge + cacheSettings.staleTTL,\n  );\n\n  await initializeCache();\n  const existing =\n    !cacheSettings.disableCache && !skipCache ? cache.get(cacheKey) : undefined;\n  if (\n    existing &&\n    (allowStale || existing.staleAt > now) &&\n    existing.staleAt > minStaleAt\n  ) {\n    // Restore from cache whether SSE is supported\n    if (existing.sse) supportsSSE.add(key);\n\n    // Reload features in the background if stale\n    if (existing.staleAt < now) {\n      fetchFeatures(instance);\n    }\n    // Otherwise, if we don't need to refresh now, start a background sync\n    else {\n      startAutoRefresh(instance);\n    }\n    return { data: existing.data, success: true, source: \"cache\" };\n  } else {\n    const res = await promiseTimeout(fetchFeatures(instance), timeout);\n    return (\n      res || {\n        data: null,\n        success: false,\n        source: \"timeout\",\n        error: new Error(\"Timeout\"),\n      }\n    );\n  }\n}\n\nfunction getKey(instance: GrowthBook | GrowthBookClient): string {\n  const [apiHost, clientKey] = instance.getApiInfo();\n  return `${apiHost}||${clientKey}`;\n}\n\nfunction getCacheKey(instance: GrowthBook | GrowthBookClient): string {\n  const baseKey = getKey(instance);\n  if (!(\"isRemoteEval\" in instance) || !instance.isRemoteEval()) return baseKey;\n\n  const attributes = instance.getAttributes();\n  const cacheKeyAttributes =\n    instance.getCacheKeyAttributes() || Object.keys(instance.getAttributes());\n  const ca: Attributes = {};\n  cacheKeyAttributes.forEach((key) => {\n    ca[key] = attributes[key];\n  });\n\n  const fv = instance.getForcedVariations();\n  const url = instance.getUrl();\n\n  return `${baseKey}||${JSON.stringify({\n    ca,\n    fv,\n    url,\n  })}`;\n}\n\n// Populate cache from localStorage (if available)\nasync function initializeCache(): Promise<void> {\n  if (cacheInitialized) return;\n  cacheInitialized = true;\n  try {\n    if (polyfills.localStorage) {\n      const value = await polyfills.localStorage.getItem(\n        cacheSettings.cacheKey,\n      );\n      if (!cacheSettings.disableCache && value) {\n        const parsed: [string, CacheEntry][] = JSON.parse(value);\n        if (parsed && Array.isArray(parsed)) {\n          parsed.forEach(([key, data]) => {\n            cache.set(key, {\n              ...data,\n              staleAt: new Date(data.staleAt),\n            });\n          });\n        }\n        cleanupCache();\n      }\n    }\n  } catch (e) {\n    // Ignore localStorage errors\n  }\n  if (!cacheSettings.disableIdleStreams) {\n    const cleanupFn = helpers.startIdleListener();\n    if (cleanupFn) {\n      helpers.stopIdleListener = cleanupFn;\n    }\n  }\n}\n\n// Enforce the maxEntries limit\nfunction cleanupCache() {\n  const entriesWithTimestamps = Array.from(cache.entries())\n    .map(([key, value]) => ({\n      key,\n      staleAt: value.staleAt.getTime(),\n    }))\n    .sort((a, b) => a.staleAt - b.staleAt);\n\n  const entriesToRemoveCount = Math.min(\n    Math.max(0, cache.size - cacheSettings.maxEntries),\n    cache.size,\n  );\n\n  for (let i = 0; i < entriesToRemoveCount; i++) {\n    cache.delete(entriesWithTimestamps[i].key);\n  }\n}\n\n// Called whenever new features are fetched from the API\nfunction onNewFeatureData(\n  key: string,\n  cacheKey: string,\n  data: FeatureApiResponse,\n): void {\n  // If contents haven't changed, ignore the update, extend the stale TTL\n  const version = data.dateUpdated || \"\";\n  const staleAt = new Date(Date.now() + cacheSettings.staleTTL);\n  const existing = !cacheSettings.disableCache\n    ? cache.get(cacheKey)\n    : undefined;\n  if (existing && version && existing.version === version) {\n    existing.staleAt = staleAt;\n    updatePersistentCache();\n    return;\n  }\n\n  if (!cacheSettings.disableCache) {\n    // Update in-memory cache\n    cache.set(cacheKey, {\n      data,\n      version,\n      staleAt,\n      sse: supportsSSE.has(key),\n    });\n    cleanupCache();\n  }\n  // Update local storage (don't await this, just update asynchronously)\n  updatePersistentCache();\n\n  // Update features for all subscribed GrowthBook instances\n  const instances = subscribedInstances.get(key);\n  instances && instances.forEach((instance) => refreshInstance(instance, data));\n}\n\nasync function refreshInstance(\n  instance: GrowthBook | GrowthBookClient,\n  data: FeatureApiResponse | null,\n): Promise<void> {\n  await instance.setPayload(data || instance.getPayload());\n}\n\n// Fetch the features payload from helper function or from in-mem injected payload\nasync function fetchFeatures(\n  instance: GrowthBook | GrowthBookClient,\n): Promise<FetchResponse> {\n  const { apiHost, apiRequestHeaders } = instance.getApiHosts();\n  const clientKey = instance.getClientKey();\n  const remoteEval = \"isRemoteEval\" in instance && instance.isRemoteEval();\n  const key = getKey(instance);\n  const cacheKey = getCacheKey(instance);\n\n  let promise = activeFetches.get(cacheKey);\n  if (!promise) {\n    const fetcher: Promise<Response> = remoteEval\n      ? helpers.fetchRemoteEvalCall({\n          host: apiHost,\n          clientKey,\n          payload: {\n            attributes: instance.getAttributes(),\n            forcedVariations: instance.getForcedVariations(),\n            forcedFeatures: Array.from(instance.getForcedFeatures().entries()),\n            url: instance.getUrl(),\n          },\n          headers: apiRequestHeaders,\n        })\n      : helpers.fetchFeaturesCall({\n          host: apiHost,\n          clientKey,\n          headers: apiRequestHeaders,\n        });\n\n    // TODO: auto-retry if status code indicates a temporary error\n    promise = fetcher\n      .then((res) => {\n        if (!res.ok) {\n          throw new Error(`HTTP error: ${res.status}`);\n        }\n        if (res.headers.get(\"x-sse-support\") === \"enabled\") {\n          supportsSSE.add(key);\n        }\n        return res.json();\n      })\n      .then((data: FeatureApiResponse) => {\n        onNewFeatureData(key, cacheKey, data);\n        startAutoRefresh(instance);\n        activeFetches.delete(cacheKey);\n        return { data, success: true, source: \"network\" as const };\n      })\n      .catch((e) => {\n        process.env.NODE_ENV !== \"production\" &&\n          instance.log(\"Error fetching features\", {\n            apiHost,\n            clientKey,\n            error: e ? e.message : null,\n          });\n        activeFetches.delete(cacheKey);\n\n        return {\n          data: null,\n          source: \"error\" as const,\n          success: false,\n          error: e,\n        };\n      });\n    activeFetches.set(cacheKey, promise);\n  }\n  return promise;\n}\n\n// Start SSE streaming, listens to feature payload changes and triggers a refresh or re-fetch\nfunction startAutoRefresh(\n  instance: GrowthBook | GrowthBookClient,\n  forceSSE: boolean = false,\n): void {\n  const key = getKey(instance);\n  const cacheKey = getCacheKey(instance);\n  const { streamingHost, streamingHostRequestHeaders } = instance.getApiHosts();\n  const clientKey = instance.getClientKey();\n\n  if (forceSSE) {\n    supportsSSE.add(key);\n  }\n\n  if (\n    cacheSettings.backgroundSync &&\n    supportsSSE.has(key) &&\n    polyfills.EventSource\n  ) {\n    if (streams.has(key)) return;\n    const channel: ScopedChannel = {\n      src: null,\n      host: streamingHost,\n      clientKey,\n      headers: streamingHostRequestHeaders,\n      cb: (event: MessageEvent<string>) => {\n        try {\n          if (event.type === \"features-updated\") {\n            const instances = subscribedInstances.get(key);\n            instances &&\n              instances.forEach((instance) => {\n                fetchFeatures(instance);\n              });\n          } else if (event.type === \"features\") {\n            const json: FeatureApiResponse = JSON.parse(event.data);\n            onNewFeatureData(key, cacheKey, json);\n          }\n          // Reset error count on success\n          channel.errors = 0;\n        } catch (e) {\n          process.env.NODE_ENV !== \"production\" &&\n            instance.log(\"SSE Error\", {\n              streamingHost,\n              clientKey,\n              error: e ? (e as Error).message : null,\n            });\n          onSSEError(channel);\n        }\n      },\n      errors: 0,\n      state: \"active\",\n    };\n    streams.set(key, channel);\n    enableChannel(channel);\n  }\n}\n\nfunction onSSEError(channel: ScopedChannel) {\n  if (channel.state === \"idle\") return;\n  channel.errors++;\n  if (channel.errors > 3 || (channel.src && channel.src.readyState === 2)) {\n    // exponential backoff after 4 errors, with jitter\n    const delay =\n      Math.pow(3, channel.errors - 3) * (1000 + Math.random() * 1000);\n    disableChannel(channel);\n    setTimeout(\n      () => {\n        if ([\"idle\", \"active\"].includes(channel.state)) return;\n        enableChannel(channel);\n      },\n      Math.min(delay, 300000),\n    ); // 5 minutes max\n  }\n}\n\nfunction disableChannel(channel: ScopedChannel) {\n  if (!channel.src) return;\n  channel.src.onopen = null;\n  channel.src.onerror = null;\n  channel.src.close();\n  channel.src = null;\n  if (channel.state === \"active\") {\n    channel.state = \"disabled\";\n  }\n}\n\nfunction enableChannel(channel: ScopedChannel) {\n  channel.src = helpers.eventSourceCall({\n    host: channel.host,\n    clientKey: channel.clientKey,\n    headers: channel.headers,\n  }) as EventSource;\n  channel.state = \"active\";\n  channel.src.addEventListener(\"features\", channel.cb);\n  channel.src.addEventListener(\"features-updated\", channel.cb);\n  channel.src.onerror = () => onSSEError(channel);\n  channel.src.onopen = () => {\n    channel.errors = 0;\n  };\n}\n\nfunction destroyChannel(channel: ScopedChannel, key: string) {\n  disableChannel(channel);\n  streams.delete(key);\n}\n\nexport function clearAutoRefresh() {\n  // Clear list of which keys are auto-updated\n  supportsSSE.clear();\n\n  // Stop listening for any SSE events\n  streams.forEach(destroyChannel);\n\n  // Remove all references to GrowthBook instances\n  subscribedInstances.clear();\n\n  // Run the idle stream cleanup function\n  helpers.stopIdleListener();\n}\n\nexport function startStreaming(\n  instance: GrowthBook | GrowthBookClient,\n  options: InitOptions | InitSyncOptions,\n) {\n  if (options.streaming) {\n    if (!instance.getClientKey()) {\n      throw new Error(\"Must specify clientKey to enable streaming\");\n    }\n    if (options.payload) {\n      startAutoRefresh(instance, true);\n    }\n    subscribe(instance);\n  }\n}\n","var validAttributeName = /^[a-zA-Z:_][a-zA-Z0-9:_.-]*$/;\nvar nullController = {\n  revert: function revert() {}\n};\nvar elements = /*#__PURE__*/new Map();\nvar mutations = /*#__PURE__*/new Set();\n\nfunction getObserverInit(attr) {\n  return attr === 'html' ? {\n    childList: true,\n    subtree: true,\n    attributes: true,\n    characterData: true\n  } : {\n    childList: false,\n    subtree: false,\n    attributes: true,\n    attributeFilter: [attr]\n  };\n}\n\nfunction getElementRecord(element) {\n  var record = elements.get(element);\n\n  if (!record) {\n    record = {\n      element: element,\n      attributes: {}\n    };\n    elements.set(element, record);\n  }\n\n  return record;\n}\n\nfunction createElementPropertyRecord(el, attr, getCurrentValue, setValue, mutationRunner) {\n  var currentValue = getCurrentValue(el);\n  var record = {\n    isDirty: false,\n    originalValue: currentValue,\n    virtualValue: currentValue,\n    mutations: [],\n    el: el,\n    _positionTimeout: null,\n    observer: new MutationObserver(function () {\n      // enact a 1 second timeout that blocks subsequent firing of the\n      // observer until the timeout is complete. This will prevent multiple\n      // mutations from firing in quick succession, which can cause the\n      // mutation to be reverted before the DOM has a chance to update.\n      if (attr === 'position' && record._positionTimeout) return;else if (attr === 'position') record._positionTimeout = setTimeout(function () {\n        record._positionTimeout = null;\n      }, 1000);\n      var currentValue = getCurrentValue(el);\n      if (attr === 'position' && currentValue.parentNode === record.virtualValue.parentNode && currentValue.insertBeforeNode === record.virtualValue.insertBeforeNode) return;\n      if (currentValue === record.virtualValue) return;\n      record.originalValue = currentValue;\n      mutationRunner(record);\n    }),\n    mutationRunner: mutationRunner,\n    setValue: setValue,\n    getCurrentValue: getCurrentValue\n  };\n\n  if (attr === 'position' && el.parentNode) {\n    record.observer.observe(el.parentNode, {\n      childList: true,\n      subtree: true,\n      attributes: false,\n      characterData: false\n    });\n  } else {\n    record.observer.observe(el, getObserverInit(attr));\n  }\n\n  return record;\n}\n\nfunction queueIfNeeded(val, record) {\n  var currentVal = record.getCurrentValue(record.el);\n  record.virtualValue = val;\n\n  if (val && typeof val !== 'string') {\n    if (!currentVal || val.parentNode !== currentVal.parentNode || val.insertBeforeNode !== currentVal.insertBeforeNode) {\n      record.isDirty = true;\n      runDOMUpdates();\n    }\n  } else if (val !== currentVal) {\n    record.isDirty = true;\n    runDOMUpdates();\n  }\n}\n\nfunction htmlMutationRunner(record) {\n  var val = record.originalValue;\n  record.mutations.forEach(function (m) {\n    return val = m.mutate(val);\n  });\n  queueIfNeeded(getTransformedHTML(val), record);\n}\n\nfunction classMutationRunner(record) {\n  var val = new Set(record.originalValue.split(/\\s+/).filter(Boolean));\n  record.mutations.forEach(function (m) {\n    return m.mutate(val);\n  });\n  queueIfNeeded(Array.from(val).filter(Boolean).join(' '), record);\n}\n\nfunction attrMutationRunner(record) {\n  var val = record.originalValue;\n  record.mutations.forEach(function (m) {\n    return val = m.mutate(val);\n  });\n  queueIfNeeded(val, record);\n}\n\nfunction _loadDOMNodes(_ref) {\n  var parentSelector = _ref.parentSelector,\n      insertBeforeSelector = _ref.insertBeforeSelector;\n  var parentNode = document.querySelector(parentSelector);\n  if (!parentNode) return null;\n  var insertBeforeNode = insertBeforeSelector ? document.querySelector(insertBeforeSelector) : null;\n  if (insertBeforeSelector && !insertBeforeNode) return null;\n  return {\n    parentNode: parentNode,\n    insertBeforeNode: insertBeforeNode\n  };\n}\n\nfunction positionMutationRunner(record) {\n  var val = record.originalValue;\n  record.mutations.forEach(function (m) {\n    var selectors = m.mutate();\n\n    var newNodes = _loadDOMNodes(selectors);\n\n    val = newNodes || val;\n  });\n  queueIfNeeded(val, record);\n}\n\nvar getHTMLValue = function getHTMLValue(el) {\n  return el.innerHTML;\n};\n\nvar setHTMLValue = function setHTMLValue(el, value) {\n  return el.innerHTML = value;\n};\n\nfunction getElementHTMLRecord(element) {\n  var elementRecord = getElementRecord(element);\n\n  if (!elementRecord.html) {\n    elementRecord.html = createElementPropertyRecord(element, 'html', getHTMLValue, setHTMLValue, htmlMutationRunner);\n  }\n\n  return elementRecord.html;\n}\n\nvar getElementPosition = function getElementPosition(el) {\n  return {\n    parentNode: el.parentElement,\n    insertBeforeNode: el.nextElementSibling\n  };\n};\n\nvar setElementPosition = function setElementPosition(el, value) {\n  if (value.insertBeforeNode && !value.parentNode.contains(value.insertBeforeNode)) {\n    // skip position mutation - insertBeforeNode not a child of parent. happens\n    // when mutation observer for indvidual element fires out of order\n    return;\n  }\n\n  value.parentNode.insertBefore(el, value.insertBeforeNode);\n};\n\nfunction getElementPositionRecord(element) {\n  var elementRecord = getElementRecord(element);\n\n  if (!elementRecord.position) {\n    elementRecord.position = createElementPropertyRecord(element, 'position', getElementPosition, setElementPosition, positionMutationRunner);\n  }\n\n  return elementRecord.position;\n}\n\nvar setClassValue = function setClassValue(el, val) {\n  return val ? el.className = val : el.removeAttribute('class');\n};\n\nvar getClassValue = function getClassValue(el) {\n  return el.className;\n};\n\nfunction getElementClassRecord(el) {\n  var elementRecord = getElementRecord(el);\n\n  if (!elementRecord.classes) {\n    elementRecord.classes = createElementPropertyRecord(el, 'class', getClassValue, setClassValue, classMutationRunner);\n  }\n\n  return elementRecord.classes;\n}\n\nvar getAttrValue = function getAttrValue(attrName) {\n  return function (el) {\n    var _el$getAttribute;\n\n    return (_el$getAttribute = el.getAttribute(attrName)) != null ? _el$getAttribute : null;\n  };\n};\n\nvar setAttrValue = function setAttrValue(attrName) {\n  return function (el, val) {\n    return val !== null ? el.setAttribute(attrName, val) : el.removeAttribute(attrName);\n  };\n};\n\nfunction getElementAttributeRecord(el, attr) {\n  var elementRecord = getElementRecord(el);\n\n  if (!elementRecord.attributes[attr]) {\n    elementRecord.attributes[attr] = createElementPropertyRecord(el, attr, getAttrValue(attr), setAttrValue(attr), attrMutationRunner);\n  }\n\n  return elementRecord.attributes[attr];\n}\n\nfunction deleteElementPropertyRecord(el, attr) {\n  var element = elements.get(el);\n  if (!element) return;\n\n  if (attr === 'html') {\n    var _element$html, _element$html$observe;\n\n    (_element$html = element.html) == null ? void 0 : (_element$html$observe = _element$html.observer) == null ? void 0 : _element$html$observe.disconnect();\n    delete element.html;\n  } else if (attr === 'class') {\n    var _element$classes, _element$classes$obse;\n\n    (_element$classes = element.classes) == null ? void 0 : (_element$classes$obse = _element$classes.observer) == null ? void 0 : _element$classes$obse.disconnect();\n    delete element.classes;\n  } else if (attr === 'position') {\n    var _element$position, _element$position$obs;\n\n    (_element$position = element.position) == null ? void 0 : (_element$position$obs = _element$position.observer) == null ? void 0 : _element$position$obs.disconnect();\n    delete element.position;\n  } else {\n    var _element$attributes, _element$attributes$a, _element$attributes$a2;\n\n    (_element$attributes = element.attributes) == null ? void 0 : (_element$attributes$a = _element$attributes[attr]) == null ? void 0 : (_element$attributes$a2 = _element$attributes$a.observer) == null ? void 0 : _element$attributes$a2.disconnect();\n    delete element.attributes[attr];\n  }\n}\n\nvar transformContainer;\n\nfunction getTransformedHTML(html) {\n  if (!transformContainer) {\n    transformContainer = document.createElement('div');\n  }\n\n  transformContainer.innerHTML = html;\n  return transformContainer.innerHTML;\n}\n\nfunction setPropertyValue(el, attr, m) {\n  if (!m.isDirty) return;\n  m.isDirty = false;\n  var val = m.virtualValue;\n\n  if (!m.mutations.length) {\n    deleteElementPropertyRecord(el, attr);\n  }\n\n  m.setValue(el, val);\n}\n\nfunction setValue(m, el) {\n  m.html && setPropertyValue(el, 'html', m.html);\n  m.classes && setPropertyValue(el, 'class', m.classes);\n  m.position && setPropertyValue(el, 'position', m.position);\n  Object.keys(m.attributes).forEach(function (attr) {\n    setPropertyValue(el, attr, m.attributes[attr]);\n  });\n}\n\nfunction runDOMUpdates() {\n  elements.forEach(setValue);\n} // find or create ElementPropertyRecord, add mutation to it, then run\n\n\nfunction startMutating(mutation, element) {\n  var record = null;\n\n  if (mutation.kind === 'html') {\n    record = getElementHTMLRecord(element);\n  } else if (mutation.kind === 'class') {\n    record = getElementClassRecord(element);\n  } else if (mutation.kind === 'attribute') {\n    record = getElementAttributeRecord(element, mutation.attribute);\n  } else if (mutation.kind === 'position') {\n    record = getElementPositionRecord(element);\n  }\n\n  if (!record) return;\n  record.mutations.push(mutation);\n  record.mutationRunner(record);\n} // get (existing) ElementPropertyRecord, remove mutation from it, then run\n\n\nfunction stopMutating(mutation, el) {\n  var record = null;\n\n  if (mutation.kind === 'html') {\n    record = getElementHTMLRecord(el);\n  } else if (mutation.kind === 'class') {\n    record = getElementClassRecord(el);\n  } else if (mutation.kind === 'attribute') {\n    record = getElementAttributeRecord(el, mutation.attribute);\n  } else if (mutation.kind === 'position') {\n    record = getElementPositionRecord(el);\n  }\n\n  if (!record) return;\n  var index = record.mutations.indexOf(mutation);\n  if (index !== -1) record.mutations.splice(index, 1);\n  record.mutationRunner(record);\n} // maintain list of elements associated with mutation\n\n\nfunction refreshElementsSet(mutation) {\n  // if a position mutation has already found an element to move, don't move\n  // any more elements\n  if (mutation.kind === 'position' && mutation.elements.size === 1) return;\n  var existingElements = new Set(mutation.elements);\n  var matchingElements = document.querySelectorAll(mutation.selector);\n  matchingElements.forEach(function (el) {\n    if (!existingElements.has(el)) {\n      mutation.elements.add(el);\n      startMutating(mutation, el);\n    }\n  });\n}\n\nfunction revertMutation(mutation) {\n  mutation.elements.forEach(function (el) {\n    return stopMutating(mutation, el);\n  });\n  mutation.elements.clear();\n  mutations[\"delete\"](mutation);\n}\n\nfunction refreshAllElementSets() {\n  mutations.forEach(refreshElementsSet);\n} // Observer for elements that don't exist in the DOM yet\n\n\nvar observer;\nfunction disconnectGlobalObserver() {\n  observer && observer.disconnect();\n}\nfunction connectGlobalObserver() {\n  if (typeof document === 'undefined') return;\n\n  if (!observer) {\n    observer = new MutationObserver(function () {\n      refreshAllElementSets();\n    });\n  }\n\n  refreshAllElementSets();\n  observer.observe(document.documentElement, {\n    childList: true,\n    subtree: true,\n    attributes: false,\n    characterData: false\n  });\n} // run on init\n\nconnectGlobalObserver();\n\nfunction newMutation(m) {\n  // Not in a browser\n  if (typeof document === 'undefined') return nullController; // add to global index of mutations\n\n  mutations.add(m); // run refresh on init to establish list of elements associated w/ mutation\n\n  refreshElementsSet(m);\n  return {\n    revert: function revert() {\n      revertMutation(m);\n    }\n  };\n}\n\nfunction html(selector, mutate) {\n  return newMutation({\n    kind: 'html',\n    elements: new Set(),\n    mutate: mutate,\n    selector: selector\n  });\n}\n\nfunction position(selector, mutate) {\n  return newMutation({\n    kind: 'position',\n    elements: new Set(),\n    mutate: mutate,\n    selector: selector\n  });\n}\n\nfunction classes(selector, mutate) {\n  return newMutation({\n    kind: 'class',\n    elements: new Set(),\n    mutate: mutate,\n    selector: selector\n  });\n}\n\nfunction attribute(selector, attribute, mutate) {\n  if (!validAttributeName.test(attribute)) return nullController;\n\n  if (attribute === 'class' || attribute === 'className') {\n    return classes(selector, function (classnames) {\n      var mutatedClassnames = mutate(Array.from(classnames).join(' '));\n      classnames.clear();\n      if (!mutatedClassnames) return;\n      mutatedClassnames.split(/\\s+/g).filter(Boolean).forEach(function (c) {\n        return classnames.add(c);\n      });\n    });\n  }\n\n  return newMutation({\n    kind: 'attribute',\n    attribute: attribute,\n    elements: new Set(),\n    mutate: mutate,\n    selector: selector\n  });\n}\n\nfunction declarative(_ref2) {\n  var selector = _ref2.selector,\n      action = _ref2.action,\n      value = _ref2.value,\n      attr = _ref2.attribute,\n      parentSelector = _ref2.parentSelector,\n      insertBeforeSelector = _ref2.insertBeforeSelector;\n\n  if (attr === 'html') {\n    if (action === 'append') {\n      return html(selector, function (val) {\n        return val + (value != null ? value : '');\n      });\n    } else if (action === 'set') {\n      return html(selector, function () {\n        return value != null ? value : '';\n      });\n    }\n  } else if (attr === 'class') {\n    if (action === 'append') {\n      return classes(selector, function (val) {\n        if (value) val.add(value);\n      });\n    } else if (action === 'remove') {\n      return classes(selector, function (val) {\n        if (value) val[\"delete\"](value);\n      });\n    } else if (action === 'set') {\n      return classes(selector, function (val) {\n        val.clear();\n        if (value) val.add(value);\n      });\n    }\n  } else if (attr === 'position') {\n    if (action === 'set' && parentSelector) {\n      return position(selector, function () {\n        return {\n          insertBeforeSelector: insertBeforeSelector,\n          parentSelector: parentSelector\n        };\n      });\n    }\n  } else {\n    if (action === 'append') {\n      return attribute(selector, attr, function (val) {\n        return val !== null ? val + (value != null ? value : '') : value != null ? value : '';\n      });\n    } else if (action === 'set') {\n      return attribute(selector, attr, function () {\n        return value != null ? value : '';\n      });\n    } else if (action === 'remove') {\n      return attribute(selector, attr, function () {\n        return null;\n      });\n    }\n  }\n\n  return nullController;\n}\n\nvar index = {\n  html: html,\n  classes: classes,\n  attribute: attribute,\n  position: position,\n  declarative: declarative\n};\n\nexport default index;\nexport { connectGlobalObserver, disconnectGlobalObserver, validAttributeName };\n//# sourceMappingURL=dom-mutator.esm.js.map\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n\nimport { SavedGroupsValues } from \"./types/growthbook\";\nimport {\n  ConditionInterface,\n  TestedObj,\n  ConditionValue,\n  Operator,\n  OperatorConditionValue,\n  VarType,\n} from \"./types/mongrule\";\nimport { paddedVersionString } from \"./util\";\n\nconst _regexCache: { [key: string]: RegExp } = {};\n\n// The top-level condition evaluation function\nexport function evalCondition(\n  obj: TestedObj,\n  condition: ConditionInterface,\n  // Must be included for `condition` to correctly evaluate group Operators\n  savedGroups?: SavedGroupsValues,\n): boolean {\n  savedGroups = savedGroups || {};\n  // Condition is an object, keys are either specific operators or object paths\n  // values are either arguments for operators or conditions for paths\n  for (const [k, v] of Object.entries(condition)) {\n    switch (k) {\n      case \"$or\":\n        if (!evalOr(obj, v as ConditionInterface[], savedGroups)) return false;\n        break;\n      case \"$nor\":\n        if (evalOr(obj, v as ConditionInterface[], savedGroups)) return false;\n        break;\n      case \"$and\":\n        if (!evalAnd(obj, v as ConditionInterface[], savedGroups)) return false;\n        break;\n      case \"$not\":\n        if (evalCondition(obj, v as ConditionInterface, savedGroups))\n          return false;\n        break;\n      default:\n        if (!evalConditionValue(v, getPath(obj, k), savedGroups)) return false;\n    }\n  }\n  return true;\n}\n\n// Return value at dot-separated path of an object\nfunction getPath(obj: TestedObj, path: string) {\n  const parts = path.split(\".\");\n  let current: any = obj;\n  for (let i = 0; i < parts.length; i++) {\n    if (current && typeof current === \"object\" && parts[i] in current) {\n      current = current[parts[i]];\n    } else {\n      return null;\n    }\n  }\n  return current;\n}\n\n// Transform a regex string into a real RegExp object\nfunction getRegex(regex: string, insensitive = false): RegExp {\n  const cacheKey = `${regex}${insensitive ? \"/i\" : \"\"}`;\n  if (!_regexCache[cacheKey]) {\n    _regexCache[cacheKey] = new RegExp(\n      regex.replace(/([^\\\\])\\//g, \"$1\\\\/\"),\n      insensitive ? \"i\" : undefined,\n    );\n  }\n  return _regexCache[cacheKey];\n}\n\n// Evaluate a single value against a condition\nfunction evalConditionValue(\n  condition: ConditionValue,\n  value: any,\n  savedGroups: SavedGroupsValues,\n  insensitive: boolean = false,\n) {\n  // Simple equality comparisons\n  if (typeof condition === \"string\") {\n    if (insensitive) {\n      return String(value).toLowerCase() === condition.toLowerCase();\n    }\n    return value + \"\" === condition;\n  }\n  if (typeof condition === \"number\") {\n    return value * 1 === condition;\n  }\n  if (typeof condition === \"boolean\") {\n    return value !== null && !!value === condition;\n  }\n\n  if (condition === null) {\n    return value === null;\n  }\n\n  if (Array.isArray(condition) || !isOperatorObject(condition)) {\n    return JSON.stringify(value) === JSON.stringify(condition);\n  }\n\n  // This is a special operator condition and we should evaluate each one separately\n  for (const op in condition) {\n    if (\n      !evalOperatorCondition(\n        op as Operator,\n        value,\n        condition[op as keyof OperatorConditionValue],\n        savedGroups,\n      )\n    ) {\n      return false;\n    }\n  }\n  return true;\n}\n\n// If the object has only keys that start with '$'\nfunction isOperatorObject(obj: any): boolean {\n  const keys = Object.keys(obj);\n  return (\n    keys.length > 0 && keys.filter((k) => k[0] === \"$\").length === keys.length\n  );\n}\n\n// Return the data type of a value\nfunction getType(v: any): VarType | \"unknown\" {\n  if (v === null) return \"null\";\n  if (Array.isArray(v)) return \"array\";\n  const t = typeof v;\n  if ([\"string\", \"number\", \"boolean\", \"object\", \"undefined\"].includes(t)) {\n    return t as VarType;\n  }\n  return \"unknown\";\n}\n\n// At least one element of actual must match the expected condition/value\nfunction elemMatch(actual: any, expected: any, savedGroups: SavedGroupsValues) {\n  if (!Array.isArray(actual)) return false;\n  const check = isOperatorObject(expected)\n    ? (v: any) => evalConditionValue(expected, v, savedGroups)\n    : (v: any) => evalCondition(v, expected, savedGroups);\n  for (let i = 0; i < actual.length; i++) {\n    if (actual[i] && check(actual[i])) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction isIn(\n  actual: any,\n  expected: Array<any>,\n  insensitive: boolean = false,\n): boolean {\n  if (insensitive) {\n    const caseFold = (val: any) =>\n      typeof val === \"string\" ? val.toLowerCase() : val;\n    // Do an intersection if attribute is an array (insensitive)\n    if (Array.isArray(actual)) {\n      return actual.some((el) =>\n        expected.some((exp) => caseFold(el) === caseFold(exp)),\n      );\n    }\n    return expected.some((exp) => caseFold(actual) === caseFold(exp));\n  }\n  // Do an intersection if attribute is an array\n  if (Array.isArray(actual)) {\n    return actual.some((el) => expected.includes(el));\n  }\n  return expected.includes(actual);\n}\n\nfunction isInAll(\n  actual: any,\n  expected: ConditionValue[],\n  savedGroups: SavedGroupsValues,\n  insensitive: boolean = false,\n): boolean {\n  if (!Array.isArray(actual)) return false;\n  for (let i = 0; i < expected.length; i++) {\n    let passed = false;\n    for (let j = 0; j < actual.length; j++) {\n      if (\n        evalConditionValue(expected[i], actual[j], savedGroups, insensitive)\n      ) {\n        passed = true;\n        break;\n      }\n    }\n    if (!passed) return false;\n  }\n  return true;\n}\n\n// Evaluate a single operator condition\nfunction evalOperatorCondition(\n  operator: Operator,\n  actual: any,\n  expected: any,\n  savedGroups: SavedGroupsValues,\n): boolean {\n  switch (operator) {\n    case \"$veq\":\n      return paddedVersionString(actual) === paddedVersionString(expected);\n    case \"$vne\":\n      return paddedVersionString(actual) !== paddedVersionString(expected);\n    case \"$vgt\":\n      return paddedVersionString(actual) > paddedVersionString(expected);\n    case \"$vgte\":\n      return paddedVersionString(actual) >= paddedVersionString(expected);\n    case \"$vlt\":\n      return paddedVersionString(actual) < paddedVersionString(expected);\n    case \"$vlte\":\n      return paddedVersionString(actual) <= paddedVersionString(expected);\n    case \"$eq\":\n      return actual === expected;\n    case \"$ne\":\n      return actual !== expected;\n    case \"$lt\":\n      return actual < expected;\n    case \"$lte\":\n      return actual <= expected;\n    case \"$gt\":\n      return actual > expected;\n    case \"$gte\":\n      return actual >= expected;\n    case \"$exists\":\n      // Using `!=` and `==` instead of strict checks so it also matches for undefined\n      return expected ? actual != null : actual == null;\n    case \"$in\":\n      if (!Array.isArray(expected)) return false;\n      return isIn(actual, expected);\n    case \"$ini\":\n      if (!Array.isArray(expected)) return false;\n      return isIn(actual, expected, true);\n    case \"$inGroup\":\n      return isIn(actual, savedGroups[expected] || []);\n    case \"$notInGroup\":\n      return !isIn(actual, savedGroups[expected] || []);\n    case \"$nin\":\n      if (!Array.isArray(expected)) return false;\n      return !isIn(actual, expected);\n    case \"$nini\":\n      if (!Array.isArray(expected)) return false;\n      return !isIn(actual, expected, true);\n    case \"$not\":\n      return !evalConditionValue(expected, actual, savedGroups);\n    case \"$size\":\n      if (!Array.isArray(actual)) return false;\n      return evalConditionValue(expected, actual.length, savedGroups);\n    case \"$elemMatch\":\n      return elemMatch(actual, expected, savedGroups);\n    case \"$all\":\n      if (!Array.isArray(expected)) return false;\n      return isInAll(actual, expected, savedGroups);\n    case \"$alli\":\n      if (!Array.isArray(expected)) return false;\n      return isInAll(actual, expected, savedGroups, true);\n    case \"$regex\":\n      try {\n        return getRegex(expected).test(actual);\n      } catch (e) {\n        return false;\n      }\n    case \"$regexi\":\n      try {\n        return getRegex(expected, true).test(actual);\n      } catch (e) {\n        return false;\n      }\n    case \"$type\":\n      return getType(actual) === expected;\n    default:\n      console.error(\"Unknown operator: \" + operator);\n      return false;\n  }\n}\n\n// Recursive $or rule\nfunction evalOr(\n  obj: TestedObj,\n  conditions: ConditionInterface[],\n  savedGroups: SavedGroupsValues,\n): boolean {\n  if (!conditions.length) return true;\n  for (let i = 0; i < conditions.length; i++) {\n    if (evalCondition(obj, conditions[i], savedGroups)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n// Recursive $and rule\nfunction evalAnd(\n  obj: TestedObj,\n  conditions: ConditionInterface[],\n  savedGroups: SavedGroupsValues,\n): boolean {\n  for (let i = 0; i < conditions.length; i++) {\n    if (!evalCondition(obj, conditions[i], savedGroups)) {\n      return false;\n    }\n  }\n  return true;\n}\n","import {\n  EvalContext,\n  FeatureDefinition,\n  FeatureResult,\n  Experiment,\n  FeatureResultSource,\n  Result,\n  Filter,\n  VariationRange,\n  VariationMeta,\n  StickyExperimentKey,\n  StickyAssignments,\n  StickyAttributeKey,\n  StickyAssignmentsDocument,\n  FeatureApiResponse,\n  Options,\n  ClientOptions,\n} from \"./types/growthbook\";\nimport { evalCondition } from \"./mongrule\";\nimport { ConditionInterface } from \"./types/mongrule\";\nimport {\n  chooseVariation,\n  decrypt,\n  getBucketRanges,\n  getQueryStringOverride,\n  getUrlRegExp,\n  hash,\n  inNamespace,\n  inRange,\n  isIncluded,\n  isURLTargeted,\n  toString,\n} from \"./util\";\nimport { StickyBucketService } from \"./sticky-bucket-service\";\n\nexport const EVENT_FEATURE_EVALUATED = \"Feature Evaluated\";\nexport const EVENT_EXPERIMENT_VIEWED = \"Experiment Viewed\";\n\nfunction getForcedFeatureValues(ctx: EvalContext) {\n  // Merge user and global values\n  const ret: typeof ctx.global.forcedFeatureValues = new Map();\n  if (ctx.global.forcedFeatureValues) {\n    ctx.global.forcedFeatureValues.forEach((v, k) => ret.set(k, v));\n  }\n  if (ctx.user.forcedFeatureValues) {\n    ctx.user.forcedFeatureValues.forEach((v, k) => ret.set(k, v));\n  }\n  return ret;\n}\n\nfunction getForcedVariations(ctx: EvalContext) {\n  // Merge user and global values\n  if (ctx.global.forcedVariations && ctx.user.forcedVariations) {\n    return { ...ctx.global.forcedVariations, ...ctx.user.forcedVariations };\n  } else if (ctx.global.forcedVariations) {\n    return ctx.global.forcedVariations;\n  } else if (ctx.user.forcedVariations) {\n    return ctx.user.forcedVariations;\n  } else {\n    return {};\n  }\n}\n\nasync function safeCall(fn: () => void | Promise<void>) {\n  try {\n    await fn();\n  } catch (e) {\n    // Do nothing\n  }\n}\n\nfunction onExperimentViewed(\n  ctx: EvalContext,\n  experiment: Experiment<unknown>,\n  result: Result<unknown>,\n): Promise<void>[] {\n  // Make sure a tracking callback is only fired once per unique experiment\n  if (ctx.user.trackedExperiments) {\n    const k = getExperimentDedupeKey(experiment, result);\n    if (ctx.user.trackedExperiments.has(k)) {\n      return [];\n    }\n    ctx.user.trackedExperiments.add(k);\n  }\n\n  if (ctx.user.enableDevMode && ctx.user.devLogs) {\n    ctx.user.devLogs.push({\n      experiment,\n      result,\n      timestamp: Date.now().toString(),\n      logType: \"experiment\",\n    });\n  }\n\n  const calls: Promise<void>[] = [];\n\n  if (ctx.global.trackingCallback) {\n    const cb = ctx.global.trackingCallback;\n    calls.push(safeCall(() => cb(experiment, result, ctx.user)));\n  }\n  if (ctx.user.trackingCallback) {\n    const cb = ctx.user.trackingCallback;\n    calls.push(safeCall(() => cb(experiment, result)));\n  }\n  if (ctx.global.eventLogger) {\n    const cb = ctx.global.eventLogger;\n    calls.push(\n      safeCall(() =>\n        cb(\n          EVENT_EXPERIMENT_VIEWED,\n          {\n            experimentId: experiment.key,\n            variationId: result.key,\n            hashAttribute: result.hashAttribute,\n            hashValue: result.hashValue,\n          },\n          ctx.user,\n        ),\n      ),\n    );\n  }\n  return calls;\n}\n\nfunction onFeatureUsage(\n  ctx: EvalContext,\n  key: string,\n  ret: FeatureResult<unknown>,\n): void {\n  // Only track a feature once, unless the assigned value changed\n  if (ctx.user.trackedFeatureUsage) {\n    const stringifiedValue = JSON.stringify(ret.value);\n    if (ctx.user.trackedFeatureUsage[key] === stringifiedValue) return;\n    ctx.user.trackedFeatureUsage[key] = stringifiedValue;\n\n    if (ctx.user.enableDevMode && ctx.user.devLogs) {\n      ctx.user.devLogs.push({\n        featureKey: key,\n        result: ret,\n        timestamp: Date.now().toString(),\n        logType: \"feature\",\n      });\n    }\n  }\n\n  if (ctx.global.onFeatureUsage) {\n    const cb = ctx.global.onFeatureUsage;\n    safeCall(() => cb(key, ret, ctx.user));\n  }\n  if (ctx.user.onFeatureUsage) {\n    const cb = ctx.user.onFeatureUsage;\n    safeCall(() => cb(key, ret));\n  }\n  if (ctx.global.eventLogger) {\n    const cb = ctx.global.eventLogger;\n    safeCall(() =>\n      cb(\n        EVENT_FEATURE_EVALUATED,\n        {\n          feature: key,\n          source: ret.source,\n          value: ret.value,\n          ruleId: ret.source === \"defaultValue\" ? \"$default\" : ret.ruleId || \"\",\n          variationId: ret.experimentResult ? ret.experimentResult.key : \"\",\n        },\n        ctx.user,\n      ),\n    );\n  }\n}\n\nexport function evalFeature<V = unknown>(\n  id: string,\n  ctx: EvalContext,\n): FeatureResult<V | null> {\n  if (ctx.stack.evaluatedFeatures.has(id)) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\n        `evalFeature: circular dependency detected: ${ctx.stack.id} -> ${id}`,\n        {\n          from: ctx.stack.id,\n          to: id,\n        },\n      );\n    return getFeatureResult(ctx, id, null, \"cyclicPrerequisite\");\n  }\n  ctx.stack.evaluatedFeatures.add(id);\n  ctx.stack.id = id;\n\n  // Global override\n  const forcedValues = getForcedFeatureValues(ctx);\n  if (forcedValues.has(id)) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Global override\", {\n        id,\n        value: forcedValues.get(id),\n      });\n    return getFeatureResult(ctx, id, forcedValues.get(id), \"override\");\n  }\n\n  // Unknown feature id\n  if (!ctx.global.features || !ctx.global.features[id]) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Unknown feature\", { id });\n    return getFeatureResult(ctx, id, null, \"unknownFeature\");\n  }\n\n  // Get the feature\n  const feature: FeatureDefinition<V> = ctx.global.features[id];\n\n  // Loop through the rules\n  if (feature.rules) {\n    const evaluatedFeatures = new Set(ctx.stack.evaluatedFeatures);\n    rules: for (const rule of feature.rules) {\n      // If there are prerequisite flag(s), evaluate them\n      if (rule.parentConditions) {\n        for (const parentCondition of rule.parentConditions) {\n          ctx.stack.evaluatedFeatures = new Set(evaluatedFeatures);\n          const parentResult = evalFeature(parentCondition.id, ctx);\n          // break out for cyclic prerequisites\n          if (parentResult.source === \"cyclicPrerequisite\") {\n            return getFeatureResult(ctx, id, null, \"cyclicPrerequisite\");\n          }\n\n          const evalObj = { value: parentResult.value };\n          const evaled = evalCondition(\n            evalObj,\n            parentCondition.condition || {},\n          );\n          if (!evaled) {\n            // blocking prerequisite eval failed: feature evaluation fails\n            if (parentCondition.gate) {\n              process.env.NODE_ENV !== \"production\" &&\n                ctx.global.log(\"Feature blocked by prerequisite\", { id, rule });\n              return getFeatureResult(ctx, id, null, \"prerequisite\");\n            }\n            // non-blocking prerequisite eval failed: break out of parentConditions loop, jump to the next rule\n            process.env.NODE_ENV !== \"production\" &&\n              ctx.global.log(\n                \"Skip rule because prerequisite evaluation fails\",\n                {\n                  id,\n                  rule,\n                },\n              );\n            continue rules;\n          }\n        }\n      }\n\n      // If there are filters for who is included (e.g. namespaces)\n      if (rule.filters && isFilteredOut(rule.filters, ctx)) {\n        process.env.NODE_ENV !== \"production\" &&\n          ctx.global.log(\"Skip rule because of filters\", {\n            id,\n            rule,\n          });\n        continue;\n      }\n\n      // Feature value is being forced\n      if (\"force\" in rule) {\n        // If it's a conditional rule, skip if the condition doesn't pass\n        if (rule.condition && !conditionPasses(rule.condition, ctx)) {\n          process.env.NODE_ENV !== \"production\" &&\n            ctx.global.log(\"Skip rule because of condition ff\", {\n              id,\n              rule,\n            });\n          continue;\n        }\n\n        // If this is a percentage rollout, skip if not included\n        if (\n          !isIncludedInRollout(\n            ctx,\n            rule.seed || id,\n            rule.hashAttribute,\n            ctx.user.saveStickyBucketAssignmentDoc &&\n              !rule.disableStickyBucketing\n              ? rule.fallbackAttribute\n              : undefined,\n            rule.range,\n            rule.coverage,\n            rule.hashVersion,\n          )\n        ) {\n          process.env.NODE_ENV !== \"production\" &&\n            ctx.global.log(\"Skip rule because user not included in rollout\", {\n              id,\n              rule,\n            });\n          continue;\n        }\n\n        process.env.NODE_ENV !== \"production\" &&\n          ctx.global.log(\"Force value from rule\", {\n            id,\n            rule,\n          });\n\n        // If this was a remotely evaluated experiment, fire the tracking callbacks\n        if (rule.tracks) {\n          rule.tracks.forEach((t) => {\n            const calls = onExperimentViewed(ctx, t.experiment, t.result);\n            if (!calls.length && ctx.global.saveDeferredTrack) {\n              ctx.global.saveDeferredTrack({\n                experiment: t.experiment,\n                result: t.result,\n              });\n            }\n          });\n        }\n\n        return getFeatureResult(ctx, id, rule.force as V, \"force\", rule.id);\n      }\n      if (!rule.variations) {\n        process.env.NODE_ENV !== \"production\" &&\n          ctx.global.log(\"Skip invalid rule\", {\n            id,\n            rule,\n          });\n\n        continue;\n      }\n\n      // For experiment rules, run an experiment\n      const exp: Experiment<V> = {\n        variations: rule.variations as [V, V, ...V[]],\n        key: rule.key || id,\n      };\n      if (\"coverage\" in rule) exp.coverage = rule.coverage;\n      if (rule.weights) exp.weights = rule.weights;\n      if (rule.hashAttribute) exp.hashAttribute = rule.hashAttribute;\n      if (rule.fallbackAttribute)\n        exp.fallbackAttribute = rule.fallbackAttribute;\n      if (rule.disableStickyBucketing)\n        exp.disableStickyBucketing = rule.disableStickyBucketing;\n      if (rule.bucketVersion !== undefined)\n        exp.bucketVersion = rule.bucketVersion;\n      if (rule.minBucketVersion !== undefined)\n        exp.minBucketVersion = rule.minBucketVersion;\n      if (rule.namespace) exp.namespace = rule.namespace;\n      if (rule.meta) exp.meta = rule.meta;\n      if (rule.ranges) exp.ranges = rule.ranges;\n      if (rule.name) exp.name = rule.name;\n      if (rule.phase) exp.phase = rule.phase;\n      if (rule.seed) exp.seed = rule.seed;\n      if (rule.hashVersion) exp.hashVersion = rule.hashVersion;\n      if (rule.filters) exp.filters = rule.filters;\n      if (rule.condition) exp.condition = rule.condition;\n\n      // Only return a value if the user is part of the experiment\n      const { result } = runExperiment(exp, id, ctx);\n      ctx.global.onExperimentEval && ctx.global.onExperimentEval(exp, result);\n      if (result.inExperiment && !result.passthrough) {\n        return getFeatureResult(\n          ctx,\n          id,\n          result.value,\n          \"experiment\",\n          rule.id,\n          exp,\n          result,\n        );\n      }\n    }\n  }\n\n  process.env.NODE_ENV !== \"production\" &&\n    ctx.global.log(\"Use default value\", {\n      id,\n      value: feature.defaultValue,\n    });\n\n  // Fall back to using the default value\n  return getFeatureResult(\n    ctx,\n    id,\n    feature.defaultValue === undefined ? null : feature.defaultValue,\n    \"defaultValue\",\n  );\n}\n\nexport function runExperiment<T>(\n  experiment: Experiment<T>,\n  featureId: string | null,\n  ctx: EvalContext,\n): {\n  result: Result<T>;\n  trackingCall?: Promise<void>;\n} {\n  const key = experiment.key;\n  const numVariations = experiment.variations.length;\n\n  // 1. If experiment has less than 2 variations, return immediately\n  if (numVariations < 2) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Invalid experiment\", { id: key });\n    return {\n      result: getExperimentResult(ctx, experiment, -1, false, featureId),\n    };\n  }\n\n  // 2. If the context is disabled, return immediately\n  if (ctx.global.enabled === false || ctx.user.enabled === false) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Context disabled\", { id: key });\n    return {\n      result: getExperimentResult(ctx, experiment, -1, false, featureId),\n    };\n  }\n\n  // 2.5. Merge in experiment overrides from the context\n  experiment = mergeOverrides(experiment, ctx);\n\n  // 2.6 New, more powerful URL targeting\n  if (\n    experiment.urlPatterns &&\n    !isURLTargeted(ctx.user.url || \"\", experiment.urlPatterns)\n  ) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Skip because of url targeting\", {\n        id: key,\n      });\n    return {\n      result: getExperimentResult(ctx, experiment, -1, false, featureId),\n    };\n  }\n\n  // 3. If a variation is forced from a querystring, return the forced variation\n  const qsOverride = getQueryStringOverride(\n    key,\n    ctx.user.url || \"\",\n    numVariations,\n  );\n  if (qsOverride !== null) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Force via querystring\", {\n        id: key,\n        variation: qsOverride,\n      });\n    return {\n      result: getExperimentResult(\n        ctx,\n        experiment,\n        qsOverride,\n        false,\n        featureId,\n      ),\n    };\n  }\n\n  // 4. If a variation is forced in the context, return the forced variation\n  const forcedVariations = getForcedVariations(ctx);\n  if (key in forcedVariations) {\n    const variation = forcedVariations[key];\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Force via dev tools\", {\n        id: key,\n        variation,\n      });\n    return {\n      result: getExperimentResult(ctx, experiment, variation, false, featureId),\n    };\n  }\n\n  // 5. Exclude if a draft experiment or not active\n  if (experiment.status === \"draft\" || experiment.active === false) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Skip because inactive\", {\n        id: key,\n      });\n    return {\n      result: getExperimentResult(ctx, experiment, -1, false, featureId),\n    };\n  }\n\n  // 6. Get the hash attribute and return if empty\n  const { hashAttribute, hashValue } = getHashAttribute(\n    ctx,\n    experiment.hashAttribute,\n    ctx.user.saveStickyBucketAssignmentDoc && !experiment.disableStickyBucketing\n      ? experiment.fallbackAttribute\n      : undefined,\n  );\n  if (!hashValue) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Skip because missing hashAttribute\", {\n        id: key,\n      });\n    return {\n      result: getExperimentResult(ctx, experiment, -1, false, featureId),\n    };\n  }\n\n  let assigned = -1;\n\n  let foundStickyBucket = false;\n  let stickyBucketVersionIsBlocked = false;\n  if (\n    ctx.user.saveStickyBucketAssignmentDoc &&\n    !experiment.disableStickyBucketing\n  ) {\n    const { variation, versionIsBlocked } = getStickyBucketVariation({\n      ctx,\n      expKey: experiment.key,\n      expBucketVersion: experiment.bucketVersion,\n      expHashAttribute: experiment.hashAttribute,\n      expFallbackAttribute: experiment.fallbackAttribute,\n      expMinBucketVersion: experiment.minBucketVersion,\n      expMeta: experiment.meta,\n    });\n    foundStickyBucket = variation >= 0;\n    assigned = variation;\n    stickyBucketVersionIsBlocked = !!versionIsBlocked;\n  }\n\n  // Some checks are not needed if we already have a sticky bucket\n  if (!foundStickyBucket) {\n    // 7. Exclude if user is filtered out (used to be called \"namespace\")\n    if (experiment.filters) {\n      if (isFilteredOut(experiment.filters, ctx)) {\n        process.env.NODE_ENV !== \"production\" &&\n          ctx.global.log(\"Skip because of filters\", {\n            id: key,\n          });\n        return {\n          result: getExperimentResult(ctx, experiment, -1, false, featureId),\n        };\n      }\n    } else if (\n      experiment.namespace &&\n      !inNamespace(hashValue, experiment.namespace)\n    ) {\n      process.env.NODE_ENV !== \"production\" &&\n        ctx.global.log(\"Skip because of namespace\", {\n          id: key,\n        });\n      return {\n        result: getExperimentResult(ctx, experiment, -1, false, featureId),\n      };\n    }\n\n    // 7.5. Exclude if experiment.include returns false or throws\n    if (experiment.include && !isIncluded(experiment.include)) {\n      process.env.NODE_ENV !== \"production\" &&\n        ctx.global.log(\"Skip because of include function\", {\n          id: key,\n        });\n      return {\n        result: getExperimentResult(ctx, experiment, -1, false, featureId),\n      };\n    }\n\n    // 8. Exclude if condition is false\n    if (experiment.condition && !conditionPasses(experiment.condition, ctx)) {\n      process.env.NODE_ENV !== \"production\" &&\n        ctx.global.log(\"Skip because of condition exp\", {\n          id: key,\n        });\n      return {\n        result: getExperimentResult(ctx, experiment, -1, false, featureId),\n      };\n    }\n\n    // 8.05. Exclude if prerequisites are not met\n    if (experiment.parentConditions) {\n      const evaluatedFeatures = new Set(ctx.stack.evaluatedFeatures);\n      for (const parentCondition of experiment.parentConditions) {\n        ctx.stack.evaluatedFeatures = new Set(evaluatedFeatures);\n        const parentResult = evalFeature(parentCondition.id, ctx);\n        // break out for cyclic prerequisites\n        if (parentResult.source === \"cyclicPrerequisite\") {\n          return {\n            result: getExperimentResult(ctx, experiment, -1, false, featureId),\n          };\n        }\n\n        const evalObj = { value: parentResult.value };\n        if (!evalCondition(evalObj, parentCondition.condition || {})) {\n          process.env.NODE_ENV !== \"production\" &&\n            ctx.global.log(\"Skip because prerequisite evaluation fails\", {\n              id: key,\n            });\n          return {\n            result: getExperimentResult(ctx, experiment, -1, false, featureId),\n          };\n        }\n      }\n    }\n\n    // 8.1. Exclude if user is not in a required group\n    if (\n      experiment.groups &&\n      !hasGroupOverlap(experiment.groups as string[], ctx)\n    ) {\n      process.env.NODE_ENV !== \"production\" &&\n        ctx.global.log(\"Skip because of groups\", {\n          id: key,\n        });\n      return {\n        result: getExperimentResult(ctx, experiment, -1, false, featureId),\n      };\n    }\n  }\n\n  // 8.2. Old style URL targeting\n  if (experiment.url && !urlIsValid(experiment.url as RegExp, ctx)) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Skip because of url\", {\n        id: key,\n      });\n    return {\n      result: getExperimentResult(ctx, experiment, -1, false, featureId),\n    };\n  }\n\n  // 9. Get the variation from the sticky bucket or get bucket ranges and choose variation\n  const n = hash(\n    experiment.seed || key,\n    hashValue,\n    experiment.hashVersion || 1,\n  );\n  if (n === null) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Skip because of invalid hash version\", {\n        id: key,\n      });\n    return {\n      result: getExperimentResult(ctx, experiment, -1, false, featureId),\n    };\n  }\n\n  if (!foundStickyBucket) {\n    const ranges =\n      experiment.ranges ||\n      getBucketRanges(\n        numVariations,\n        experiment.coverage === undefined ? 1 : experiment.coverage,\n        experiment.weights,\n      );\n    assigned = chooseVariation(n, ranges);\n  }\n\n  // 9.5 Unenroll if any prior sticky buckets are blocked by version\n  if (stickyBucketVersionIsBlocked) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Skip because sticky bucket version is blocked\", {\n        id: key,\n      });\n    return {\n      result: getExperimentResult(\n        ctx,\n        experiment,\n        -1,\n        false,\n        featureId,\n        undefined,\n        true,\n      ),\n    };\n  }\n\n  // 10. Return if not in experiment\n  if (assigned < 0) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Skip because of coverage\", {\n        id: key,\n      });\n    return {\n      result: getExperimentResult(ctx, experiment, -1, false, featureId),\n    };\n  }\n\n  // 11. Experiment has a forced variation\n  if (\"force\" in experiment) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Force variation\", {\n        id: key,\n        variation: experiment.force,\n      });\n    return {\n      result: getExperimentResult(\n        ctx,\n        experiment,\n        experiment.force === undefined ? -1 : experiment.force,\n        false,\n        featureId,\n      ),\n    };\n  }\n\n  // 12. Exclude if in QA mode\n  if (ctx.global.qaMode || ctx.user.qaMode) {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Skip because QA mode\", {\n        id: key,\n      });\n    return {\n      result: getExperimentResult(ctx, experiment, -1, false, featureId),\n    };\n  }\n\n  // 12.5. Exclude if experiment is stopped\n  if (experiment.status === \"stopped\") {\n    process.env.NODE_ENV !== \"production\" &&\n      ctx.global.log(\"Skip because stopped\", {\n        id: key,\n      });\n    return {\n      result: getExperimentResult(ctx, experiment, -1, false, featureId),\n    };\n  }\n\n  // 13. Build the result object\n  const result = getExperimentResult(\n    ctx,\n    experiment,\n    assigned,\n    true,\n    featureId,\n    n,\n    foundStickyBucket,\n  );\n\n  // 13.5. Persist sticky bucket\n  if (\n    ctx.user.saveStickyBucketAssignmentDoc &&\n    !experiment.disableStickyBucketing\n  ) {\n    const {\n      changed,\n      key: attrKey,\n      doc,\n    } = generateStickyBucketAssignmentDoc(\n      ctx,\n      hashAttribute,\n      toString(hashValue),\n      {\n        [getStickyBucketExperimentKey(\n          experiment.key,\n          experiment.bucketVersion,\n        )]: result.key,\n      },\n    );\n    if (changed) {\n      // update local docs\n      ctx.user.stickyBucketAssignmentDocs =\n        ctx.user.stickyBucketAssignmentDocs || {};\n      ctx.user.stickyBucketAssignmentDocs[attrKey] = doc;\n      // save doc\n      ctx.user.saveStickyBucketAssignmentDoc(doc);\n    }\n  }\n\n  // 14. Fire the tracking callback(s)\n  // Store the promise in case we're awaiting it (ex: browser url redirects)\n  const trackingCalls = onExperimentViewed(ctx, experiment, result);\n  if (trackingCalls.length === 0 && ctx.global.saveDeferredTrack) {\n    ctx.global.saveDeferredTrack({\n      experiment,\n      result,\n    });\n  }\n  const trackingCall = !trackingCalls.length\n    ? undefined\n    : trackingCalls.length === 1\n      ? trackingCalls[0]\n      : Promise.all(trackingCalls).then(() => {});\n\n  // 14.1 Keep track of completed changeIds\n  \"changeId\" in experiment &&\n    experiment.changeId &&\n    ctx.global.recordChangeId &&\n    ctx.global.recordChangeId(experiment.changeId as string);\n\n  // 15. Return the result\n  process.env.NODE_ENV !== \"production\" &&\n    ctx.global.log(\"In experiment\", {\n      id: key,\n      variation: result.variationId,\n    });\n  return { result, trackingCall };\n}\n\nfunction getFeatureResult<T>(\n  ctx: EvalContext,\n  key: string,\n  value: T,\n  source: FeatureResultSource,\n  ruleId?: string,\n  experiment?: Experiment<T>,\n  result?: Result<T>,\n): FeatureResult<T> {\n  const ret: FeatureResult = {\n    value,\n    on: !!value,\n    off: !value,\n    source,\n    ruleId: ruleId || \"\",\n  };\n  if (experiment) ret.experiment = experiment;\n  if (result) ret.experimentResult = result;\n\n  // Track the usage of this feature in real-time\n  if (source !== \"override\") {\n    onFeatureUsage(ctx, key, ret);\n  }\n\n  return ret;\n}\n\nfunction getAttributes(ctx: EvalContext) {\n  return {\n    ...ctx.user.attributes,\n    ...ctx.user.attributeOverrides,\n  };\n}\n\nfunction conditionPasses(\n  condition: ConditionInterface,\n  ctx: EvalContext,\n): boolean {\n  return evalCondition(\n    getAttributes(ctx),\n    condition,\n    ctx.global.savedGroups || {},\n  );\n}\n\nfunction isFilteredOut(filters: Filter[], ctx: EvalContext): boolean {\n  return filters.some((filter) => {\n    const { hashValue } = getHashAttribute(ctx, filter.attribute);\n    if (!hashValue) return true;\n    const n = hash(filter.seed, hashValue, filter.hashVersion || 2);\n    if (n === null) return true;\n    return !filter.ranges.some((r) => inRange(n, r));\n  });\n}\n\nfunction isIncludedInRollout(\n  ctx: EvalContext,\n  seed: string,\n  hashAttribute: string | undefined,\n  fallbackAttribute: string | undefined,\n  range: VariationRange | undefined,\n  coverage: number | undefined,\n  hashVersion: number | undefined,\n): boolean {\n  if (!range && coverage === undefined) return true;\n\n  if (!range && coverage === 0) return false;\n\n  const { hashValue } = getHashAttribute(ctx, hashAttribute, fallbackAttribute);\n  if (!hashValue) {\n    return false;\n  }\n\n  const n = hash(seed, hashValue, hashVersion || 1);\n  if (n === null) return false;\n\n  return range\n    ? inRange(n, range)\n    : coverage !== undefined\n      ? n <= coverage\n      : true;\n}\n\nexport function getExperimentResult<T>(\n  ctx: EvalContext,\n  experiment: Experiment<T>,\n  variationIndex: number,\n  hashUsed: boolean,\n  featureId: string | null,\n  bucket?: number,\n  stickyBucketUsed?: boolean,\n): Result<T> {\n  let inExperiment = true;\n  // If assigned variation is not valid, use the baseline and mark the user as not in the experiment\n  if (variationIndex < 0 || variationIndex >= experiment.variations.length) {\n    variationIndex = 0;\n    inExperiment = false;\n  }\n\n  const { hashAttribute, hashValue } = getHashAttribute(\n    ctx,\n    experiment.hashAttribute,\n    ctx.user.saveStickyBucketAssignmentDoc && !experiment.disableStickyBucketing\n      ? experiment.fallbackAttribute\n      : undefined,\n  );\n\n  const meta: Partial<VariationMeta> = experiment.meta\n    ? experiment.meta[variationIndex]\n    : {};\n\n  const res: Result<T> = {\n    key: meta.key || \"\" + variationIndex,\n    featureId,\n    inExperiment,\n    hashUsed,\n    variationId: variationIndex,\n    value: experiment.variations[variationIndex],\n    hashAttribute,\n    hashValue,\n    stickyBucketUsed: !!stickyBucketUsed,\n  };\n\n  if (meta.name) res.name = meta.name;\n  if (bucket !== undefined) res.bucket = bucket;\n  if (meta.passthrough) res.passthrough = meta.passthrough;\n\n  return res;\n}\n\nfunction mergeOverrides<T>(\n  experiment: Experiment<T>,\n  ctx: EvalContext,\n): Experiment<T> {\n  const key = experiment.key;\n  const o = ctx.global.overrides;\n  if (o && o[key]) {\n    experiment = Object.assign({}, experiment, o[key]);\n    if (typeof experiment.url === \"string\") {\n      experiment.url = getUrlRegExp(\n        // eslint-disable-next-line\n        experiment.url as any,\n      );\n    }\n  }\n\n  return experiment;\n}\n\nexport function getHashAttribute(\n  ctx: EvalContext,\n  attr?: string,\n  fallback?: string,\n) {\n  let hashAttribute = attr || \"id\";\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  let hashValue: any = \"\";\n\n  const attributes = getAttributes(ctx);\n\n  if (attributes[hashAttribute]) {\n    hashValue = attributes[hashAttribute];\n  }\n\n  // if no match, try fallback\n  if (!hashValue && fallback) {\n    if (attributes[fallback]) {\n      hashValue = attributes[fallback];\n    }\n    if (hashValue) {\n      hashAttribute = fallback;\n    }\n  }\n\n  return { hashAttribute, hashValue };\n}\n\nfunction urlIsValid(urlRegex: RegExp, ctx: EvalContext): boolean {\n  const url = ctx.user.url;\n  if (!url) return false;\n\n  const pathOnly = url.replace(/^https?:\\/\\//, \"\").replace(/^[^/]*\\//, \"/\");\n\n  if (urlRegex.test(url)) return true;\n  if (urlRegex.test(pathOnly)) return true;\n  return false;\n}\n\nfunction hasGroupOverlap(expGroups: string[], ctx: EvalContext): boolean {\n  const groups = ctx.global.groups || {};\n  for (let i = 0; i < expGroups.length; i++) {\n    if (groups[expGroups[i]]) return true;\n  }\n  return false;\n}\n\nfunction getStickyBucketVariation({\n  ctx,\n  expKey,\n  expBucketVersion,\n  expHashAttribute,\n  expFallbackAttribute,\n  expMinBucketVersion,\n  expMeta,\n}: {\n  ctx: EvalContext;\n  expKey: string;\n  expBucketVersion?: number;\n  expHashAttribute?: string;\n  expFallbackAttribute?: string;\n  expMinBucketVersion?: number;\n  expMeta?: VariationMeta[];\n}): {\n  variation: number;\n  versionIsBlocked?: boolean;\n} {\n  expBucketVersion = expBucketVersion || 0;\n  expMinBucketVersion = expMinBucketVersion || 0;\n  expHashAttribute = expHashAttribute || \"id\";\n  expMeta = expMeta || [];\n  const id = getStickyBucketExperimentKey(expKey, expBucketVersion);\n  const assignments = getStickyBucketAssignments(\n    ctx,\n    expHashAttribute,\n    expFallbackAttribute,\n  );\n\n  // users with any blocked bucket version (0 to minExperimentBucketVersion - 1) are excluded from the test\n  if (expMinBucketVersion > 0) {\n    for (let i = 0; i < expMinBucketVersion; i++) {\n      const blockedKey = getStickyBucketExperimentKey(expKey, i);\n      if (assignments[blockedKey] !== undefined) {\n        return {\n          variation: -1,\n          versionIsBlocked: true,\n        };\n      }\n    }\n  }\n  const variationKey = assignments[id];\n  if (variationKey === undefined)\n    // no assignment found\n    return { variation: -1 };\n  const variation = expMeta.findIndex((m) => m.key === variationKey);\n  if (variation < 0)\n    // invalid assignment, treat as \"no assignment found\"\n    return { variation: -1 };\n\n  return { variation };\n}\n\nfunction getStickyBucketExperimentKey(\n  experimentKey: string,\n  experimentBucketVersion?: number,\n): StickyExperimentKey {\n  experimentBucketVersion = experimentBucketVersion || 0;\n  return `${experimentKey}__${experimentBucketVersion}`;\n}\n\nexport function getStickyBucketAttributeKey(\n  attributeName: string,\n  attributeValue: string,\n): StickyAttributeKey {\n  return `${attributeName}||${attributeValue}`;\n}\n\nfunction getStickyBucketAssignments(\n  ctx: EvalContext,\n  expHashAttribute: string,\n  expFallbackAttribute?: string,\n): StickyAssignments {\n  if (!ctx.user.stickyBucketAssignmentDocs) return {};\n  const { hashAttribute, hashValue } = getHashAttribute(ctx, expHashAttribute);\n  const hashKey = getStickyBucketAttributeKey(\n    hashAttribute,\n    toString(hashValue),\n  );\n\n  const { hashAttribute: fallbackAttribute, hashValue: fallbackValue } =\n    getHashAttribute(ctx, expFallbackAttribute);\n  const fallbackKey = fallbackValue\n    ? getStickyBucketAttributeKey(fallbackAttribute, toString(fallbackValue))\n    : null;\n\n  const assignments: StickyAssignments = {};\n  if (fallbackKey && ctx.user.stickyBucketAssignmentDocs[fallbackKey]) {\n    Object.assign(\n      assignments,\n      ctx.user.stickyBucketAssignmentDocs[fallbackKey].assignments || {},\n    );\n  }\n  if (ctx.user.stickyBucketAssignmentDocs[hashKey]) {\n    Object.assign(\n      assignments,\n      ctx.user.stickyBucketAssignmentDocs[hashKey].assignments || {},\n    );\n  }\n  return assignments;\n}\n\nfunction generateStickyBucketAssignmentDoc(\n  ctx: EvalContext,\n  attributeName: string,\n  attributeValue: string,\n  assignments: StickyAssignments,\n): {\n  key: StickyAttributeKey;\n  doc: StickyAssignmentsDocument;\n  changed: boolean;\n} {\n  const key = getStickyBucketAttributeKey(attributeName, attributeValue);\n  const existingAssignments =\n    ctx.user.stickyBucketAssignmentDocs &&\n    ctx.user.stickyBucketAssignmentDocs[key]\n      ? ctx.user.stickyBucketAssignmentDocs[key].assignments || {}\n      : {};\n  const newAssignments = { ...existingAssignments, ...assignments };\n  const changed =\n    JSON.stringify(existingAssignments) !== JSON.stringify(newAssignments);\n\n  return {\n    key,\n    doc: {\n      attributeName,\n      attributeValue,\n      assignments: newAssignments,\n    },\n    changed,\n  };\n}\n\nfunction deriveStickyBucketIdentifierAttributes(\n  ctx: EvalContext,\n  data?: FeatureApiResponse,\n) {\n  const attributes = new Set<string>();\n  const features =\n    data && data.features ? data.features : ctx.global.features || {};\n  const experiments =\n    data && data.experiments ? data.experiments : ctx.global.experiments || [];\n  Object.keys(features).forEach((id) => {\n    const feature = features[id];\n    if (feature.rules) {\n      for (const rule of feature.rules) {\n        if (rule.variations) {\n          attributes.add(rule.hashAttribute || \"id\");\n          if (rule.fallbackAttribute) {\n            attributes.add(rule.fallbackAttribute);\n          }\n        }\n      }\n    }\n  });\n  experiments.map((experiment) => {\n    attributes.add(experiment.hashAttribute || \"id\");\n    if (experiment.fallbackAttribute) {\n      attributes.add(experiment.fallbackAttribute);\n    }\n  });\n  return Array.from(attributes);\n}\n\nexport async function getAllStickyBucketAssignmentDocs(\n  ctx: EvalContext,\n  stickyBucketService: StickyBucketService,\n  data?: FeatureApiResponse,\n) {\n  const attributes = getStickyBucketAttributes(ctx, data);\n  return stickyBucketService.getAllAssignments(attributes);\n}\n\nexport function getStickyBucketAttributes(\n  ctx: EvalContext,\n  data?: FeatureApiResponse,\n): Record<string, string> {\n  const attributes: Record<string, string> = {};\n  const stickyBucketIdentifierAttributes =\n    deriveStickyBucketIdentifierAttributes(ctx, data);\n  stickyBucketIdentifierAttributes.forEach((attr) => {\n    const { hashValue } = getHashAttribute(ctx, attr);\n    attributes[attr] = toString(hashValue);\n  });\n  return attributes;\n}\n\nexport async function decryptPayload(\n  data: FeatureApiResponse,\n  decryptionKey: string | undefined,\n  subtle?: SubtleCrypto,\n): Promise<FeatureApiResponse> {\n  data = { ...data };\n  if (data.encryptedFeatures) {\n    try {\n      data.features = JSON.parse(\n        await decrypt(data.encryptedFeatures, decryptionKey, subtle),\n      );\n    } catch (e) {\n      console.error(e);\n    }\n    delete data.encryptedFeatures;\n  }\n  if (data.encryptedExperiments) {\n    try {\n      data.experiments = JSON.parse(\n        await decrypt(data.encryptedExperiments, decryptionKey, subtle),\n      );\n    } catch (e) {\n      console.error(e);\n    }\n    delete data.encryptedExperiments;\n  }\n  if (data.encryptedSavedGroups) {\n    try {\n      data.savedGroups = JSON.parse(\n        await decrypt(data.encryptedSavedGroups, decryptionKey, subtle),\n      );\n    } catch (e) {\n      console.error(e);\n    }\n    delete data.encryptedSavedGroups;\n  }\n  return data;\n}\n\nexport function getApiHosts(options: Options | ClientOptions): {\n  apiHost: string;\n  streamingHost: string;\n  apiRequestHeaders?: Record<string, string>;\n  streamingHostRequestHeaders?: Record<string, string>;\n} {\n  const defaultHost = options.apiHost || \"https://cdn.growthbook.io\";\n  return {\n    apiHost: defaultHost.replace(/\\/*$/, \"\"),\n    streamingHost: (options.streamingHost || defaultHost).replace(/\\/*$/, \"\"),\n    apiRequestHeaders: options.apiHostRequestHeaders,\n    streamingHostRequestHeaders: options.streamingHostRequestHeaders,\n  };\n}\n\nexport function getExperimentDedupeKey(\n  experiment: Experiment<unknown>,\n  result: Result<unknown>,\n) {\n  return (\n    result.hashAttribute +\n    result.hashValue +\n    experiment.key +\n    result.variationId\n  );\n}\n","import mutate, { DeclarativeMutation } from \"dom-mutator\";\nimport type {\n  ApiHost,\n  Attributes,\n  AutoExperiment,\n  AutoExperimentVariation,\n  ClientKey,\n  Options,\n  Experiment,\n  FeatureApiResponse,\n  FeatureDefinition,\n  FeatureResult,\n  FeatureUsageCallback,\n  LoadFeaturesOptions,\n  RefreshFeaturesOptions,\n  RenderFunction,\n  Result,\n  SubscriptionFunction,\n  TrackingCallback,\n  TrackingData,\n  WidenPrimitives,\n  EvalContext,\n  InitOptions,\n  InitResponse,\n  InitSyncOptions,\n  PrefetchOptions,\n  GlobalContext,\n  UserContext,\n  StickyAssignmentsDocument,\n  EventLogger,\n  LogUnion,\n  DestroyOptions,\n} from \"./types/growthbook\";\nimport {\n  decrypt,\n  getAutoExperimentChangeType,\n  isURLTargeted,\n  loadSDKVersion,\n  mergeQueryStrings,\n  promiseTimeout,\n} from \"./util\";\nimport {\n  clearAutoRefresh,\n  configureCache,\n  refreshFeatures,\n  startStreaming,\n  unsubscribe,\n} from \"./feature-repository\";\nimport {\n  runExperiment,\n  evalFeature as _evalFeature,\n  getExperimentResult,\n  getAllStickyBucketAssignmentDocs,\n  decryptPayload,\n  getApiHosts,\n  getExperimentDedupeKey,\n  getStickyBucketAttributes,\n} from \"./core\";\nimport { StickyBucketServiceSync } from \"./sticky-bucket-service\";\n\nconst isBrowser =\n  typeof window !== \"undefined\" && typeof document !== \"undefined\";\n\nconst SDK_VERSION = loadSDKVersion();\n\nexport class GrowthBook<\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  AppFeatures extends Record<string, any> = Record<string, any>,\n> {\n  // context is technically private, but some tools depend on it so we can't mangle the name\n  private context: Options;\n  public debug: boolean;\n  public ready: boolean;\n  public version: string;\n  public logs: Array<LogUnion>;\n\n  // Properties and methods that start with \"_\" are mangled by Terser (saves ~150 bytes)\n  private _options: Options;\n  private _renderer: null | RenderFunction;\n  private _redirectedUrl: string;\n  private _trackedExperiments: Set<string>;\n  private _completedChangeIds: Set<string>;\n  private _trackedFeatures: Record<string, string>;\n  private _subscriptions: Set<SubscriptionFunction>;\n  private _assigned: Map<\n    string,\n    {\n      // eslint-disable-next-line\n      experiment: Experiment<any>;\n      // eslint-disable-next-line\n      result: Result<any>;\n    }\n  >;\n  private _activeAutoExperiments: Map<\n    AutoExperiment,\n    { valueHash: string; undo: () => void }\n  >;\n  private _triggeredExpKeys: Set<string>;\n  private _initialized: boolean;\n  private _deferredTrackingCalls: Map<string, TrackingData>;\n  private _saveStickyBucketAssignmentDoc:\n    | undefined\n    | ((doc: StickyAssignmentsDocument) => Promise<unknown>);\n\n  private _payload: FeatureApiResponse | undefined;\n  private _decryptedPayload: FeatureApiResponse | undefined;\n  private _destroyCallbacks: (() => void)[];\n\n  private _autoExperimentsAllowed: boolean;\n  private _destroyed?: boolean;\n\n  constructor(options?: Options) {\n    options = options || {};\n    // These properties are all initialized in the constructor instead of above\n    // This saves ~80 bytes in the final output\n    this.version = SDK_VERSION;\n    this._options = this.context = options;\n    this._renderer = options.renderer || null;\n    this._trackedExperiments = new Set();\n    this._completedChangeIds = new Set();\n    this._trackedFeatures = {};\n    this.debug = !!options.debug;\n    this._subscriptions = new Set();\n    this.ready = false;\n    this._assigned = new Map();\n    this._activeAutoExperiments = new Map();\n    this._triggeredExpKeys = new Set();\n    this._initialized = false;\n    this._redirectedUrl = \"\";\n    this._deferredTrackingCalls = new Map();\n    this._autoExperimentsAllowed = !options.disableExperimentsOnLoad;\n    this._destroyCallbacks = [];\n    this.logs = [];\n\n    this.log = this.log.bind(this);\n    this._saveDeferredTrack = this._saveDeferredTrack.bind(this);\n    this._onExperimentEval = this._onExperimentEval.bind(this);\n    this._fireSubscriptions = this._fireSubscriptions.bind(this);\n    this._recordChangedId = this._recordChangedId.bind(this);\n\n    if (options.remoteEval) {\n      if (options.decryptionKey) {\n        throw new Error(\"Encryption is not available for remoteEval\");\n      }\n      if (!options.clientKey) {\n        throw new Error(\"Missing clientKey\");\n      }\n      let isGbHost = false;\n      try {\n        isGbHost = !!new URL(options.apiHost || \"\").hostname.match(\n          /growthbook\\.io$/i,\n        );\n      } catch (e) {\n        // ignore invalid URLs\n      }\n      if (isGbHost) {\n        throw new Error(\"Cannot use remoteEval on GrowthBook Cloud\");\n      }\n    } else {\n      if (options.cacheKeyAttributes) {\n        throw new Error(\"cacheKeyAttributes are only used for remoteEval\");\n      }\n    }\n\n    if (options.stickyBucketService) {\n      const s = options.stickyBucketService;\n      this._saveStickyBucketAssignmentDoc = (doc) => {\n        return s.saveAssignments(doc);\n      };\n    }\n\n    if (options.plugins) {\n      for (const plugin of options.plugins) {\n        plugin(this);\n      }\n    }\n\n    if (options.features) {\n      this.ready = true;\n    }\n\n    if (isBrowser && options.enableDevMode) {\n      window._growthbook = this;\n      document.dispatchEvent(new Event(\"gbloaded\"));\n    }\n\n    if (options.experiments) {\n      this.ready = true;\n      this._updateAllAutoExperiments();\n    }\n\n    // Hydrate sticky bucket service\n    if (\n      this._options.stickyBucketService &&\n      this._options.stickyBucketAssignmentDocs\n    ) {\n      for (const key in this._options.stickyBucketAssignmentDocs) {\n        const doc = this._options.stickyBucketAssignmentDocs[key];\n        if (doc) {\n          this._options.stickyBucketService.saveAssignments(doc).catch(() => {\n            // Ignore hydration errors\n          });\n        }\n      }\n    }\n\n    // Legacy - passing in features/experiments into the constructor instead of using init\n    if (this.ready) {\n      this.refreshStickyBuckets(this.getPayload());\n    }\n  }\n\n  public async setPayload(payload: FeatureApiResponse): Promise<void> {\n    this._payload = payload;\n    const data = await decryptPayload(payload, this._options.decryptionKey);\n    this._decryptedPayload = data;\n    await this.refreshStickyBuckets(data);\n    if (data.features) {\n      this._options.features = data.features;\n    }\n    if (data.savedGroups) {\n      this._options.savedGroups = data.savedGroups;\n    }\n    if (data.experiments) {\n      this._options.experiments = data.experiments;\n      this._updateAllAutoExperiments();\n    }\n    this.ready = true;\n    this._render();\n  }\n\n  public initSync(options: InitSyncOptions): GrowthBook {\n    this._initialized = true;\n\n    const payload = options.payload;\n\n    if (payload.encryptedExperiments || payload.encryptedFeatures) {\n      throw new Error(\"initSync does not support encrypted payloads\");\n    }\n\n    if (\n      this._options.stickyBucketService &&\n      !this._options.stickyBucketAssignmentDocs\n    ) {\n      this._options.stickyBucketAssignmentDocs =\n        this.generateStickyBucketAssignmentDocsSync(\n          this._options.stickyBucketService as StickyBucketServiceSync,\n          payload,\n        );\n    }\n\n    this._payload = payload;\n    this._decryptedPayload = payload;\n    if (payload.features) {\n      this._options.features = payload.features;\n    }\n    if (payload.experiments) {\n      this._options.experiments = payload.experiments;\n      this._updateAllAutoExperiments();\n    }\n\n    this.ready = true;\n\n    startStreaming(this, options);\n\n    return this;\n  }\n\n  public async init(options?: InitOptions): Promise<InitResponse> {\n    this._initialized = true;\n    options = options || {};\n\n    if (options.cacheSettings) {\n      configureCache(options.cacheSettings);\n    }\n\n    if (options.payload) {\n      await this.setPayload(options.payload);\n      startStreaming(this, options);\n      return {\n        success: true,\n        source: \"init\",\n      };\n    } else {\n      const { data, ...res } = await this._refresh({\n        ...options,\n        allowStale: true,\n      });\n      startStreaming(this, options);\n      await this.setPayload(data || {});\n      return res;\n    }\n  }\n\n  /** @deprecated Use {@link init} */\n  public async loadFeatures(options?: LoadFeaturesOptions): Promise<void> {\n    options = options || {};\n    await this.init({\n      skipCache: options.skipCache,\n      timeout: options.timeout,\n      streaming:\n        (this._options.backgroundSync ?? true) &&\n        (options.autoRefresh || this._options.subscribeToChanges),\n    });\n  }\n\n  public async refreshFeatures(\n    options?: RefreshFeaturesOptions,\n  ): Promise<void> {\n    const res = await this._refresh({\n      ...(options || {}),\n      allowStale: false,\n    });\n    if (res.data) {\n      await this.setPayload(res.data);\n    }\n  }\n\n  public getApiInfo(): [ApiHost, ClientKey] {\n    return [this.getApiHosts().apiHost, this.getClientKey()];\n  }\n  public getApiHosts() {\n    return getApiHosts(this._options);\n  }\n  public getClientKey(): string {\n    return this._options.clientKey || \"\";\n  }\n  public getPayload(): FeatureApiResponse {\n    return (\n      this._payload || {\n        features: this.getFeatures(),\n        experiments: this.getExperiments(),\n      }\n    );\n  }\n  public getDecryptedPayload(): FeatureApiResponse {\n    return this._decryptedPayload || this.getPayload();\n  }\n\n  public isRemoteEval(): boolean {\n    return this._options.remoteEval || false;\n  }\n\n  public getCacheKeyAttributes(): (keyof Attributes)[] | undefined {\n    return this._options.cacheKeyAttributes;\n  }\n\n  private async _refresh({\n    timeout,\n    skipCache,\n    allowStale,\n    streaming,\n  }: RefreshFeaturesOptions & {\n    allowStale?: boolean;\n    streaming?: boolean;\n  }) {\n    if (!this._options.clientKey) {\n      throw new Error(\"Missing clientKey\");\n    }\n    // Trigger refresh in feature repository\n    return refreshFeatures({\n      instance: this,\n      timeout,\n      skipCache: skipCache || this._options.disableCache,\n      allowStale,\n      backgroundSync: streaming ?? this._options.backgroundSync ?? true,\n    });\n  }\n\n  private _render() {\n    if (this._renderer) {\n      try {\n        this._renderer();\n      } catch (e) {\n        console.error(\"Failed to render\", e);\n      }\n    }\n  }\n\n  /** @deprecated Use {@link setPayload} */\n  public setFeatures(features: Record<string, FeatureDefinition>) {\n    this._options.features = features;\n    this.ready = true;\n    this._render();\n  }\n\n  /** @deprecated Use {@link setPayload} */\n  public async setEncryptedFeatures(\n    encryptedString: string,\n    decryptionKey?: string,\n    subtle?: SubtleCrypto,\n  ): Promise<void> {\n    const featuresJSON = await decrypt(\n      encryptedString,\n      decryptionKey || this._options.decryptionKey,\n      subtle,\n    );\n    this.setFeatures(\n      JSON.parse(featuresJSON) as Record<string, FeatureDefinition>,\n    );\n  }\n\n  /** @deprecated Use {@link setPayload} */\n  public setExperiments(experiments: AutoExperiment[]): void {\n    this._options.experiments = experiments;\n    this.ready = true;\n    this._updateAllAutoExperiments();\n  }\n\n  /** @deprecated Use {@link setPayload} */\n  public async setEncryptedExperiments(\n    encryptedString: string,\n    decryptionKey?: string,\n    subtle?: SubtleCrypto,\n  ): Promise<void> {\n    const experimentsJSON = await decrypt(\n      encryptedString,\n      decryptionKey || this._options.decryptionKey,\n      subtle,\n    );\n    this.setExperiments(JSON.parse(experimentsJSON) as AutoExperiment[]);\n  }\n\n  public async setAttributes(attributes: Attributes) {\n    this._options.attributes = attributes;\n    if (this._options.stickyBucketService) {\n      await this.refreshStickyBuckets();\n    }\n    if (this._options.remoteEval) {\n      await this._refreshForRemoteEval();\n      return;\n    }\n    this._render();\n    this._updateAllAutoExperiments();\n  }\n\n  public async updateAttributes(attributes: Attributes) {\n    return this.setAttributes({ ...this._options.attributes, ...attributes });\n  }\n\n  public async setAttributeOverrides(overrides: Attributes) {\n    this._options.attributeOverrides = overrides;\n    if (this._options.stickyBucketService) {\n      await this.refreshStickyBuckets();\n    }\n    if (this._options.remoteEval) {\n      await this._refreshForRemoteEval();\n      return;\n    }\n    this._render();\n    this._updateAllAutoExperiments();\n  }\n\n  public async setForcedVariations(vars: Record<string, number>) {\n    this._options.forcedVariations = vars || {};\n    if (this._options.remoteEval) {\n      await this._refreshForRemoteEval();\n      return;\n    }\n    this._render();\n    this._updateAllAutoExperiments();\n  }\n\n  // eslint-disable-next-line\n  public setForcedFeatures(map: Map<string, any>) {\n    this._options.forcedFeatureValues = map;\n    this._render();\n  }\n\n  public async setURL(url: string) {\n    if (url === this._options.url) return;\n    this._options.url = url;\n    this._redirectedUrl = \"\";\n    if (this._options.remoteEval) {\n      await this._refreshForRemoteEval();\n      this._updateAllAutoExperiments(true);\n      return;\n    }\n    this._updateAllAutoExperiments(true);\n  }\n\n  public getAttributes() {\n    return { ...this._options.attributes, ...this._options.attributeOverrides };\n  }\n\n  public getForcedVariations() {\n    return this._options.forcedVariations || {};\n  }\n\n  public getForcedFeatures() {\n    // eslint-disable-next-line\n    return this._options.forcedFeatureValues || new Map<string, any>();\n  }\n\n  public getStickyBucketAssignmentDocs() {\n    return this._options.stickyBucketAssignmentDocs || {};\n  }\n\n  public getUrl() {\n    return this._options.url || \"\";\n  }\n\n  public getFeatures() {\n    return this._options.features || {};\n  }\n\n  public getExperiments() {\n    return this._options.experiments || [];\n  }\n\n  public getCompletedChangeIds(): string[] {\n    return Array.from(this._completedChangeIds);\n  }\n\n  public subscribe(cb: SubscriptionFunction): () => void {\n    this._subscriptions.add(cb);\n    return () => {\n      this._subscriptions.delete(cb);\n    };\n  }\n\n  private async _refreshForRemoteEval() {\n    if (!this._options.remoteEval) return;\n    if (!this._initialized) return;\n    const res = await this._refresh({\n      allowStale: false,\n    });\n    if (res.data) {\n      await this.setPayload(res.data);\n    }\n  }\n\n  public getAllResults() {\n    return new Map(this._assigned);\n  }\n\n  public onDestroy(cb: () => void) {\n    this._destroyCallbacks.push(cb);\n  }\n\n  public isDestroyed() {\n    return !!this._destroyed;\n  }\n\n  public destroy(options?: DestroyOptions) {\n    options = options || {};\n    this._destroyed = true;\n\n    // Custom callbacks\n    // Do this first in case it needs access to the below data that is cleared\n    this._destroyCallbacks.forEach((cb) => {\n      try {\n        cb();\n      } catch (e) {\n        console.error(e);\n      }\n    });\n\n    // Release references to save memory\n    this._subscriptions.clear();\n    this._assigned.clear();\n    this._trackedExperiments.clear();\n    this._completedChangeIds.clear();\n    this._deferredTrackingCalls.clear();\n    this._trackedFeatures = {};\n    this._destroyCallbacks = [];\n    this._payload = undefined;\n    this._saveStickyBucketAssignmentDoc = undefined;\n    unsubscribe(this);\n    if (options.destroyAllStreams) {\n      clearAutoRefresh();\n    }\n    this.logs = [];\n\n    if (isBrowser && window._growthbook === this) {\n      delete window._growthbook;\n    }\n\n    // Undo any active auto experiments\n    this._activeAutoExperiments.forEach((exp) => {\n      exp.undo();\n    });\n    this._activeAutoExperiments.clear();\n    this._triggeredExpKeys.clear();\n  }\n\n  public setRenderer(renderer: null | RenderFunction) {\n    this._renderer = renderer;\n  }\n\n  public forceVariation(key: string, variation: number) {\n    this._options.forcedVariations = this._options.forcedVariations || {};\n    this._options.forcedVariations[key] = variation;\n    if (this._options.remoteEval) {\n      this._refreshForRemoteEval();\n      return;\n    }\n    this._updateAllAutoExperiments();\n    this._render();\n  }\n\n  public run<T>(experiment: Experiment<T>): Result<T> {\n    const { result } = runExperiment(experiment, null, this._getEvalContext());\n    this._onExperimentEval(experiment, result);\n    return result;\n  }\n\n  public triggerExperiment(key: string) {\n    this._triggeredExpKeys.add(key);\n    if (!this._options.experiments) return null;\n    const experiments = this._options.experiments.filter(\n      (exp) => exp.key === key,\n    );\n    return experiments\n      .map((exp) => {\n        return this._runAutoExperiment(exp);\n      })\n      .filter((res) => res !== null);\n  }\n\n  public triggerAutoExperiments() {\n    this._autoExperimentsAllowed = true;\n    this._updateAllAutoExperiments(true);\n  }\n\n  private _getEvalContext(): EvalContext {\n    return {\n      user: this._getUserContext(),\n      global: this._getGlobalContext(),\n      stack: {\n        evaluatedFeatures: new Set(),\n      },\n    };\n  }\n\n  private _getUserContext(): UserContext {\n    return {\n      attributes: this._options.user\n        ? {\n            ...this._options.user,\n            ...this._options.attributes,\n          }\n        : this._options.attributes,\n      enableDevMode: this._options.enableDevMode,\n      blockedChangeIds: this._options.blockedChangeIds,\n      stickyBucketAssignmentDocs: this._options.stickyBucketAssignmentDocs,\n      url: this._getContextUrl(),\n      forcedVariations: this._options.forcedVariations,\n      forcedFeatureValues: this._options.forcedFeatureValues,\n      attributeOverrides: this._options.attributeOverrides,\n      saveStickyBucketAssignmentDoc: this._saveStickyBucketAssignmentDoc,\n      trackingCallback: this._options.trackingCallback,\n      onFeatureUsage: this._options.onFeatureUsage,\n      devLogs: this.logs,\n      trackedExperiments: this._trackedExperiments,\n      trackedFeatureUsage: this._trackedFeatures,\n    };\n  }\n  private _getGlobalContext(): GlobalContext {\n    return {\n      features: this._options.features,\n      experiments: this._options.experiments,\n      log: this.log,\n      enabled: this._options.enabled,\n      qaMode: this._options.qaMode,\n      savedGroups: this._options.savedGroups,\n      groups: this._options.groups,\n      overrides: this._options.overrides,\n      onExperimentEval: this._onExperimentEval,\n      recordChangeId: this._recordChangedId,\n      saveDeferredTrack: this._saveDeferredTrack,\n      eventLogger: this._options.eventLogger,\n    };\n  }\n\n  private _runAutoExperiment(experiment: AutoExperiment, forceRerun?: boolean) {\n    const existing = this._activeAutoExperiments.get(experiment);\n\n    // If this is a manual experiment and it's not already running, skip\n    if (\n      experiment.manual &&\n      !this._triggeredExpKeys.has(experiment.key) &&\n      !existing\n    )\n      return null;\n\n    // Check if this particular experiment is blocked by options settings\n    // For example, if all visualEditor experiments are disabled\n    const isBlocked = this._isAutoExperimentBlockedByContext(experiment);\n    if (isBlocked) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Auto experiment blocked\", { id: experiment.key });\n    }\n\n    let result: Result<AutoExperimentVariation> | undefined;\n    let trackingCall: Promise<void> | undefined;\n    // Run the experiment (if blocked exclude)\n    if (isBlocked) {\n      result = getExperimentResult(\n        this._getEvalContext(),\n        experiment,\n        -1,\n        false,\n        \"\",\n      );\n    } else {\n      ({ result, trackingCall } = runExperiment(\n        experiment,\n        null,\n        this._getEvalContext(),\n      ));\n      this._onExperimentEval(experiment, result);\n    }\n\n    // A hash to quickly tell if the assigned value changed\n    const valueHash = JSON.stringify(result.value);\n\n    // If the changes are already active, no need to re-apply them\n    if (\n      !forceRerun &&\n      result.inExperiment &&\n      existing &&\n      existing.valueHash === valueHash\n    ) {\n      return result;\n    }\n\n    // Undo any existing changes\n    if (existing) this._undoActiveAutoExperiment(experiment);\n\n    // Apply new changes\n    if (result.inExperiment) {\n      const changeType = getAutoExperimentChangeType(experiment);\n\n      if (\n        changeType === \"redirect\" &&\n        result.value.urlRedirect &&\n        experiment.urlPatterns\n      ) {\n        const url = experiment.persistQueryString\n          ? mergeQueryStrings(this._getContextUrl(), result.value.urlRedirect)\n          : result.value.urlRedirect;\n\n        if (isURLTargeted(url, experiment.urlPatterns)) {\n          this.log(\n            \"Skipping redirect because original URL matches redirect URL\",\n            {\n              id: experiment.key,\n            },\n          );\n          return result;\n        }\n        this._redirectedUrl = url;\n        const { navigate, delay } = this._getNavigateFunction();\n        if (navigate) {\n          if (isBrowser) {\n            // Wait for the possibly-async tracking callback, bound by min and max delays\n            Promise.all([\n              ...(trackingCall\n                ? [\n                    promiseTimeout(\n                      trackingCall,\n                      this._options.maxNavigateDelay ?? 1000,\n                    ),\n                  ]\n                : []),\n              new Promise((resolve) =>\n                window.setTimeout(\n                  resolve,\n                  this._options.navigateDelay ?? delay,\n                ),\n              ),\n            ]).then(() => {\n              try {\n                navigate(url);\n              } catch (e) {\n                console.error(e);\n              }\n            });\n          } else {\n            try {\n              navigate(url);\n            } catch (e) {\n              console.error(e);\n            }\n          }\n        }\n      } else if (changeType === \"visual\") {\n        const undo = this._options.applyDomChangesCallback\n          ? this._options.applyDomChangesCallback(result.value)\n          : this._applyDOMChanges(result.value);\n        if (undo) {\n          this._activeAutoExperiments.set(experiment, {\n            undo,\n            valueHash,\n          });\n        }\n      }\n    }\n\n    return result;\n  }\n\n  private _undoActiveAutoExperiment(exp: AutoExperiment) {\n    const data = this._activeAutoExperiments.get(exp);\n    if (data) {\n      data.undo();\n      this._activeAutoExperiments.delete(exp);\n    }\n  }\n\n  private _updateAllAutoExperiments(forceRerun?: boolean) {\n    if (!this._autoExperimentsAllowed) return;\n\n    const experiments = this._options.experiments || [];\n\n    // Stop any experiments that are no longer defined\n    const keys = new Set(experiments);\n    this._activeAutoExperiments.forEach((v, k) => {\n      if (!keys.has(k)) {\n        v.undo();\n        this._activeAutoExperiments.delete(k);\n      }\n    });\n\n    // Re-run all new/updated experiments\n    for (const exp of experiments) {\n      const result = this._runAutoExperiment(exp, forceRerun);\n\n      // Once you're in a redirect experiment, break out of the loop and don't run any further experiments\n      if (\n        result &&\n        result.inExperiment &&\n        getAutoExperimentChangeType(exp) === \"redirect\"\n      ) {\n        break;\n      }\n    }\n  }\n\n  private _onExperimentEval<T>(experiment: Experiment<T>, result: Result<T>) {\n    const prev = this._assigned.get(experiment.key);\n    this._assigned.set(experiment.key, { experiment, result });\n    if (this._subscriptions.size > 0) {\n      this._fireSubscriptions<T>(experiment, result, prev);\n    }\n  }\n\n  private _fireSubscriptions<T>(\n    experiment: Experiment<T>,\n    result: Result<T>,\n    // eslint-disable-next-line\n    prev?: { experiment: Experiment<any>; result: Result<any> },\n  ) {\n    // If assigned variation has changed, fire subscriptions\n    // TODO: what if the experiment definition has changed?\n    if (\n      !prev ||\n      prev.result.inExperiment !== result.inExperiment ||\n      prev.result.variationId !== result.variationId\n    ) {\n      this._subscriptions.forEach((cb) => {\n        try {\n          cb(experiment, result);\n        } catch (e) {\n          console.error(e);\n        }\n      });\n    }\n  }\n\n  private _recordChangedId(id: string) {\n    this._completedChangeIds.add(id);\n  }\n\n  public isOn<K extends string & keyof AppFeatures = string>(key: K): boolean {\n    return this.evalFeature(key).on;\n  }\n\n  public isOff<K extends string & keyof AppFeatures = string>(key: K): boolean {\n    return this.evalFeature(key).off;\n  }\n\n  public getFeatureValue<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string,\n  >(key: K, defaultValue: V): WidenPrimitives<V> {\n    const value = this.evalFeature<WidenPrimitives<V>, K>(key).value;\n    return value === null ? (defaultValue as WidenPrimitives<V>) : value;\n  }\n\n  /**\n   * @deprecated Use {@link evalFeature}\n   * @param id\n   */\n\n  public feature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string,\n  >(id: K): FeatureResult<V | null> {\n    return this.evalFeature(id);\n  }\n\n  public evalFeature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string,\n  >(id: K): FeatureResult<V | null> {\n    return _evalFeature(id, this._getEvalContext());\n  }\n\n  log(msg: string, ctx: Record<string, unknown>) {\n    if (!this.debug) return;\n    if (this._options.log) this._options.log(msg, ctx);\n    else console.log(msg, ctx);\n  }\n\n  public getDeferredTrackingCalls(): TrackingData[] {\n    return Array.from(this._deferredTrackingCalls.values());\n  }\n\n  public setDeferredTrackingCalls(calls: TrackingData[]) {\n    this._deferredTrackingCalls = new Map(\n      calls\n        .filter((c) => c && c.experiment && c.result)\n        .map((c) => {\n          return [getExperimentDedupeKey(c.experiment, c.result), c];\n        }),\n    );\n  }\n\n  public async fireDeferredTrackingCalls() {\n    if (!this._options.trackingCallback) return;\n\n    const promises: ReturnType<TrackingCallback>[] = [];\n    this._deferredTrackingCalls.forEach((call: TrackingData) => {\n      if (!call || !call.experiment || !call.result) {\n        console.error(\"Invalid deferred tracking call\", { call: call });\n      } else {\n        promises.push(\n          (this._options.trackingCallback as TrackingCallback)(\n            call.experiment,\n            call.result,\n          ),\n        );\n      }\n    });\n    this._deferredTrackingCalls.clear();\n    await Promise.all(promises);\n  }\n\n  public setTrackingCallback(callback: TrackingCallback) {\n    this._options.trackingCallback = callback;\n    this.fireDeferredTrackingCalls();\n  }\n\n  public setFeatureUsageCallback(callback: FeatureUsageCallback) {\n    this._options.onFeatureUsage = callback;\n  }\n\n  public setEventLogger(logger: EventLogger) {\n    this._options.eventLogger = logger;\n  }\n\n  public async logEvent(\n    eventName: string,\n    properties?: Record<string, unknown>,\n  ) {\n    if (this._destroyed) {\n      console.error(\"Cannot log event to destroyed GrowthBook instance\");\n      return;\n    }\n    if (this._options.enableDevMode) {\n      this.logs.push({\n        eventName,\n        properties,\n        timestamp: Date.now().toString(),\n        logType: \"event\",\n      });\n    }\n    if (this._options.eventLogger) {\n      try {\n        await this._options.eventLogger(\n          eventName,\n          properties || {},\n          this._getUserContext(),\n        );\n      } catch (e) {\n        console.error(e);\n      }\n    } else {\n      console.error(\"No event logger configured\");\n    }\n  }\n\n  private _saveDeferredTrack(data: TrackingData) {\n    this._deferredTrackingCalls.set(\n      getExperimentDedupeKey(data.experiment, data.result),\n      data,\n    );\n  }\n\n  private _getContextUrl() {\n    return this._options.url || (isBrowser ? window.location.href : \"\");\n  }\n\n  private _isAutoExperimentBlockedByContext(\n    experiment: AutoExperiment,\n  ): boolean {\n    const changeType = getAutoExperimentChangeType(experiment);\n    if (changeType === \"visual\") {\n      if (this._options.disableVisualExperiments) return true;\n\n      if (this._options.disableJsInjection) {\n        if (experiment.variations.some((v) => v.js)) {\n          return true;\n        }\n      }\n    } else if (changeType === \"redirect\") {\n      if (this._options.disableUrlRedirectExperiments) return true;\n\n      // Validate URLs\n      try {\n        const current = new URL(this._getContextUrl());\n        for (const v of experiment.variations) {\n          if (!v || !v.urlRedirect) continue;\n          const url = new URL(v.urlRedirect);\n\n          // If we're blocking cross origin redirects, block if the protocol or host is different\n          if (this._options.disableCrossOriginUrlRedirectExperiments) {\n            if (url.protocol !== current.protocol) return true;\n            if (url.host !== current.host) return true;\n          }\n        }\n      } catch (e) {\n        // Problem parsing one of the URLs\n        this.log(\"Error parsing current or redirect URL\", {\n          id: experiment.key,\n          error: e,\n        });\n        return true;\n      }\n    } else {\n      // Block any unknown changeTypes\n      return true;\n    }\n\n    if (\n      experiment.changeId &&\n      (this._options.blockedChangeIds || []).includes(experiment.changeId)\n    ) {\n      return true;\n    }\n\n    return false;\n  }\n\n  public getRedirectUrl(): string {\n    return this._redirectedUrl;\n  }\n\n  private _getNavigateFunction(): {\n    navigate: null | ((url: string) => void | Promise<void>);\n    delay: number;\n  } {\n    if (this._options.navigate) {\n      return {\n        navigate: this._options.navigate,\n        delay: 0,\n      };\n    } else if (isBrowser) {\n      return {\n        navigate: (url: string) => {\n          window.location.replace(url);\n        },\n        delay: 100,\n      };\n    }\n    return {\n      navigate: null,\n      delay: 0,\n    };\n  }\n\n  private _applyDOMChanges(changes: AutoExperimentVariation) {\n    if (!isBrowser) return;\n    const undo: (() => void)[] = [];\n    if (changes.css) {\n      const s = document.createElement(\"style\");\n      s.innerHTML = changes.css;\n      document.head.appendChild(s);\n      undo.push(() => s.remove());\n    }\n    if (changes.js) {\n      const script = document.createElement(\"script\");\n      script.innerHTML = changes.js;\n      if (this._options.jsInjectionNonce) {\n        script.nonce = this._options.jsInjectionNonce;\n      }\n      document.head.appendChild(script);\n      undo.push(() => script.remove());\n    }\n    if (changes.domMutations) {\n      changes.domMutations.forEach((mutation) => {\n        undo.push(mutate.declarative(mutation as DeclarativeMutation).revert);\n      });\n    }\n    return () => {\n      undo.forEach((fn) => fn());\n    };\n  }\n\n  public async refreshStickyBuckets(data?: FeatureApiResponse) {\n    if (this._options.stickyBucketService) {\n      const ctx = this._getEvalContext();\n      const docs = await getAllStickyBucketAssignmentDocs(\n        ctx,\n        this._options.stickyBucketService,\n        data,\n      );\n      this._options.stickyBucketAssignmentDocs = docs;\n    }\n  }\n\n  public generateStickyBucketAssignmentDocsSync(\n    stickyBucketService: StickyBucketServiceSync,\n    payload: FeatureApiResponse,\n  ) {\n    if (!(\"getAllAssignmentsSync\" in stickyBucketService)) {\n      console.error(\n        \"generating StickyBucketAssignmentDocs docs requires StickyBucketServiceSync\",\n      );\n      return;\n    }\n    const ctx = this._getEvalContext();\n    const attributes = getStickyBucketAttributes(ctx, payload);\n    return stickyBucketService.getAllAssignmentsSync(attributes);\n  }\n\n  public inDevMode(): boolean {\n    return !!this._options.enableDevMode;\n  }\n}\n\nexport async function prefetchPayload(options: PrefetchOptions) {\n  // Create a temporary instance, just to fetch the payload\n  const instance = new GrowthBook(options);\n\n  await refreshFeatures({\n    instance,\n    skipCache: options.skipCache,\n    allowStale: false,\n    backgroundSync: options.streaming,\n  });\n\n  instance.destroy();\n}\n","import type {\n  ApiHost,\n  Attributes,\n  AutoExperiment,\n  ClientKey,\n  ClientOptions,\n  DestroyOptions,\n  EvalContext,\n  EventLogger,\n  EventProperties,\n  Experiment,\n  FeatureApiResponse,\n  FeatureDefinitions,\n  FeatureResult,\n  GlobalContext,\n  InitOptions,\n  InitResponse,\n  InitSyncOptions,\n  LogUnion,\n  Plugin,\n  RefreshFeaturesOptions,\n  Result,\n  TrackingCallback,\n  TrackingCallbackWithUser,\n  UserContext,\n  WidenPrimitives,\n} from \"./types/growthbook\";\nimport { loadSDKVersion } from \"./util\";\nimport {\n  clearAutoRefresh,\n  configureCache,\n  refreshFeatures,\n  startStreaming,\n  unsubscribe,\n} from \"./feature-repository\";\nimport {\n  decryptPayload,\n  evalFeature as _evalFeature,\n  getAllStickyBucketAssignmentDocs,\n  getApiHosts,\n  runExperiment,\n} from \"./core\";\nimport { StickyBucketService } from \"./sticky-bucket-service\";\n\nconst SDK_VERSION = loadSDKVersion();\n\nexport class GrowthBookClient<\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  AppFeatures extends Record<string, any> = Record<string, any>,\n> {\n  public debug: boolean;\n  public ready: boolean;\n  public version: string;\n\n  // Properties and methods that start with \"_\" are mangled by Terser (saves ~150 bytes)\n  private _options: ClientOptions;\n\n  private _features: FeatureDefinitions;\n  private _experiments: AutoExperiment[];\n  private _payload: FeatureApiResponse | undefined;\n  private _decryptedPayload: FeatureApiResponse | undefined;\n  private _destroyed?: boolean;\n\n  constructor(options?: ClientOptions) {\n    options = options || {};\n    // These properties are all initialized in the constructor instead of above\n    // This saves ~80 bytes in the final output\n    this.version = SDK_VERSION;\n    this._options = options;\n    this.debug = !!options.debug;\n    this.ready = false;\n    this._features = {};\n    this._experiments = [];\n\n    this.log = this.log.bind(this);\n\n    if (options.plugins) {\n      for (const plugin of options.plugins) {\n        plugin(this);\n      }\n    }\n  }\n\n  public async setPayload(payload: FeatureApiResponse): Promise<void> {\n    this._payload = payload;\n    const data = await decryptPayload(payload, this._options.decryptionKey);\n    this._decryptedPayload = data;\n    if (data.features) {\n      this._features = data.features;\n    }\n    if (data.experiments) {\n      this._experiments = data.experiments;\n    }\n    if (data.savedGroups) {\n      this._options.savedGroups = data.savedGroups;\n    }\n    this.ready = true;\n  }\n\n  public initSync(options: InitSyncOptions): GrowthBookClient<AppFeatures> {\n    const payload = options.payload;\n\n    if (payload.encryptedExperiments || payload.encryptedFeatures) {\n      throw new Error(\"initSync does not support encrypted payloads\");\n    }\n\n    this._payload = payload;\n    this._decryptedPayload = payload;\n    if (payload.features) {\n      this._features = payload.features;\n    }\n    if (payload.experiments) {\n      this._experiments = payload.experiments;\n    }\n\n    this.ready = true;\n\n    startStreaming(this, options);\n\n    return this;\n  }\n\n  public async init(options?: InitOptions): Promise<InitResponse> {\n    options = options || {};\n\n    if (options.cacheSettings) {\n      configureCache(options.cacheSettings);\n    }\n\n    if (options.payload) {\n      await this.setPayload(options.payload);\n      startStreaming(this, options);\n      return {\n        success: true,\n        source: \"init\",\n      };\n    } else {\n      const { data, ...res } = await this._refresh({\n        ...options,\n        allowStale: true,\n      });\n      startStreaming(this, options);\n      await this.setPayload(data || {});\n      return res;\n    }\n  }\n\n  public async refreshFeatures(\n    options?: RefreshFeaturesOptions,\n  ): Promise<void> {\n    const res = await this._refresh({\n      ...(options || {}),\n      allowStale: false,\n    });\n    if (res.data) {\n      await this.setPayload(res.data);\n    }\n  }\n\n  public getApiInfo(): [ApiHost, ClientKey] {\n    return [this.getApiHosts().apiHost, this.getClientKey()];\n  }\n  public getApiHosts() {\n    return getApiHosts(this._options);\n  }\n  public getClientKey(): string {\n    return this._options.clientKey || \"\";\n  }\n  public getPayload(): FeatureApiResponse {\n    return (\n      this._payload || {\n        features: this.getFeatures(),\n        experiments: this._experiments || [],\n      }\n    );\n  }\n  public getDecryptedPayload(): FeatureApiResponse {\n    return this._decryptedPayload || this.getPayload();\n  }\n\n  private async _refresh({\n    timeout,\n    skipCache,\n    allowStale,\n    streaming,\n  }: RefreshFeaturesOptions & {\n    allowStale?: boolean;\n    streaming?: boolean;\n  }) {\n    if (!this._options.clientKey) {\n      throw new Error(\"Missing clientKey\");\n    }\n    // Trigger refresh in feature repository\n    return refreshFeatures({\n      instance: this,\n      timeout,\n      skipCache: skipCache || this._options.disableCache,\n      allowStale,\n      backgroundSync: streaming ?? true,\n    });\n  }\n\n  public getFeatures() {\n    return this._features || {};\n  }\n\n  public getGlobalAttributes(): Attributes {\n    return this._options.globalAttributes || {};\n  }\n  public setGlobalAttributes(attributes: Attributes) {\n    this._options.globalAttributes = attributes;\n  }\n\n  public destroy(options?: DestroyOptions) {\n    options = options || {};\n    this._destroyed = true;\n    unsubscribe(this);\n    if (options.destroyAllStreams) {\n      clearAutoRefresh();\n    }\n\n    // Release references to save memory\n    this._features = {};\n    this._experiments = [];\n    this._decryptedPayload = undefined;\n    this._payload = undefined;\n    this._options = {};\n  }\n\n  public isDestroyed() {\n    return !!this._destroyed;\n  }\n\n  public setEventLogger(logger: EventLogger) {\n    this._options.eventLogger = logger;\n  }\n\n  public logEvent(\n    eventName: string,\n    properties: EventProperties,\n    userContext: UserContext,\n  ) {\n    if (this._options.eventLogger) {\n      const ctx = this._getEvalContext(userContext);\n      this._options.eventLogger(eventName, properties, ctx.user);\n    }\n  }\n\n  public runInlineExperiment<T>(\n    experiment: Experiment<T>,\n    userContext: UserContext,\n  ): Result<T> {\n    const { result } = runExperiment(\n      experiment,\n      null,\n      this._getEvalContext(userContext),\n    );\n    return result;\n  }\n\n  private _getEvalContext(userContext: UserContext): EvalContext {\n    if (this._options.globalAttributes) {\n      userContext = {\n        ...userContext,\n        attributes: {\n          ...this._options.globalAttributes,\n          ...userContext.attributes,\n        },\n      };\n    }\n\n    return {\n      user: userContext,\n      global: this._getGlobalContext(),\n      stack: {\n        evaluatedFeatures: new Set(),\n      },\n    };\n  }\n\n  private _getGlobalContext(): GlobalContext {\n    return {\n      features: this._features,\n      experiments: this._experiments,\n      log: this.log,\n      enabled: this._options.enabled,\n      qaMode: this._options.qaMode,\n      savedGroups: this._options.savedGroups,\n      forcedFeatureValues: this._options.forcedFeatureValues,\n      forcedVariations: this._options.forcedVariations,\n      trackingCallback: this._options.trackingCallback,\n      onFeatureUsage: this._options.onFeatureUsage,\n    };\n  }\n\n  public isOn<K extends string & keyof AppFeatures = string>(\n    key: K,\n    userContext: UserContext,\n  ): boolean {\n    return this.evalFeature(key, userContext).on;\n  }\n\n  public isOff<K extends string & keyof AppFeatures = string>(\n    key: K,\n    userContext: UserContext,\n  ): boolean {\n    return this.evalFeature(key, userContext).off;\n  }\n\n  public getFeatureValue<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string,\n  >(key: K, defaultValue: V, userContext: UserContext): WidenPrimitives<V> {\n    const value = this.evalFeature<WidenPrimitives<V>, K>(\n      key,\n      userContext,\n    ).value;\n    return value === null ? (defaultValue as WidenPrimitives<V>) : value;\n  }\n\n  public evalFeature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string,\n  >(id: K, userContext: UserContext): FeatureResult<V | null> {\n    return _evalFeature(id, this._getEvalContext(userContext));\n  }\n\n  log(msg: string, ctx: Record<string, unknown>) {\n    if (!this.debug) return;\n    if (this._options.log) this._options.log(msg, ctx);\n    else console.log(msg, ctx);\n  }\n\n  public setTrackingCallback(callback: TrackingCallbackWithUser) {\n    this._options.trackingCallback = callback;\n  }\n\n  public async applyStickyBuckets(\n    partialContext: Omit<\n      UserContext,\n      \"stickyBucketService\" | \"stickyBucketAssignmentDocs\"\n    >,\n    stickyBucketService: StickyBucketService,\n  ): Promise<UserContext> {\n    const ctx = this._getEvalContext(partialContext);\n\n    const stickyBucketAssignmentDocs = await getAllStickyBucketAssignmentDocs(\n      ctx,\n      stickyBucketService,\n    );\n\n    return {\n      ...partialContext,\n      stickyBucketAssignmentDocs,\n      saveStickyBucketAssignmentDoc: (doc) =>\n        stickyBucketService.saveAssignments(doc),\n    };\n  }\n\n  public createScopedInstance(\n    userContext: UserContext,\n    userPlugins?: Plugin[],\n  ) {\n    return new UserScopedGrowthBook(this, userContext, [\n      ...(this._options.plugins || []),\n      ...(userPlugins || []),\n    ]);\n  }\n}\n\nexport class UserScopedGrowthBook<\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  AppFeatures extends Record<string, any> = Record<string, any>,\n> {\n  private _gb: GrowthBookClient;\n  private _userContext: UserContext;\n  public logs: Array<LogUnion>;\n\n  constructor(\n    gb: GrowthBookClient<AppFeatures>,\n    userContext: UserContext,\n    plugins?: Plugin[],\n  ) {\n    this._gb = gb;\n    this._userContext = userContext;\n    this.logs = [];\n\n    this._userContext.trackedExperiments =\n      this._userContext.trackedExperiments || new Set();\n    this._userContext.trackedFeatureUsage =\n      this._userContext.trackedFeatureUsage || {};\n    this._userContext.devLogs = this.logs;\n\n    if (plugins) {\n      for (const plugin of plugins) {\n        plugin(this);\n      }\n    }\n  }\n\n  public runInlineExperiment<T>(experiment: Experiment<T>): Result<T> {\n    return this._gb.runInlineExperiment(experiment, this._userContext);\n  }\n\n  public isOn<K extends string & keyof AppFeatures = string>(key: K): boolean {\n    return this._gb.isOn(key, this._userContext);\n  }\n\n  public isOff<K extends string & keyof AppFeatures = string>(key: K): boolean {\n    return this._gb.isOff(key, this._userContext);\n  }\n\n  public getFeatureValue<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string,\n  >(key: K, defaultValue: V): WidenPrimitives<V> {\n    return this._gb.getFeatureValue(key, defaultValue, this._userContext);\n  }\n\n  public evalFeature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string,\n  >(id: K): FeatureResult<V | null> {\n    return this._gb.evalFeature(id, this._userContext);\n  }\n\n  public logEvent(eventName: string, properties?: EventProperties) {\n    if (this._userContext.enableDevMode) {\n      this.logs.push({\n        eventName,\n        properties,\n        timestamp: Date.now().toString(),\n        logType: \"event\",\n      });\n    }\n    this._gb.logEvent(eventName, properties || {}, this._userContext);\n  }\n\n  public setTrackingCallback(cb: TrackingCallback) {\n    this._userContext.trackingCallback = cb;\n  }\n  public getApiInfo(): [ApiHost, ClientKey] {\n    return this._gb.getApiInfo();\n  }\n  public getClientKey() {\n    return this._gb.getClientKey();\n  }\n  public setURL(url: string) {\n    this._userContext.url = url;\n  }\n  public updateAttributes(attributes: Attributes) {\n    this._userContext.attributes = {\n      ...this._userContext.attributes,\n      ...attributes,\n    };\n  }\n  public setAttributeOverrides(overrides: Attributes) {\n    this._userContext.attributeOverrides = overrides;\n  }\n  public async setForcedVariations(vars: Record<string, number>) {\n    this._userContext.forcedVariations = vars || {};\n  }\n  // eslint-disable-next-line\n  public setForcedFeatures(map: Map<string, any>) {\n    this._userContext.forcedFeatureValues = map;\n  }\n  public getUserContext() {\n    return this._userContext;\n  }\n  public getVersion() {\n    return SDK_VERSION;\n  }\n  public getDecryptedPayload() {\n    return this._gb.getDecryptedPayload();\n  }\n  public inDevMode(): boolean {\n    return !!this._userContext.enableDevMode;\n  }\n}\n","import {\n  LocalStorageCompat,\n  StickyAssignmentsDocument,\n  StickyAttributeKey,\n} from \"./types/growthbook\";\nimport { toString } from \"./util\";\nimport { getStickyBucketAttributeKey } from \"./core\";\n\nexport interface CookieAttributes {\n  expires?: number | Date | undefined;\n  path?: string | undefined;\n  domain?: string | undefined;\n  secure?: boolean | undefined;\n  sameSite?: \"strict\" | \"Strict\" | \"lax\" | \"Lax\" | \"none\" | \"None\" | undefined;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [property: string]: any;\n}\nexport interface JsCookiesCompat<T = string> {\n  set(\n    name: string,\n    value: string | T,\n    options?: CookieAttributes,\n  ): string | undefined;\n  get(name: string): string | T | undefined;\n  get(): { [key: string]: string };\n  remove(name: string, options?: CookieAttributes): void;\n}\n\nexport interface IORedisCompat {\n  mget(...keys: string[]): Promise<string[]>;\n  set(key: string, value: string): Promise<string>;\n}\n\nexport interface RequestCompat {\n  cookies: Record<string, string>;\n  [key: string]: unknown;\n}\nexport interface ResponseCompat {\n  cookie(\n    name: string,\n    value: string,\n    options?: CookieAttributes,\n  ): ResponseCompat;\n  [key: string]: unknown;\n}\n\n/**\n * Responsible for reading and writing documents which describe sticky bucket assignments.\n */\nexport abstract class StickyBucketService {\n  protected prefix: string;\n\n  constructor(opts?: { prefix?: string }) {\n    opts = opts || {};\n    this.prefix = opts.prefix || \"\";\n  }\n\n  abstract getAssignments(\n    attributeName: string,\n    attributeValue: string,\n  ): Promise<StickyAssignmentsDocument | null>;\n\n  abstract saveAssignments(doc: StickyAssignmentsDocument): Promise<unknown>;\n\n  /**\n   * The SDK calls getAllAssignments to populate sticky buckets. This in turn will\n   * typically loop through individual getAssignments calls. However, some StickyBucketService\n   * instances (i.e. Redis) will instead perform a multi-query inside getAllAssignments instead.\n   */\n  async getAllAssignments(\n    attributes: Record<string, string>,\n  ): Promise<Record<StickyAttributeKey, StickyAssignmentsDocument>> {\n    const docs: Record<string, StickyAssignmentsDocument> = {};\n    (\n      await Promise.all(\n        Object.entries(attributes).map(([attributeName, attributeValue]) =>\n          this.getAssignments(attributeName, attributeValue),\n        ),\n      )\n    ).forEach((doc) => {\n      if (doc) {\n        const key = getStickyBucketAttributeKey(\n          doc.attributeName,\n          doc.attributeValue,\n        );\n        docs[key] = doc;\n      }\n    });\n    return docs;\n  }\n\n  getKey(attributeName: string, attributeValue: string): string {\n    return `${this.prefix}${attributeName}||${attributeValue}`;\n  }\n}\n\nexport abstract class StickyBucketServiceSync extends StickyBucketService {\n  abstract getAssignmentsSync(\n    attributeName: string,\n    attributeValue: string,\n  ): StickyAssignmentsDocument | null;\n\n  abstract saveAssignmentsSync(doc: StickyAssignmentsDocument): void;\n\n  async getAssignments(attributeName: string, attributeValue: string) {\n    return this.getAssignmentsSync(attributeName, attributeValue);\n  }\n\n  async saveAssignments(doc: StickyAssignmentsDocument) {\n    this.saveAssignmentsSync(doc);\n  }\n\n  getAllAssignmentsSync(\n    attributes: Record<string, string>,\n  ): Record<StickyAttributeKey, StickyAssignmentsDocument> {\n    const docs: Record<string, StickyAssignmentsDocument> = {};\n    Object.entries(attributes)\n      .map(([attributeName, attributeValue]) =>\n        this.getAssignmentsSync(attributeName, attributeValue),\n      )\n      .forEach((doc) => {\n        if (doc) {\n          const key = getStickyBucketAttributeKey(\n            doc.attributeName,\n            doc.attributeValue,\n          );\n          docs[key] = doc;\n        }\n      });\n    return docs;\n  }\n}\n\nexport class LocalStorageStickyBucketService extends StickyBucketService {\n  private localStorage: LocalStorageCompat | undefined;\n  constructor(opts?: { prefix?: string; localStorage?: LocalStorageCompat }) {\n    opts = opts || {};\n    super();\n    this.prefix = opts.prefix || \"gbStickyBuckets__\";\n    try {\n      this.localStorage = opts.localStorage || globalThis.localStorage;\n    } catch (e) {\n      // Ignore localStorage errors\n    }\n  }\n  async getAssignments(attributeName: string, attributeValue: string) {\n    const key = this.getKey(attributeName, attributeValue);\n    let doc: StickyAssignmentsDocument | null = null;\n    if (!this.localStorage) return doc;\n    try {\n      const raw = (await this.localStorage.getItem(key)) || \"{}\";\n      const data = JSON.parse(raw);\n      if (data.attributeName && data.attributeValue && data.assignments) {\n        doc = data;\n      }\n    } catch (e) {\n      // Ignore localStorage errors\n    }\n    return doc;\n  }\n  async saveAssignments(doc: StickyAssignmentsDocument) {\n    const key = this.getKey(doc.attributeName, doc.attributeValue);\n    if (!this.localStorage) return;\n    try {\n      await this.localStorage.setItem(key, JSON.stringify(doc));\n    } catch (e) {\n      // Ignore localStorage errors\n    }\n  }\n}\n\nexport class ExpressCookieStickyBucketService extends StickyBucketServiceSync {\n  /**\n   * Intended to be used with cookieParser() middleware from npm: 'cookie-parser'.\n   * Assumes:\n   *  - reading a cookie is automatically decoded via decodeURIComponent() or similar\n   *  - writing a cookie name & value must be manually encoded via encodeURIComponent() or similar\n   *  - all cookie bodies are JSON encoded strings and are manually encoded/decoded\n   */\n  private req: RequestCompat;\n  private res: ResponseCompat;\n  private cookieAttributes: CookieAttributes;\n  constructor({\n    prefix = \"gbStickyBuckets__\",\n    req,\n    res,\n    cookieAttributes = { maxAge: 180 * 24 * 3600 * 1000 }, // 180 days\n  }: {\n    prefix?: string;\n    req: RequestCompat;\n    res: ResponseCompat;\n    cookieAttributes?: CookieAttributes;\n  }) {\n    super();\n    this.prefix = prefix;\n    this.req = req;\n    this.res = res;\n    this.cookieAttributes = cookieAttributes;\n  }\n  getAssignmentsSync(attributeName: string, attributeValue: string) {\n    const key = this.getKey(attributeName, attributeValue);\n    let doc: StickyAssignmentsDocument | null = null;\n    if (!this.req) return doc;\n    try {\n      const raw = this.req.cookies[key] || \"{}\";\n      const data = JSON.parse(raw);\n      if (data.attributeName && data.attributeValue && data.assignments) {\n        doc = data;\n      }\n    } catch (e) {\n      // Ignore cookie errors\n    }\n    return doc;\n  }\n  saveAssignmentsSync(doc: StickyAssignmentsDocument) {\n    const key = this.getKey(doc.attributeName, doc.attributeValue);\n    if (!this.res) return;\n    const str = JSON.stringify(doc);\n    this.res.cookie(\n      encodeURIComponent(key),\n      encodeURIComponent(str),\n      this.cookieAttributes,\n    );\n  }\n}\n\nexport class BrowserCookieStickyBucketService extends StickyBucketServiceSync {\n  /**\n   * Intended to be used with npm: 'js-cookie'.\n   * Assumes:\n   *  - reading a cookie is automatically decoded via decodeURIComponent() or similar\n   *  - writing a cookie name & value is automatically encoded via encodeURIComponent() or similar\n   *  - all cookie bodies are JSON encoded strings and are manually encoded/decoded\n   */\n  private jsCookie: JsCookiesCompat;\n  private cookieAttributes: CookieAttributes;\n  constructor({\n    prefix = \"gbStickyBuckets__\",\n    jsCookie,\n    cookieAttributes = { expires: 180 }, // 180 days\n  }: {\n    prefix?: string;\n    jsCookie: JsCookiesCompat;\n    cookieAttributes?: CookieAttributes;\n  }) {\n    super();\n    this.prefix = prefix;\n    this.jsCookie = jsCookie;\n    this.cookieAttributes = cookieAttributes;\n  }\n  getAssignmentsSync(attributeName: string, attributeValue: string) {\n    const key = this.getKey(attributeName, attributeValue);\n    let doc: StickyAssignmentsDocument | null = null;\n    if (!this.jsCookie) return doc;\n    try {\n      const raw = this.jsCookie.get(key);\n      const data = JSON.parse(raw || \"{}\");\n      if (data.attributeName && data.attributeValue && data.assignments) {\n        doc = data;\n      }\n    } catch (e) {\n      // Ignore cookie errors\n    }\n    return doc;\n  }\n  async saveAssignmentsSync(doc: StickyAssignmentsDocument) {\n    const key = this.getKey(doc.attributeName, doc.attributeValue);\n    if (!this.jsCookie) return;\n    const str = JSON.stringify(doc);\n    this.jsCookie.set(key, str, this.cookieAttributes);\n  }\n}\n\nexport class RedisStickyBucketService extends StickyBucketService {\n  /** Intended to be used with npm: 'ioredis'. **/\n  private redis: IORedisCompat | undefined;\n  constructor({ redis }: { redis: IORedisCompat }) {\n    super();\n    this.redis = redis;\n  }\n  async getAllAssignments(\n    attributes: Record<string, string>,\n  ): Promise<Record<StickyAttributeKey, StickyAssignmentsDocument>> {\n    const docs: Record<StickyAttributeKey, StickyAssignmentsDocument> = {};\n    const keys = Object.entries(attributes).map(\n      ([attributeName, attributeValue]) =>\n        getStickyBucketAttributeKey(attributeName, attributeValue),\n    );\n    if (!this.redis) return docs;\n    await this.redis.mget(...keys).then((values) => {\n      values.forEach((raw) => {\n        try {\n          const data = JSON.parse(raw || \"{}\");\n          if (\n            data.attributeName &&\n            \"attributeValue\" in data &&\n            data.assignments\n          ) {\n            const key = getStickyBucketAttributeKey(\n              data.attributeName,\n              toString(data.attributeValue),\n            );\n            docs[key] = data;\n          }\n        } catch (e) {\n          // ignore redis doc parse errors\n        }\n      });\n    });\n    return docs;\n  }\n  async getAssignments(_attributeName: string, _attributeValue: string) {\n    // not implemented\n    return null;\n  }\n  async saveAssignments(doc: StickyAssignmentsDocument) {\n    const key = this.getKey(doc.attributeName, doc.attributeValue);\n    if (!this.redis) return;\n    await this.redis.set(key, JSON.stringify(doc));\n  }\n}\n"],"names":["polyfills","fetch","globalThis","bind","undefined","SubtleCrypto","crypto","subtle","EventSource","getPolyfills","hashFnv32a","str","hval","l","length","i","charCodeAt","hash","seed","value","version","getEqualWeights","n","Array","fill","inRange","range","inNamespace","hashValue","namespace","chooseVariation","ranges","getUrlRegExp","regexString","escaped","replace","RegExp","e","console","error","isURLTargeted","url","targets","hasIncludeRules","isIncluded","match","_evalURLTarget","type","pattern","include","_evalSimpleUrlPart","actual","isPath","regex","test","_evalSimpleUrlTarget","expected","URL","comps","host","pathname","push","searchParams","forEach","v","k","get","some","data","parsed","href","substring","origin","getBucketRanges","numVariations","coverage","weights","equal","totalWeight","reduce","w","sum","cumulative","map","start","getQueryStringOverride","id","search","split","kv","filter","parseInt","base64ToBuf","b","Uint8Array","from","atob","c","decrypt","encryptedString","decryptionKey","Error","key","importKey","name","iv","cipherText","plainTextBuffer","TextDecoder","decode","toString","input","JSON","stringify","paddedVersionString","parts","padStart","join","loadSDKVersion","mergeQueryStrings","oldUrl","newUrl","currUrl","redirectUrl","has","set","isObj","x","getAutoExperimentChangeType","exp","urlPatterns","variations","variation","domMutations","promiseTimeout","promise","timeout","Promise","resolve","resolved","timer","finish","clearTimeout","setTimeout","then","catch","cacheSettings","staleTTL","maxAge","cacheKey","backgroundSync","maxEntries","disableIdleStreams","idleStreamInterval","disableCache","helpers","fetchFeaturesCall","clientKey","headers","fetchRemoteEvalCall","payload","options","method","body","eventSourceCall","startIdleListener","idleTimeout","isBrowser","window","document","onVisibilityChange","visibilityState","onVisible","onHidden","addEventListener","removeEventListener","stopIdleListener","localStorage","subscribedInstances","Map","cacheInitialized","cache","activeFetches","streams","supportsSSE","Set","setPolyfills","overrides","Object","assign","configureCache","clearAutoRefresh","clearCache","clear","updatePersistentCache","refreshFeatures","instance","skipCache","allowStale","fetchFeaturesWithCache","subscribe","getKey","subs","add","unsubscribe","s","delete","channel","state","disableChannel","enableChannel","setItem","entries","getCacheKey","now","Date","minStaleAt","getTime","initializeCache","existing","staleAt","sse","fetchFeatures","startAutoRefresh","success","source","res","apiHost","getApiInfo","baseKey","isRemoteEval","attributes","getAttributes","cacheKeyAttributes","getCacheKeyAttributes","keys","ca","fv","getForcedVariations","getUrl","getItem","parse","isArray","cleanupCache","cleanupFn","entriesWithTimestamps","sort","a","entriesToRemoveCount","Math","min","max","size","onNewFeatureData","dateUpdated","instances","refreshInstance","setPayload","getPayload","apiRequestHeaders","getApiHosts","getClientKey","remoteEval","fetcher","forcedVariations","forcedFeatures","getForcedFeatures","ok","status","json","forceSSE","streamingHost","streamingHostRequestHeaders","src","cb","event","errors","onSSEError","readyState","delay","pow","random","includes","onopen","onerror","close","destroyChannel","startStreaming","streaming","validAttributeName","nullController","revert","elements","mutations","getObserverInit","attr","childList","subtree","characterData","attributeFilter","getElementRecord","element","record","createElementPropertyRecord","el","getCurrentValue","setValue","mutationRunner","currentValue","isDirty","originalValue","virtualValue","_positionTimeout","observer","MutationObserver","parentNode","insertBeforeNode","observe","queueIfNeeded","val","currentVal","runDOMUpdates","htmlMutationRunner","m","mutate","getTransformedHTML","classMutationRunner","Boolean","attrMutationRunner","_loadDOMNodes","_ref","parentSelector","insertBeforeSelector","querySelector","positionMutationRunner","selectors","newNodes","getHTMLValue","innerHTML","setHTMLValue","getElementHTMLRecord","elementRecord","html","getElementPosition","parentElement","nextElementSibling","setElementPosition","contains","insertBefore","getElementPositionRecord","position","setClassValue","className","removeAttribute","getClassValue","getElementClassRecord","classes","getAttrValue","attrName","_el$getAttribute","getAttribute","setAttrValue","setAttribute","getElementAttributeRecord","deleteElementPropertyRecord","_element$html","_element$html$observe","disconnect","_element$classes","_element$classes$obse","_element$position","_element$position$obs","_element$attributes","_element$attributes$a","_element$attributes$a2","transformContainer","createElement","setPropertyValue","startMutating","mutation","kind","attribute","stopMutating","index","indexOf","splice","refreshElementsSet","existingElements","matchingElements","querySelectorAll","selector","revertMutation","refreshAllElementSets","connectGlobalObserver","documentElement","newMutation","classnames","mutatedClassnames","declarative","_ref2","action","_regexCache","evalCondition","obj","condition","savedGroups","evalOr","evalAnd","evalConditionValue","getPath","path","current","getRegex","insensitive","String","toLowerCase","isOperatorObject","op","evalOperatorCondition","getType","t","elemMatch","check","isIn","caseFold","isInAll","passed","j","operator","conditions","EVENT_FEATURE_EVALUATED","EVENT_EXPERIMENT_VIEWED","getForcedFeatureValues","ctx","ret","global","forcedFeatureValues","user","safeCall","fn","onExperimentViewed","experiment","result","trackedExperiments","getExperimentDedupeKey","enableDevMode","devLogs","timestamp","logType","calls","trackingCallback","eventLogger","experimentId","variationId","hashAttribute","onFeatureUsage","trackedFeatureUsage","stringifiedValue","featureKey","feature","ruleId","experimentResult","evalFeature","stack","evaluatedFeatures","getFeatureResult","forcedValues","features","rules","rule","parentConditions","parentCondition","parentResult","evalObj","evaled","gate","filters","isFilteredOut","conditionPasses","isIncludedInRollout","saveStickyBucketAssignmentDoc","disableStickyBucketing","fallbackAttribute","hashVersion","tracks","saveDeferredTrack","force","bucketVersion","minBucketVersion","meta","phase","runExperiment","onExperimentEval","inExperiment","passthrough","defaultValue","featureId","getExperimentResult","enabled","mergeOverrides","qsOverride","active","getHashAttribute","assigned","foundStickyBucket","stickyBucketVersionIsBlocked","versionIsBlocked","getStickyBucketVariation","expKey","expBucketVersion","expHashAttribute","expFallbackAttribute","expMinBucketVersion","expMeta","groups","hasGroupOverlap","urlIsValid","qaMode","changed","attrKey","doc","generateStickyBucketAssignmentDoc","getStickyBucketExperimentKey","stickyBucketAssignmentDocs","trackingCalls","trackingCall","all","changeId","recordChangeId","on","off","attributeOverrides","r","variationIndex","hashUsed","bucket","stickyBucketUsed","o","fallback","urlRegex","pathOnly","expGroups","assignments","getStickyBucketAssignments","blockedKey","variationKey","findIndex","experimentKey","experimentBucketVersion","getStickyBucketAttributeKey","attributeName","attributeValue","hashKey","fallbackValue","fallbackKey","existingAssignments","newAssignments","deriveStickyBucketIdentifierAttributes","experiments","getAllStickyBucketAssignmentDocs","stickyBucketService","getStickyBucketAttributes","getAllAssignments","stickyBucketIdentifierAttributes","decryptPayload","encryptedFeatures","encryptedExperiments","encryptedSavedGroups","defaultHost","apiHostRequestHeaders","SDK_VERSION","GrowthBook","constructor","_options","context","_renderer","renderer","_trackedExperiments","_completedChangeIds","_trackedFeatures","debug","_subscriptions","ready","_assigned","_activeAutoExperiments","_triggeredExpKeys","_initialized","_redirectedUrl","_deferredTrackingCalls","_autoExperimentsAllowed","disableExperimentsOnLoad","_destroyCallbacks","logs","log","_saveDeferredTrack","_onExperimentEval","_fireSubscriptions","_recordChangedId","isGbHost","hostname","_saveStickyBucketAssignmentDoc","saveAssignments","plugins","plugin","_growthbook","dispatchEvent","Event","_updateAllAutoExperiments","refreshStickyBuckets","_payload","_decryptedPayload","_render","initSync","generateStickyBucketAssignmentDocsSync","init","_refresh","loadFeatures","autoRefresh","subscribeToChanges","getFeatures","getExperiments","getDecryptedPayload","setFeatures","setEncryptedFeatures","featuresJSON","setExperiments","setEncryptedExperiments","experimentsJSON","setAttributes","_refreshForRemoteEval","updateAttributes","setAttributeOverrides","setForcedVariations","vars","setForcedFeatures","setURL","getStickyBucketAssignmentDocs","getCompletedChangeIds","getAllResults","onDestroy","isDestroyed","_destroyed","destroy","destroyAllStreams","undo","setRenderer","forceVariation","run","_getEvalContext","triggerExperiment","_runAutoExperiment","triggerAutoExperiments","_getUserContext","_getGlobalContext","blockedChangeIds","_getContextUrl","forceRerun","manual","isBlocked","_isAutoExperimentBlockedByContext","valueHash","_undoActiveAutoExperiment","changeType","urlRedirect","persistQueryString","navigate","_getNavigateFunction","maxNavigateDelay","navigateDelay","applyDomChangesCallback","_applyDOMChanges","prev","isOn","isOff","getFeatureValue","_evalFeature","msg","getDeferredTrackingCalls","values","setDeferredTrackingCalls","fireDeferredTrackingCalls","promises","call","setTrackingCallback","callback","setFeatureUsageCallback","setEventLogger","logger","logEvent","eventName","properties","location","disableVisualExperiments","disableJsInjection","js","disableUrlRedirectExperiments","disableCrossOriginUrlRedirectExperiments","protocol","getRedirectUrl","changes","css","head","appendChild","remove","script","jsInjectionNonce","nonce","docs","getAllAssignmentsSync","inDevMode","prefetchPayload","GrowthBookClient","_features","_experiments","getGlobalAttributes","globalAttributes","setGlobalAttributes","userContext","runInlineExperiment","applyStickyBuckets","partialContext","createScopedInstance","userPlugins","UserScopedGrowthBook","gb","_gb","_userContext","getUserContext","getVersion","StickyBucketService","opts","prefix","getAssignments","StickyBucketServiceSync","getAssignmentsSync","saveAssignmentsSync","LocalStorageStickyBucketService","raw","ExpressCookieStickyBucketService","req","cookieAttributes","cookies","cookie","encodeURIComponent","BrowserCookieStickyBucketService","jsCookie","expires","RedisStickyBucketService","redis","mget","_attributeName","_attributeValue"],"mappings":"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","x_google_ignoreList":[2]}