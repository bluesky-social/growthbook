{"version":3,"file":"feature-repository.js","names":["_util","require","cacheSettings","staleTTL","maxAge","cacheKey","backgroundSync","maxEntries","disableIdleStreams","idleStreamInterval","disableCache","polyfills","getPolyfills","helpers","exports","fetchFeaturesCall","host","clientKey","headers","fetch","fetchRemoteEvalCall","payload","options","method","body","JSON","stringify","eventSourceCall","EventSource","startIdleListener","idleTimeout","isBrowser","window","document","onVisibilityChange","visibilityState","clearTimeout","onVisible","setTimeout","onHidden","addEventListener","removeEventListener","stopIdleListener","globalThis","localStorage","e","subscribedInstances","Map","cacheInitialized","cache","activeFetches","streams","supportsSSE","Set","setPolyfills","overrides","Object","assign","configureCache","clearAutoRefresh","clearCache","clear","updatePersistentCache","refreshFeatures","instance","timeout","skipCache","allowStale","fetchFeaturesWithCache","subscribe","key","getKey","subs","get","add","set","unsubscribe","forEach","s","delete","channel","state","disableChannel","enableChannel","setItem","Array","from","entries","getCacheKey","now","Date","minStaleAt","getTime","initializeCache","existing","undefined","staleAt","sse","fetchFeatures","startAutoRefresh","data","success","source","res","promiseTimeout","error","Error","apiHost","getApiInfo","baseKey","isRemoteEval","attributes","getAttributes","cacheKeyAttributes","getCacheKeyAttributes","keys","ca","fv","getForcedVariations","url","getUrl","value","getItem","parsed","parse","isArray","cleanupCache","cleanupFn","entriesWithTimestamps","map","sort","a","b","entriesToRemoveCount","Math","min","max","size","i","onNewFeatureData","version","dateUpdated","has","instances","refreshInstance","setPayload","getPayload","apiRequestHeaders","getApiHosts","getClientKey","remoteEval","promise","fetcher","forcedVariations","forcedFeatures","getForcedFeatures","then","ok","status","json","catch","process","env","NODE_ENV","log","message","forceSSE","streamingHost","streamingHostRequestHeaders","src","cb","event","type","errors","onSSEError","readyState","delay","pow","random","includes","onopen","onerror","close","destroyChannel","startStreaming","streaming"],"sources":["../../src/feature-repository.ts"],"sourcesContent":["import {\n  Attributes,\n  CacheSettings,\n  FeatureApiResponse,\n  FetchResponse,\n  Helpers,\n  Polyfills,\n} from \"./types/growthbook\";\nimport { getPolyfills, promiseTimeout } from \"./util\";\nimport type {\n  GrowthBook,\n  InitOptions,\n  InitSyncOptions,\n  GrowthBookClient,\n} from \".\";\n\ntype CacheEntry = {\n  data: FeatureApiResponse;\n  sse?: boolean;\n  version: string;\n  staleAt: Date;\n};\ntype ScopedChannel = {\n  src: EventSource | null;\n  cb: (event: MessageEvent<string>) => void;\n  host: string;\n  clientKey: string;\n  headers?: Record<string, string>;\n  errors: number;\n  state: \"active\" | \"idle\" | \"disabled\";\n};\n\n// Config settings\nconst cacheSettings: CacheSettings = {\n  // Consider a fetch stale after 1 minute\n  staleTTL: 1000 * 60,\n  // Max time to keep a fetch in cache (4 hours default)\n  maxAge: 1000 * 60 * 60 * 4,\n  cacheKey: \"gbFeaturesCache\",\n  backgroundSync: true,\n  maxEntries: 10,\n  disableIdleStreams: false,\n  idleStreamInterval: 20000,\n  disableCache: false,\n};\n\nconst polyfills = getPolyfills();\n\nexport const helpers: Helpers = {\n  fetchFeaturesCall: ({ host, clientKey, headers }) => {\n    return (polyfills.fetch as typeof globalThis.fetch)(\n      `${host}/api/features/${clientKey}`,\n      { headers },\n    );\n  },\n  fetchRemoteEvalCall: ({ host, clientKey, payload, headers }) => {\n    const options = {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\", ...headers },\n      body: JSON.stringify(payload),\n    };\n    return (polyfills.fetch as typeof globalThis.fetch)(\n      `${host}/api/eval/${clientKey}`,\n      options,\n    );\n  },\n  eventSourceCall: ({ host, clientKey, headers }) => {\n    if (headers) {\n      return new polyfills.EventSource(`${host}/sub/${clientKey}`, {\n        headers,\n      });\n    }\n    return new polyfills.EventSource(`${host}/sub/${clientKey}`);\n  },\n  startIdleListener: () => {\n    let idleTimeout: number | undefined;\n    const isBrowser =\n      typeof window !== \"undefined\" && typeof document !== \"undefined\";\n    if (!isBrowser) return;\n    const onVisibilityChange = () => {\n      if (document.visibilityState === \"visible\") {\n        window.clearTimeout(idleTimeout);\n        onVisible();\n      } else if (document.visibilityState === \"hidden\") {\n        idleTimeout = window.setTimeout(\n          onHidden,\n          cacheSettings.idleStreamInterval,\n        );\n      }\n    };\n    document.addEventListener(\"visibilitychange\", onVisibilityChange);\n    return () =>\n      document.removeEventListener(\"visibilitychange\", onVisibilityChange);\n  },\n  stopIdleListener: () => {\n    // No-op, replaced by startIdleListener\n  },\n};\n\ntry {\n  if (globalThis.localStorage) {\n    polyfills.localStorage = globalThis.localStorage;\n  }\n} catch (e) {\n  // Ignore localStorage errors\n}\n\n// Global state\nconst subscribedInstances: Map<\n  string,\n  Set<GrowthBook | GrowthBookClient>\n> = new Map();\nlet cacheInitialized = false;\nconst cache: Map<string, CacheEntry> = new Map();\nconst activeFetches: Map<string, Promise<FetchResponse>> = new Map();\nconst streams: Map<string, ScopedChannel> = new Map();\nconst supportsSSE: Set<string> = new Set();\n\n// Public functions\nexport function setPolyfills(overrides: Partial<Polyfills>): void {\n  Object.assign(polyfills, overrides);\n}\nexport function configureCache(overrides: Partial<CacheSettings>): void {\n  Object.assign(cacheSettings, overrides);\n  if (!cacheSettings.backgroundSync) {\n    clearAutoRefresh();\n  }\n}\n\nexport async function clearCache(): Promise<void> {\n  cache.clear();\n  activeFetches.clear();\n  clearAutoRefresh();\n  cacheInitialized = false;\n  await updatePersistentCache();\n}\n\n// Get or fetch features and refresh the SDK instance\nexport async function refreshFeatures({\n  instance,\n  timeout,\n  skipCache,\n  allowStale,\n  backgroundSync,\n}: {\n  instance: GrowthBook | GrowthBookClient;\n  timeout?: number;\n  skipCache?: boolean;\n  allowStale?: boolean;\n  backgroundSync?: boolean;\n}): Promise<FetchResponse> {\n  if (!backgroundSync) {\n    cacheSettings.backgroundSync = false;\n  }\n\n  return fetchFeaturesWithCache({\n    instance,\n    allowStale,\n    timeout,\n    skipCache,\n  });\n}\n\n// Subscribe a GrowthBook instance to feature changes\nfunction subscribe(instance: GrowthBook | GrowthBookClient): void {\n  const key = getKey(instance);\n  const subs = subscribedInstances.get(key) || new Set();\n  subs.add(instance);\n  subscribedInstances.set(key, subs);\n}\nexport function unsubscribe(instance: GrowthBook | GrowthBookClient): void {\n  subscribedInstances.forEach((s) => s.delete(instance));\n}\n\nexport function onHidden() {\n  streams.forEach((channel) => {\n    if (!channel) return;\n    channel.state = \"idle\";\n    disableChannel(channel);\n  });\n}\n\nexport function onVisible() {\n  streams.forEach((channel) => {\n    if (!channel) return;\n    if (channel.state !== \"idle\") return;\n    enableChannel(channel);\n  });\n}\n\n// Private functions\n\nasync function updatePersistentCache() {\n  try {\n    if (!polyfills.localStorage) return;\n    await polyfills.localStorage.setItem(\n      cacheSettings.cacheKey,\n      JSON.stringify(Array.from(cache.entries())),\n    );\n  } catch (e) {\n    // Ignore localStorage errors\n  }\n}\n\n// SWR wrapper for fetching features. May indirectly or directly start SSE streaming.\nasync function fetchFeaturesWithCache({\n  instance,\n  allowStale,\n  timeout,\n  skipCache,\n}: {\n  instance: GrowthBook | GrowthBookClient;\n  allowStale?: boolean;\n  timeout?: number;\n  skipCache?: boolean;\n}): Promise<FetchResponse> {\n  const key = getKey(instance);\n  const cacheKey = getCacheKey(instance);\n  const now = new Date();\n\n  const minStaleAt = new Date(\n    now.getTime() - cacheSettings.maxAge + cacheSettings.staleTTL,\n  );\n\n  await initializeCache();\n  const existing =\n    !cacheSettings.disableCache && !skipCache ? cache.get(cacheKey) : undefined;\n  if (\n    existing &&\n    (allowStale || existing.staleAt > now) &&\n    existing.staleAt > minStaleAt\n  ) {\n    // Restore from cache whether SSE is supported\n    if (existing.sse) supportsSSE.add(key);\n\n    // Reload features in the background if stale\n    if (existing.staleAt < now) {\n      fetchFeatures(instance);\n    }\n    // Otherwise, if we don't need to refresh now, start a background sync\n    else {\n      startAutoRefresh(instance);\n    }\n    return { data: existing.data, success: true, source: \"cache\" };\n  } else {\n    const res = await promiseTimeout(fetchFeatures(instance), timeout);\n    return (\n      res || {\n        data: null,\n        success: false,\n        source: \"timeout\",\n        error: new Error(\"Timeout\"),\n      }\n    );\n  }\n}\n\nfunction getKey(instance: GrowthBook | GrowthBookClient): string {\n  const [apiHost, clientKey] = instance.getApiInfo();\n  return `${apiHost}||${clientKey}`;\n}\n\nfunction getCacheKey(instance: GrowthBook | GrowthBookClient): string {\n  const baseKey = getKey(instance);\n  if (!(\"isRemoteEval\" in instance) || !instance.isRemoteEval()) return baseKey;\n\n  const attributes = instance.getAttributes();\n  const cacheKeyAttributes =\n    instance.getCacheKeyAttributes() || Object.keys(instance.getAttributes());\n  const ca: Attributes = {};\n  cacheKeyAttributes.forEach((key) => {\n    ca[key] = attributes[key];\n  });\n\n  const fv = instance.getForcedVariations();\n  const url = instance.getUrl();\n\n  return `${baseKey}||${JSON.stringify({\n    ca,\n    fv,\n    url,\n  })}`;\n}\n\n// Populate cache from localStorage (if available)\nasync function initializeCache(): Promise<void> {\n  if (cacheInitialized) return;\n  cacheInitialized = true;\n  try {\n    if (polyfills.localStorage) {\n      const value = await polyfills.localStorage.getItem(\n        cacheSettings.cacheKey,\n      );\n      if (!cacheSettings.disableCache && value) {\n        const parsed: [string, CacheEntry][] = JSON.parse(value);\n        if (parsed && Array.isArray(parsed)) {\n          parsed.forEach(([key, data]) => {\n            cache.set(key, {\n              ...data,\n              staleAt: new Date(data.staleAt),\n            });\n          });\n        }\n        cleanupCache();\n      }\n    }\n  } catch (e) {\n    // Ignore localStorage errors\n  }\n  if (!cacheSettings.disableIdleStreams) {\n    const cleanupFn = helpers.startIdleListener();\n    if (cleanupFn) {\n      helpers.stopIdleListener = cleanupFn;\n    }\n  }\n}\n\n// Enforce the maxEntries limit\nfunction cleanupCache() {\n  const entriesWithTimestamps = Array.from(cache.entries())\n    .map(([key, value]) => ({\n      key,\n      staleAt: value.staleAt.getTime(),\n    }))\n    .sort((a, b) => a.staleAt - b.staleAt);\n\n  const entriesToRemoveCount = Math.min(\n    Math.max(0, cache.size - cacheSettings.maxEntries),\n    cache.size,\n  );\n\n  for (let i = 0; i < entriesToRemoveCount; i++) {\n    cache.delete(entriesWithTimestamps[i].key);\n  }\n}\n\n// Called whenever new features are fetched from the API\nfunction onNewFeatureData(\n  key: string,\n  cacheKey: string,\n  data: FeatureApiResponse,\n): void {\n  // If contents haven't changed, ignore the update, extend the stale TTL\n  const version = data.dateUpdated || \"\";\n  const staleAt = new Date(Date.now() + cacheSettings.staleTTL);\n  const existing = !cacheSettings.disableCache\n    ? cache.get(cacheKey)\n    : undefined;\n  if (existing && version && existing.version === version) {\n    existing.staleAt = staleAt;\n    updatePersistentCache();\n    return;\n  }\n\n  if (!cacheSettings.disableCache) {\n    // Update in-memory cache\n    cache.set(cacheKey, {\n      data,\n      version,\n      staleAt,\n      sse: supportsSSE.has(key),\n    });\n    cleanupCache();\n  }\n  // Update local storage (don't await this, just update asynchronously)\n  updatePersistentCache();\n\n  // Update features for all subscribed GrowthBook instances\n  const instances = subscribedInstances.get(key);\n  instances && instances.forEach((instance) => refreshInstance(instance, data));\n}\n\nasync function refreshInstance(\n  instance: GrowthBook | GrowthBookClient,\n  data: FeatureApiResponse | null,\n): Promise<void> {\n  await instance.setPayload(data || instance.getPayload());\n}\n\n// Fetch the features payload from helper function or from in-mem injected payload\nasync function fetchFeatures(\n  instance: GrowthBook | GrowthBookClient,\n): Promise<FetchResponse> {\n  const { apiHost, apiRequestHeaders } = instance.getApiHosts();\n  const clientKey = instance.getClientKey();\n  const remoteEval = \"isRemoteEval\" in instance && instance.isRemoteEval();\n  const key = getKey(instance);\n  const cacheKey = getCacheKey(instance);\n\n  let promise = activeFetches.get(cacheKey);\n  if (!promise) {\n    const fetcher: Promise<Response> = remoteEval\n      ? helpers.fetchRemoteEvalCall({\n          host: apiHost,\n          clientKey,\n          payload: {\n            attributes: instance.getAttributes(),\n            forcedVariations: instance.getForcedVariations(),\n            forcedFeatures: Array.from(instance.getForcedFeatures().entries()),\n            url: instance.getUrl(),\n          },\n          headers: apiRequestHeaders,\n        })\n      : helpers.fetchFeaturesCall({\n          host: apiHost,\n          clientKey,\n          headers: apiRequestHeaders,\n        });\n\n    // TODO: auto-retry if status code indicates a temporary error\n    promise = fetcher\n      .then((res) => {\n        if (!res.ok) {\n          throw new Error(`HTTP error: ${res.status}`);\n        }\n        if (res.headers.get(\"x-sse-support\") === \"enabled\") {\n          supportsSSE.add(key);\n        }\n        return res.json();\n      })\n      .then((data: FeatureApiResponse) => {\n        onNewFeatureData(key, cacheKey, data);\n        startAutoRefresh(instance);\n        activeFetches.delete(cacheKey);\n        return { data, success: true, source: \"network\" as const };\n      })\n      .catch((e) => {\n        process.env.NODE_ENV !== \"production\" &&\n          instance.log(\"Error fetching features\", {\n            apiHost,\n            clientKey,\n            error: e ? e.message : null,\n          });\n        activeFetches.delete(cacheKey);\n\n        return {\n          data: null,\n          source: \"error\" as const,\n          success: false,\n          error: e,\n        };\n      });\n    activeFetches.set(cacheKey, promise);\n  }\n  return promise;\n}\n\n// Start SSE streaming, listens to feature payload changes and triggers a refresh or re-fetch\nfunction startAutoRefresh(\n  instance: GrowthBook | GrowthBookClient,\n  forceSSE: boolean = false,\n): void {\n  const key = getKey(instance);\n  const cacheKey = getCacheKey(instance);\n  const { streamingHost, streamingHostRequestHeaders } = instance.getApiHosts();\n  const clientKey = instance.getClientKey();\n\n  if (forceSSE) {\n    supportsSSE.add(key);\n  }\n\n  if (\n    cacheSettings.backgroundSync &&\n    supportsSSE.has(key) &&\n    polyfills.EventSource\n  ) {\n    if (streams.has(key)) return;\n    const channel: ScopedChannel = {\n      src: null,\n      host: streamingHost,\n      clientKey,\n      headers: streamingHostRequestHeaders,\n      cb: (event: MessageEvent<string>) => {\n        try {\n          if (event.type === \"features-updated\") {\n            const instances = subscribedInstances.get(key);\n            instances &&\n              instances.forEach((instance) => {\n                fetchFeatures(instance);\n              });\n          } else if (event.type === \"features\") {\n            const json: FeatureApiResponse = JSON.parse(event.data);\n            onNewFeatureData(key, cacheKey, json);\n          }\n          // Reset error count on success\n          channel.errors = 0;\n        } catch (e) {\n          process.env.NODE_ENV !== \"production\" &&\n            instance.log(\"SSE Error\", {\n              streamingHost,\n              clientKey,\n              error: e ? (e as Error).message : null,\n            });\n          onSSEError(channel);\n        }\n      },\n      errors: 0,\n      state: \"active\",\n    };\n    streams.set(key, channel);\n    enableChannel(channel);\n  }\n}\n\nfunction onSSEError(channel: ScopedChannel) {\n  if (channel.state === \"idle\") return;\n  channel.errors++;\n  if (channel.errors > 3 || (channel.src && channel.src.readyState === 2)) {\n    // exponential backoff after 4 errors, with jitter\n    const delay =\n      Math.pow(3, channel.errors - 3) * (1000 + Math.random() * 1000);\n    disableChannel(channel);\n    setTimeout(\n      () => {\n        if ([\"idle\", \"active\"].includes(channel.state)) return;\n        enableChannel(channel);\n      },\n      Math.min(delay, 300000),\n    ); // 5 minutes max\n  }\n}\n\nfunction disableChannel(channel: ScopedChannel) {\n  if (!channel.src) return;\n  channel.src.onopen = null;\n  channel.src.onerror = null;\n  channel.src.close();\n  channel.src = null;\n  if (channel.state === \"active\") {\n    channel.state = \"disabled\";\n  }\n}\n\nfunction enableChannel(channel: ScopedChannel) {\n  channel.src = helpers.eventSourceCall({\n    host: channel.host,\n    clientKey: channel.clientKey,\n    headers: channel.headers,\n  }) as EventSource;\n  channel.state = \"active\";\n  channel.src.addEventListener(\"features\", channel.cb);\n  channel.src.addEventListener(\"features-updated\", channel.cb);\n  channel.src.onerror = () => onSSEError(channel);\n  channel.src.onopen = () => {\n    channel.errors = 0;\n  };\n}\n\nfunction destroyChannel(channel: ScopedChannel, key: string) {\n  disableChannel(channel);\n  streams.delete(key);\n}\n\nexport function clearAutoRefresh() {\n  // Clear list of which keys are auto-updated\n  supportsSSE.clear();\n\n  // Stop listening for any SSE events\n  streams.forEach(destroyChannel);\n\n  // Remove all references to GrowthBook instances\n  subscribedInstances.clear();\n\n  // Run the idle stream cleanup function\n  helpers.stopIdleListener();\n}\n\nexport function startStreaming(\n  instance: GrowthBook | GrowthBookClient,\n  options: InitOptions | InitSyncOptions,\n) {\n  if (options.streaming) {\n    if (!instance.getClientKey()) {\n      throw new Error(\"Must specify clientKey to enable streaming\");\n    }\n    if (options.payload) {\n      startAutoRefresh(instance, true);\n    }\n    subscribe(instance);\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;AAQA,IAAAA,KAAA,GAAAC,OAAA;AAwBA;AACA,MAAMC,aAA4B,GAAG;EACnC;EACAC,QAAQ,EAAE,IAAI,GAAG,EAAE;EACnB;EACAC,MAAM,EAAE,IAAI,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC;EAC1BC,QAAQ,EAAE,iBAAiB;EAC3BC,cAAc,EAAE,IAAI;EACpBC,UAAU,EAAE,EAAE;EACdC,kBAAkB,EAAE,KAAK;EACzBC,kBAAkB,EAAE,KAAK;EACzBC,YAAY,EAAE;AAChB,CAAC;AAED,MAAMC,SAAS,GAAG,IAAAC,kBAAY,EAAC,CAAC;AAEzB,MAAMC,OAAgB,GAAAC,OAAA,CAAAD,OAAA,GAAG;EAC9BE,iBAAiB,EAAEA,CAAC;IAAEC,IAAI;IAAEC,SAAS;IAAEC;EAAQ,CAAC,KAAK;IACnD,OAAQP,SAAS,CAACQ,KAAK,CACrB,GAAGH,IAAI,iBAAiBC,SAAS,EAAE,EACnC;MAAEC;IAAQ,CACZ,CAAC;EACH,CAAC;EACDE,mBAAmB,EAAEA,CAAC;IAAEJ,IAAI;IAAEC,SAAS;IAAEI,OAAO;IAAEH;EAAQ,CAAC,KAAK;IAC9D,MAAMI,OAAO,GAAG;MACdC,MAAM,EAAE,MAAM;MACdL,OAAO,EAAE;QAAE,cAAc,EAAE,kBAAkB;QAAE,GAAGA;MAAQ,CAAC;MAC3DM,IAAI,EAAEC,IAAI,CAACC,SAAS,CAACL,OAAO;IAC9B,CAAC;IACD,OAAQV,SAAS,CAACQ,KAAK,CACrB,GAAGH,IAAI,aAAaC,SAAS,EAAE,EAC/BK,OACF,CAAC;EACH,CAAC;EACDK,eAAe,EAAEA,CAAC;IAAEX,IAAI;IAAEC,SAAS;IAAEC;EAAQ,CAAC,KAAK;IACjD,IAAIA,OAAO,EAAE;MACX,OAAO,IAAIP,SAAS,CAACiB,WAAW,CAAC,GAAGZ,IAAI,QAAQC,SAAS,EAAE,EAAE;QAC3DC;MACF,CAAC,CAAC;IACJ;IACA,OAAO,IAAIP,SAAS,CAACiB,WAAW,CAAC,GAAGZ,IAAI,QAAQC,SAAS,EAAE,CAAC;EAC9D,CAAC;EACDY,iBAAiB,EAAEA,CAAA,KAAM;IACvB,IAAIC,WAA+B;IACnC,MAAMC,SAAS,GACb,OAAOC,MAAM,KAAK,WAAW,IAAI,OAAOC,QAAQ,KAAK,WAAW;IAClE,IAAI,CAACF,SAAS,EAAE;IAChB,MAAMG,kBAAkB,GAAGA,CAAA,KAAM;MAC/B,IAAID,QAAQ,CAACE,eAAe,KAAK,SAAS,EAAE;QAC1CH,MAAM,CAACI,YAAY,CAACN,WAAW,CAAC;QAChCO,SAAS,CAAC,CAAC;MACb,CAAC,MAAM,IAAIJ,QAAQ,CAACE,eAAe,KAAK,QAAQ,EAAE;QAChDL,WAAW,GAAGE,MAAM,CAACM,UAAU,CAC7BC,QAAQ,EACRrC,aAAa,CAACO,kBAChB,CAAC;MACH;IACF,CAAC;IACDwB,QAAQ,CAACO,gBAAgB,CAAC,kBAAkB,EAAEN,kBAAkB,CAAC;IACjE,OAAO,MACLD,QAAQ,CAACQ,mBAAmB,CAAC,kBAAkB,EAAEP,kBAAkB,CAAC;EACxE,CAAC;EACDQ,gBAAgB,EAAEA,CAAA,KAAM;IACtB;EAAA;AAEJ,CAAC;AAED,IAAI;EACF,IAAIC,UAAU,CAACC,YAAY,EAAE;IAC3BjC,SAAS,CAACiC,YAAY,GAAGD,UAAU,CAACC,YAAY;EAClD;AACF,CAAC,CAAC,OAAOC,CAAC,EAAE;EACV;AAAA;;AAGF;AACA,MAAMC,mBAGL,GAAG,IAAIC,GAAG,CAAC,CAAC;AACb,IAAIC,gBAAgB,GAAG,KAAK;AAC5B,MAAMC,KAA8B,GAAG,IAAIF,GAAG,CAAC,CAAC;AAChD,MAAMG,aAAkD,GAAG,IAAIH,GAAG,CAAC,CAAC;AACpE,MAAMI,OAAmC,GAAG,IAAIJ,GAAG,CAAC,CAAC;AACrD,MAAMK,WAAwB,GAAG,IAAIC,GAAG,CAAC,CAAC;;AAE1C;AACO,SAASC,YAAYA,CAACC,SAA6B,EAAQ;EAChEC,MAAM,CAACC,MAAM,CAAC9C,SAAS,EAAE4C,SAAS,CAAC;AACrC;AACO,SAASG,cAAcA,CAACH,SAAiC,EAAQ;EACtEC,MAAM,CAACC,MAAM,CAACvD,aAAa,EAAEqD,SAAS,CAAC;EACvC,IAAI,CAACrD,aAAa,CAACI,cAAc,EAAE;IACjCqD,gBAAgB,CAAC,CAAC;EACpB;AACF;AAEO,eAAeC,UAAUA,CAAA,EAAkB;EAChDX,KAAK,CAACY,KAAK,CAAC,CAAC;EACbX,aAAa,CAACW,KAAK,CAAC,CAAC;EACrBF,gBAAgB,CAAC,CAAC;EAClBX,gBAAgB,GAAG,KAAK;EACxB,MAAMc,qBAAqB,CAAC,CAAC;AAC/B;;AAEA;AACO,eAAeC,eAAeA,CAAC;EACpCC,QAAQ;EACRC,OAAO;EACPC,SAAS;EACTC,UAAU;EACV7D;AAOF,CAAC,EAA0B;EACzB,IAAI,CAACA,cAAc,EAAE;IACnBJ,aAAa,CAACI,cAAc,GAAG,KAAK;EACtC;EAEA,OAAO8D,sBAAsB,CAAC;IAC5BJ,QAAQ;IACRG,UAAU;IACVF,OAAO;IACPC;EACF,CAAC,CAAC;AACJ;;AAEA;AACA,SAASG,SAASA,CAACL,QAAuC,EAAQ;EAChE,MAAMM,GAAG,GAAGC,MAAM,CAACP,QAAQ,CAAC;EAC5B,MAAMQ,IAAI,GAAG1B,mBAAmB,CAAC2B,GAAG,CAACH,GAAG,CAAC,IAAI,IAAIjB,GAAG,CAAC,CAAC;EACtDmB,IAAI,CAACE,GAAG,CAACV,QAAQ,CAAC;EAClBlB,mBAAmB,CAAC6B,GAAG,CAACL,GAAG,EAAEE,IAAI,CAAC;AACpC;AACO,SAASI,WAAWA,CAACZ,QAAuC,EAAQ;EACzElB,mBAAmB,CAAC+B,OAAO,CAAEC,CAAC,IAAKA,CAAC,CAACC,MAAM,CAACf,QAAQ,CAAC,CAAC;AACxD;AAEO,SAASzB,QAAQA,CAAA,EAAG;EACzBY,OAAO,CAAC0B,OAAO,CAAEG,OAAO,IAAK;IAC3B,IAAI,CAACA,OAAO,EAAE;IACdA,OAAO,CAACC,KAAK,GAAG,MAAM;IACtBC,cAAc,CAACF,OAAO,CAAC;EACzB,CAAC,CAAC;AACJ;AAEO,SAAS3C,SAASA,CAAA,EAAG;EAC1Bc,OAAO,CAAC0B,OAAO,CAAEG,OAAO,IAAK;IAC3B,IAAI,CAACA,OAAO,EAAE;IACd,IAAIA,OAAO,CAACC,KAAK,KAAK,MAAM,EAAE;IAC9BE,aAAa,CAACH,OAAO,CAAC;EACxB,CAAC,CAAC;AACJ;;AAEA;;AAEA,eAAelB,qBAAqBA,CAAA,EAAG;EACrC,IAAI;IACF,IAAI,CAACnD,SAAS,CAACiC,YAAY,EAAE;IAC7B,MAAMjC,SAAS,CAACiC,YAAY,CAACwC,OAAO,CAClClF,aAAa,CAACG,QAAQ,EACtBoB,IAAI,CAACC,SAAS,CAAC2D,KAAK,CAACC,IAAI,CAACrC,KAAK,CAACsC,OAAO,CAAC,CAAC,CAAC,CAC5C,CAAC;EACH,CAAC,CAAC,OAAO1C,CAAC,EAAE;IACV;EAAA;AAEJ;;AAEA;AACA,eAAeuB,sBAAsBA,CAAC;EACpCJ,QAAQ;EACRG,UAAU;EACVF,OAAO;EACPC;AAMF,CAAC,EAA0B;EACzB,MAAMI,GAAG,GAAGC,MAAM,CAACP,QAAQ,CAAC;EAC5B,MAAM3D,QAAQ,GAAGmF,WAAW,CAACxB,QAAQ,CAAC;EACtC,MAAMyB,GAAG,GAAG,IAAIC,IAAI,CAAC,CAAC;EAEtB,MAAMC,UAAU,GAAG,IAAID,IAAI,CACzBD,GAAG,CAACG,OAAO,CAAC,CAAC,GAAG1F,aAAa,CAACE,MAAM,GAAGF,aAAa,CAACC,QACvD,CAAC;EAED,MAAM0F,eAAe,CAAC,CAAC;EACvB,MAAMC,QAAQ,GACZ,CAAC5F,aAAa,CAACQ,YAAY,IAAI,CAACwD,SAAS,GAAGjB,KAAK,CAACwB,GAAG,CAACpE,QAAQ,CAAC,GAAG0F,SAAS;EAC7E,IACED,QAAQ,KACP3B,UAAU,IAAI2B,QAAQ,CAACE,OAAO,GAAGP,GAAG,CAAC,IACtCK,QAAQ,CAACE,OAAO,GAAGL,UAAU,EAC7B;IACA;IACA,IAAIG,QAAQ,CAACG,GAAG,EAAE7C,WAAW,CAACsB,GAAG,CAACJ,GAAG,CAAC;;IAEtC;IACA,IAAIwB,QAAQ,CAACE,OAAO,GAAGP,GAAG,EAAE;MAC1BS,aAAa,CAAClC,QAAQ,CAAC;IACzB;IACA;IAAA,KACK;MACHmC,gBAAgB,CAACnC,QAAQ,CAAC;IAC5B;IACA,OAAO;MAAEoC,IAAI,EAAEN,QAAQ,CAACM,IAAI;MAAEC,OAAO,EAAE,IAAI;MAAEC,MAAM,EAAE;IAAQ,CAAC;EAChE,CAAC,MAAM;IACL,MAAMC,GAAG,GAAG,MAAM,IAAAC,oBAAc,EAACN,aAAa,CAAClC,QAAQ,CAAC,EAAEC,OAAO,CAAC;IAClE,OACEsC,GAAG,IAAI;MACLH,IAAI,EAAE,IAAI;MACVC,OAAO,EAAE,KAAK;MACdC,MAAM,EAAE,SAAS;MACjBG,KAAK,EAAE,IAAIC,KAAK,CAAC,SAAS;IAC5B,CAAC;EAEL;AACF;AAEA,SAASnC,MAAMA,CAACP,QAAuC,EAAU;EAC/D,MAAM,CAAC2C,OAAO,EAAE1F,SAAS,CAAC,GAAG+C,QAAQ,CAAC4C,UAAU,CAAC,CAAC;EAClD,OAAO,GAAGD,OAAO,KAAK1F,SAAS,EAAE;AACnC;AAEA,SAASuE,WAAWA,CAACxB,QAAuC,EAAU;EACpE,MAAM6C,OAAO,GAAGtC,MAAM,CAACP,QAAQ,CAAC;EAChC,IAAI,EAAE,cAAc,IAAIA,QAAQ,CAAC,IAAI,CAACA,QAAQ,CAAC8C,YAAY,CAAC,CAAC,EAAE,OAAOD,OAAO;EAE7E,MAAME,UAAU,GAAG/C,QAAQ,CAACgD,aAAa,CAAC,CAAC;EAC3C,MAAMC,kBAAkB,GACtBjD,QAAQ,CAACkD,qBAAqB,CAAC,CAAC,IAAI1D,MAAM,CAAC2D,IAAI,CAACnD,QAAQ,CAACgD,aAAa,CAAC,CAAC,CAAC;EAC3E,MAAMI,EAAc,GAAG,CAAC,CAAC;EACzBH,kBAAkB,CAACpC,OAAO,CAAEP,GAAG,IAAK;IAClC8C,EAAE,CAAC9C,GAAG,CAAC,GAAGyC,UAAU,CAACzC,GAAG,CAAC;EAC3B,CAAC,CAAC;EAEF,MAAM+C,EAAE,GAAGrD,QAAQ,CAACsD,mBAAmB,CAAC,CAAC;EACzC,MAAMC,GAAG,GAAGvD,QAAQ,CAACwD,MAAM,CAAC,CAAC;EAE7B,OAAO,GAAGX,OAAO,KAAKpF,IAAI,CAACC,SAAS,CAAC;IACnC0F,EAAE;IACFC,EAAE;IACFE;EACF,CAAC,CAAC,EAAE;AACN;;AAEA;AACA,eAAe1B,eAAeA,CAAA,EAAkB;EAC9C,IAAI7C,gBAAgB,EAAE;EACtBA,gBAAgB,GAAG,IAAI;EACvB,IAAI;IACF,IAAIrC,SAAS,CAACiC,YAAY,EAAE;MAC1B,MAAM6E,KAAK,GAAG,MAAM9G,SAAS,CAACiC,YAAY,CAAC8E,OAAO,CAChDxH,aAAa,CAACG,QAChB,CAAC;MACD,IAAI,CAACH,aAAa,CAACQ,YAAY,IAAI+G,KAAK,EAAE;QACxC,MAAME,MAA8B,GAAGlG,IAAI,CAACmG,KAAK,CAACH,KAAK,CAAC;QACxD,IAAIE,MAAM,IAAItC,KAAK,CAACwC,OAAO,CAACF,MAAM,CAAC,EAAE;UACnCA,MAAM,CAAC9C,OAAO,CAAC,CAAC,CAACP,GAAG,EAAE8B,IAAI,CAAC,KAAK;YAC9BnD,KAAK,CAAC0B,GAAG,CAACL,GAAG,EAAE;cACb,GAAG8B,IAAI;cACPJ,OAAO,EAAE,IAAIN,IAAI,CAACU,IAAI,CAACJ,OAAO;YAChC,CAAC,CAAC;UACJ,CAAC,CAAC;QACJ;QACA8B,YAAY,CAAC,CAAC;MAChB;IACF;EACF,CAAC,CAAC,OAAOjF,CAAC,EAAE;IACV;EAAA;EAEF,IAAI,CAAC3C,aAAa,CAACM,kBAAkB,EAAE;IACrC,MAAMuH,SAAS,GAAGlH,OAAO,CAACgB,iBAAiB,CAAC,CAAC;IAC7C,IAAIkG,SAAS,EAAE;MACblH,OAAO,CAAC6B,gBAAgB,GAAGqF,SAAS;IACtC;EACF;AACF;;AAEA;AACA,SAASD,YAAYA,CAAA,EAAG;EACtB,MAAME,qBAAqB,GAAG3C,KAAK,CAACC,IAAI,CAACrC,KAAK,CAACsC,OAAO,CAAC,CAAC,CAAC,CACtD0C,GAAG,CAAC,CAAC,CAAC3D,GAAG,EAAEmD,KAAK,CAAC,MAAM;IACtBnD,GAAG;IACH0B,OAAO,EAAEyB,KAAK,CAACzB,OAAO,CAACJ,OAAO,CAAC;EACjC,CAAC,CAAC,CAAC,CACFsC,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,CAACnC,OAAO,GAAGoC,CAAC,CAACpC,OAAO,CAAC;EAExC,MAAMqC,oBAAoB,GAAGC,IAAI,CAACC,GAAG,CACnCD,IAAI,CAACE,GAAG,CAAC,CAAC,EAAEvF,KAAK,CAACwF,IAAI,GAAGvI,aAAa,CAACK,UAAU,CAAC,EAClD0C,KAAK,CAACwF,IACR,CAAC;EAED,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGL,oBAAoB,EAAEK,CAAC,EAAE,EAAE;IAC7CzF,KAAK,CAAC8B,MAAM,CAACiD,qBAAqB,CAACU,CAAC,CAAC,CAACpE,GAAG,CAAC;EAC5C;AACF;;AAEA;AACA,SAASqE,gBAAgBA,CACvBrE,GAAW,EACXjE,QAAgB,EAChB+F,IAAwB,EAClB;EACN;EACA,MAAMwC,OAAO,GAAGxC,IAAI,CAACyC,WAAW,IAAI,EAAE;EACtC,MAAM7C,OAAO,GAAG,IAAIN,IAAI,CAACA,IAAI,CAACD,GAAG,CAAC,CAAC,GAAGvF,aAAa,CAACC,QAAQ,CAAC;EAC7D,MAAM2F,QAAQ,GAAG,CAAC5F,aAAa,CAACQ,YAAY,GACxCuC,KAAK,CAACwB,GAAG,CAACpE,QAAQ,CAAC,GACnB0F,SAAS;EACb,IAAID,QAAQ,IAAI8C,OAAO,IAAI9C,QAAQ,CAAC8C,OAAO,KAAKA,OAAO,EAAE;IACvD9C,QAAQ,CAACE,OAAO,GAAGA,OAAO;IAC1BlC,qBAAqB,CAAC,CAAC;IACvB;EACF;EAEA,IAAI,CAAC5D,aAAa,CAACQ,YAAY,EAAE;IAC/B;IACAuC,KAAK,CAAC0B,GAAG,CAACtE,QAAQ,EAAE;MAClB+F,IAAI;MACJwC,OAAO;MACP5C,OAAO;MACPC,GAAG,EAAE7C,WAAW,CAAC0F,GAAG,CAACxE,GAAG;IAC1B,CAAC,CAAC;IACFwD,YAAY,CAAC,CAAC;EAChB;EACA;EACAhE,qBAAqB,CAAC,CAAC;;EAEvB;EACA,MAAMiF,SAAS,GAAGjG,mBAAmB,CAAC2B,GAAG,CAACH,GAAG,CAAC;EAC9CyE,SAAS,IAAIA,SAAS,CAAClE,OAAO,CAAEb,QAAQ,IAAKgF,eAAe,CAAChF,QAAQ,EAAEoC,IAAI,CAAC,CAAC;AAC/E;AAEA,eAAe4C,eAAeA,CAC5BhF,QAAuC,EACvCoC,IAA+B,EAChB;EACf,MAAMpC,QAAQ,CAACiF,UAAU,CAAC7C,IAAI,IAAIpC,QAAQ,CAACkF,UAAU,CAAC,CAAC,CAAC;AAC1D;;AAEA;AACA,eAAehD,aAAaA,CAC1BlC,QAAuC,EACf;EACxB,MAAM;IAAE2C,OAAO;IAAEwC;EAAkB,CAAC,GAAGnF,QAAQ,CAACoF,WAAW,CAAC,CAAC;EAC7D,MAAMnI,SAAS,GAAG+C,QAAQ,CAACqF,YAAY,CAAC,CAAC;EACzC,MAAMC,UAAU,GAAG,cAAc,IAAItF,QAAQ,IAAIA,QAAQ,CAAC8C,YAAY,CAAC,CAAC;EACxE,MAAMxC,GAAG,GAAGC,MAAM,CAACP,QAAQ,CAAC;EAC5B,MAAM3D,QAAQ,GAAGmF,WAAW,CAACxB,QAAQ,CAAC;EAEtC,IAAIuF,OAAO,GAAGrG,aAAa,CAACuB,GAAG,CAACpE,QAAQ,CAAC;EACzC,IAAI,CAACkJ,OAAO,EAAE;IACZ,MAAMC,OAA0B,GAAGF,UAAU,GACzCzI,OAAO,CAACO,mBAAmB,CAAC;MAC1BJ,IAAI,EAAE2F,OAAO;MACb1F,SAAS;MACTI,OAAO,EAAE;QACP0F,UAAU,EAAE/C,QAAQ,CAACgD,aAAa,CAAC,CAAC;QACpCyC,gBAAgB,EAAEzF,QAAQ,CAACsD,mBAAmB,CAAC,CAAC;QAChDoC,cAAc,EAAErE,KAAK,CAACC,IAAI,CAACtB,QAAQ,CAAC2F,iBAAiB,CAAC,CAAC,CAACpE,OAAO,CAAC,CAAC,CAAC;QAClEgC,GAAG,EAAEvD,QAAQ,CAACwD,MAAM,CAAC;MACvB,CAAC;MACDtG,OAAO,EAAEiI;IACX,CAAC,CAAC,GACFtI,OAAO,CAACE,iBAAiB,CAAC;MACxBC,IAAI,EAAE2F,OAAO;MACb1F,SAAS;MACTC,OAAO,EAAEiI;IACX,CAAC,CAAC;;IAEN;IACAI,OAAO,GAAGC,OAAO,CACdI,IAAI,CAAErD,GAAG,IAAK;MACb,IAAI,CAACA,GAAG,CAACsD,EAAE,EAAE;QACX,MAAM,IAAInD,KAAK,CAAC,eAAeH,GAAG,CAACuD,MAAM,EAAE,CAAC;MAC9C;MACA,IAAIvD,GAAG,CAACrF,OAAO,CAACuD,GAAG,CAAC,eAAe,CAAC,KAAK,SAAS,EAAE;QAClDrB,WAAW,CAACsB,GAAG,CAACJ,GAAG,CAAC;MACtB;MACA,OAAOiC,GAAG,CAACwD,IAAI,CAAC,CAAC;IACnB,CAAC,CAAC,CACDH,IAAI,CAAExD,IAAwB,IAAK;MAClCuC,gBAAgB,CAACrE,GAAG,EAAEjE,QAAQ,EAAE+F,IAAI,CAAC;MACrCD,gBAAgB,CAACnC,QAAQ,CAAC;MAC1Bd,aAAa,CAAC6B,MAAM,CAAC1E,QAAQ,CAAC;MAC9B,OAAO;QAAE+F,IAAI;QAAEC,OAAO,EAAE,IAAI;QAAEC,MAAM,EAAE;MAAmB,CAAC;IAC5D,CAAC,CAAC,CACD0D,KAAK,CAAEnH,CAAC,IAAK;MACZoH,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,YAAY,IACnCnG,QAAQ,CAACoG,GAAG,CAAC,yBAAyB,EAAE;QACtCzD,OAAO;QACP1F,SAAS;QACTwF,KAAK,EAAE5D,CAAC,GAAGA,CAAC,CAACwH,OAAO,GAAG;MACzB,CAAC,CAAC;MACJnH,aAAa,CAAC6B,MAAM,CAAC1E,QAAQ,CAAC;MAE9B,OAAO;QACL+F,IAAI,EAAE,IAAI;QACVE,MAAM,EAAE,OAAgB;QACxBD,OAAO,EAAE,KAAK;QACdI,KAAK,EAAE5D;MACT,CAAC;IACH,CAAC,CAAC;IACJK,aAAa,CAACyB,GAAG,CAACtE,QAAQ,EAAEkJ,OAAO,CAAC;EACtC;EACA,OAAOA,OAAO;AAChB;;AAEA;AACA,SAASpD,gBAAgBA,CACvBnC,QAAuC,EACvCsG,QAAiB,GAAG,KAAK,EACnB;EACN,MAAMhG,GAAG,GAAGC,MAAM,CAACP,QAAQ,CAAC;EAC5B,MAAM3D,QAAQ,GAAGmF,WAAW,CAACxB,QAAQ,CAAC;EACtC,MAAM;IAAEuG,aAAa;IAAEC;EAA4B,CAAC,GAAGxG,QAAQ,CAACoF,WAAW,CAAC,CAAC;EAC7E,MAAMnI,SAAS,GAAG+C,QAAQ,CAACqF,YAAY,CAAC,CAAC;EAEzC,IAAIiB,QAAQ,EAAE;IACZlH,WAAW,CAACsB,GAAG,CAACJ,GAAG,CAAC;EACtB;EAEA,IACEpE,aAAa,CAACI,cAAc,IAC5B8C,WAAW,CAAC0F,GAAG,CAACxE,GAAG,CAAC,IACpB3D,SAAS,CAACiB,WAAW,EACrB;IACA,IAAIuB,OAAO,CAAC2F,GAAG,CAACxE,GAAG,CAAC,EAAE;IACtB,MAAMU,OAAsB,GAAG;MAC7ByF,GAAG,EAAE,IAAI;MACTzJ,IAAI,EAAEuJ,aAAa;MACnBtJ,SAAS;MACTC,OAAO,EAAEsJ,2BAA2B;MACpCE,EAAE,EAAGC,KAA2B,IAAK;QACnC,IAAI;UACF,IAAIA,KAAK,CAACC,IAAI,KAAK,kBAAkB,EAAE;YACrC,MAAM7B,SAAS,GAAGjG,mBAAmB,CAAC2B,GAAG,CAACH,GAAG,CAAC;YAC9CyE,SAAS,IACPA,SAAS,CAAClE,OAAO,CAAEb,QAAQ,IAAK;cAC9BkC,aAAa,CAAClC,QAAQ,CAAC;YACzB,CAAC,CAAC;UACN,CAAC,MAAM,IAAI2G,KAAK,CAACC,IAAI,KAAK,UAAU,EAAE;YACpC,MAAMb,IAAwB,GAAGtI,IAAI,CAACmG,KAAK,CAAC+C,KAAK,CAACvE,IAAI,CAAC;YACvDuC,gBAAgB,CAACrE,GAAG,EAAEjE,QAAQ,EAAE0J,IAAI,CAAC;UACvC;UACA;UACA/E,OAAO,CAAC6F,MAAM,GAAG,CAAC;QACpB,CAAC,CAAC,OAAOhI,CAAC,EAAE;UACVoH,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,YAAY,IACnCnG,QAAQ,CAACoG,GAAG,CAAC,WAAW,EAAE;YACxBG,aAAa;YACbtJ,SAAS;YACTwF,KAAK,EAAE5D,CAAC,GAAIA,CAAC,CAAWwH,OAAO,GAAG;UACpC,CAAC,CAAC;UACJS,UAAU,CAAC9F,OAAO,CAAC;QACrB;MACF,CAAC;MACD6F,MAAM,EAAE,CAAC;MACT5F,KAAK,EAAE;IACT,CAAC;IACD9B,OAAO,CAACwB,GAAG,CAACL,GAAG,EAAEU,OAAO,CAAC;IACzBG,aAAa,CAACH,OAAO,CAAC;EACxB;AACF;AAEA,SAAS8F,UAAUA,CAAC9F,OAAsB,EAAE;EAC1C,IAAIA,OAAO,CAACC,KAAK,KAAK,MAAM,EAAE;EAC9BD,OAAO,CAAC6F,MAAM,EAAE;EAChB,IAAI7F,OAAO,CAAC6F,MAAM,GAAG,CAAC,IAAK7F,OAAO,CAACyF,GAAG,IAAIzF,OAAO,CAACyF,GAAG,CAACM,UAAU,KAAK,CAAE,EAAE;IACvE;IACA,MAAMC,KAAK,GACT1C,IAAI,CAAC2C,GAAG,CAAC,CAAC,EAAEjG,OAAO,CAAC6F,MAAM,GAAG,CAAC,CAAC,IAAI,IAAI,GAAGvC,IAAI,CAAC4C,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC;IACjEhG,cAAc,CAACF,OAAO,CAAC;IACvB1C,UAAU,CACR,MAAM;MACJ,IAAI,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC6I,QAAQ,CAACnG,OAAO,CAACC,KAAK,CAAC,EAAE;MAChDE,aAAa,CAACH,OAAO,CAAC;IACxB,CAAC,EACDsD,IAAI,CAACC,GAAG,CAACyC,KAAK,EAAE,MAAM,CACxB,CAAC,CAAC,CAAC;EACL;AACF;AAEA,SAAS9F,cAAcA,CAACF,OAAsB,EAAE;EAC9C,IAAI,CAACA,OAAO,CAACyF,GAAG,EAAE;EAClBzF,OAAO,CAACyF,GAAG,CAACW,MAAM,GAAG,IAAI;EACzBpG,OAAO,CAACyF,GAAG,CAACY,OAAO,GAAG,IAAI;EAC1BrG,OAAO,CAACyF,GAAG,CAACa,KAAK,CAAC,CAAC;EACnBtG,OAAO,CAACyF,GAAG,GAAG,IAAI;EAClB,IAAIzF,OAAO,CAACC,KAAK,KAAK,QAAQ,EAAE;IAC9BD,OAAO,CAACC,KAAK,GAAG,UAAU;EAC5B;AACF;AAEA,SAASE,aAAaA,CAACH,OAAsB,EAAE;EAC7CA,OAAO,CAACyF,GAAG,GAAG5J,OAAO,CAACc,eAAe,CAAC;IACpCX,IAAI,EAAEgE,OAAO,CAAChE,IAAI;IAClBC,SAAS,EAAE+D,OAAO,CAAC/D,SAAS;IAC5BC,OAAO,EAAE8D,OAAO,CAAC9D;EACnB,CAAC,CAAgB;EACjB8D,OAAO,CAACC,KAAK,GAAG,QAAQ;EACxBD,OAAO,CAACyF,GAAG,CAACjI,gBAAgB,CAAC,UAAU,EAAEwC,OAAO,CAAC0F,EAAE,CAAC;EACpD1F,OAAO,CAACyF,GAAG,CAACjI,gBAAgB,CAAC,kBAAkB,EAAEwC,OAAO,CAAC0F,EAAE,CAAC;EAC5D1F,OAAO,CAACyF,GAAG,CAACY,OAAO,GAAG,MAAMP,UAAU,CAAC9F,OAAO,CAAC;EAC/CA,OAAO,CAACyF,GAAG,CAACW,MAAM,GAAG,MAAM;IACzBpG,OAAO,CAAC6F,MAAM,GAAG,CAAC;EACpB,CAAC;AACH;AAEA,SAASU,cAAcA,CAACvG,OAAsB,EAAEV,GAAW,EAAE;EAC3DY,cAAc,CAACF,OAAO,CAAC;EACvB7B,OAAO,CAAC4B,MAAM,CAACT,GAAG,CAAC;AACrB;AAEO,SAASX,gBAAgBA,CAAA,EAAG;EACjC;EACAP,WAAW,CAACS,KAAK,CAAC,CAAC;;EAEnB;EACAV,OAAO,CAAC0B,OAAO,CAAC0G,cAAc,CAAC;;EAE/B;EACAzI,mBAAmB,CAACe,KAAK,CAAC,CAAC;;EAE3B;EACAhD,OAAO,CAAC6B,gBAAgB,CAAC,CAAC;AAC5B;AAEO,SAAS8I,cAAcA,CAC5BxH,QAAuC,EACvC1C,OAAsC,EACtC;EACA,IAAIA,OAAO,CAACmK,SAAS,EAAE;IACrB,IAAI,CAACzH,QAAQ,CAACqF,YAAY,CAAC,CAAC,EAAE;MAC5B,MAAM,IAAI3C,KAAK,CAAC,4CAA4C,CAAC;IAC/D;IACA,IAAIpF,OAAO,CAACD,OAAO,EAAE;MACnB8E,gBAAgB,CAACnC,QAAQ,EAAE,IAAI,CAAC;IAClC;IACAK,SAAS,CAACL,QAAQ,CAAC;EACrB;AACF","ignoreList":[]}